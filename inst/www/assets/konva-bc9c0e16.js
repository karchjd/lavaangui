import{c as Y,g as ma}from"./core-js-bbf708ea.js";var Dr={exports:{}},ke={},Ne={},J={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n._registerNode=n._NODES_REGISTRY=n.Konva=n.glob=n._parseUA=void 0;var r=Math.PI/180;function t(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}var e=function(o){var s=o.indexOf("msie ");if(s>0)return parseInt(o.substring(s+5,o.indexOf(".",s)),10);var l=o.indexOf("trident/");if(l>0){var h=o.indexOf("rv:");return parseInt(o.substring(h+3,o.indexOf(".",h)),10)}var f=o.indexOf("edge/");return f>0?parseInt(o.substring(f+5,o.indexOf(".",f)),10):!1},i=function(o){var s=o.toLowerCase(),l=/(chrome)[ /]([\w.]+)/.exec(s)||/(webkit)[ /]([\w.]+)/.exec(s)||/(opera)(?:.*version|)[ /]([\w.]+)/.exec(s)||/(msie) ([\w.]+)/.exec(s)||s.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(s)||[],h=!!o.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),f=!!o.match(/IEMobile/i);return{browser:l[1]||"",version:l[2]||"0",isIE:e(s),mobile:h,ieMobile:f}};n._parseUA=i,n.glob=typeof Y<"u"?Y:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},n.Konva={_global:n.glob,version:"7.2.5",isBrowser:t(),isUnminified:/param/.test((function(o){}).toString()),dblClickWindow:400,getAngle:function(o){return n.Konva.angleDeg?o*r:o},enableTrace:!1,_pointerEventsEnabled:!1,hitOnDragEnabled:!1,captureTouchEventsEnabled:!1,listenClickTap:!1,inDblClickWindow:!1,pixelRatio:void 0,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:function(){return n.Konva.DD.isDragging},isDragReady:function(){return!!n.Konva.DD.node},UA:n._parseUA(n.glob.navigator&&n.glob.navigator.userAgent||""),document:n.glob.document,_injectGlobal:function(o){n.glob.Konva=o},_parseUA:n._parseUA},n._NODES_REGISTRY={};var a=function(o){n._NODES_REGISTRY[o.prototype.getClassName()]=o,n.Konva[o.prototype.getClassName()]=o};n._registerNode=a})(J);var et={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Util=n.Transform=n.Collection=void 0;var r=J,t=function(){function d(){}return d.toCollection=function(p){var m=new d,A=p.length,E;for(E=0;E<A;E++)m.push(p[E]);return m},d._mapMethod=function(p){d.prototype[p]=function(){var m=this.length,A,E=[].slice.call(arguments);for(A=0;A<m;A++)this[A][p].apply(this[A],E);return this}},d.mapMethods=function(p){var m=p.prototype;for(var A in m)d._mapMethod(A)},d}();n.Collection=t,t.prototype=[],t.prototype.each=function(d){for(var p=0;p<this.length;p++)d(this[p],p)},t.prototype.toArray=function(){var d=[],p=this.length,m;for(m=0;m<p;m++)d.push(this[m]);return d};var e=function(){function d(p){p===void 0&&(p=[1,0,0,1,0,0]),this.dirty=!1,this.m=p&&p.slice()||[1,0,0,1,0,0]}return d.prototype.reset=function(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0},d.prototype.copy=function(){return new d(this.m)},d.prototype.copyInto=function(p){p.m[0]=this.m[0],p.m[1]=this.m[1],p.m[2]=this.m[2],p.m[3]=this.m[3],p.m[4]=this.m[4],p.m[5]=this.m[5]},d.prototype.point=function(p){var m=this.m;return{x:m[0]*p.x+m[2]*p.y+m[4],y:m[1]*p.x+m[3]*p.y+m[5]}},d.prototype.translate=function(p,m){return this.m[4]+=this.m[0]*p+this.m[2]*m,this.m[5]+=this.m[1]*p+this.m[3]*m,this},d.prototype.scale=function(p,m){return this.m[0]*=p,this.m[1]*=p,this.m[2]*=m,this.m[3]*=m,this},d.prototype.rotate=function(p){var m=Math.cos(p),A=Math.sin(p),E=this.m[0]*m+this.m[2]*A,C=this.m[1]*m+this.m[3]*A,G=this.m[0]*-A+this.m[2]*m,M=this.m[1]*-A+this.m[3]*m;return this.m[0]=E,this.m[1]=C,this.m[2]=G,this.m[3]=M,this},d.prototype.getTranslation=function(){return{x:this.m[4],y:this.m[5]}},d.prototype.skew=function(p,m){var A=this.m[0]+this.m[2]*m,E=this.m[1]+this.m[3]*m,C=this.m[2]+this.m[0]*p,G=this.m[3]+this.m[1]*p;return this.m[0]=A,this.m[1]=E,this.m[2]=C,this.m[3]=G,this},d.prototype.multiply=function(p){var m=this.m[0]*p.m[0]+this.m[2]*p.m[1],A=this.m[1]*p.m[0]+this.m[3]*p.m[1],E=this.m[0]*p.m[2]+this.m[2]*p.m[3],C=this.m[1]*p.m[2]+this.m[3]*p.m[3],G=this.m[0]*p.m[4]+this.m[2]*p.m[5]+this.m[4],M=this.m[1]*p.m[4]+this.m[3]*p.m[5]+this.m[5];return this.m[0]=m,this.m[1]=A,this.m[2]=E,this.m[3]=C,this.m[4]=G,this.m[5]=M,this},d.prototype.invert=function(){var p=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),m=this.m[3]*p,A=-this.m[1]*p,E=-this.m[2]*p,C=this.m[0]*p,G=p*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),M=p*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=m,this.m[1]=A,this.m[2]=E,this.m[3]=C,this.m[4]=G,this.m[5]=M,this},d.prototype.getMatrix=function(){return this.m},d.prototype.setAbsolutePosition=function(p,m){var A=this.m[0],E=this.m[1],C=this.m[2],G=this.m[3],M=this.m[4],O=this.m[5],R=(A*(m-O)-E*(p-M))/(A*G-E*C),D=(p-M-C*R)/A;return this.translate(D,R)},d.prototype.decompose=function(){var p=this.m[0],m=this.m[1],A=this.m[2],E=this.m[3],C=this.m[4],G=this.m[5],M=p*E-m*A,O={x:C,y:G,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(p!=0||m!=0){var R=Math.sqrt(p*p+m*m);O.rotation=m>0?Math.acos(p/R):-Math.acos(p/R),O.scaleX=R,O.scaleY=M/R,O.skewX=(p*A+m*E)/M,O.skewY=0}else if(A!=0||E!=0){var D=Math.sqrt(A*A+E*E);O.rotation=Math.PI/2-(E>0?Math.acos(-A/D):-Math.acos(A/D)),O.scaleX=M/D,O.scaleY=D,O.skewX=0,O.skewY=(p*A+m*E)/M}return O.rotation=n.Util._getRotation(O.rotation),O},d}();n.Transform=e;var i="[object Array]",a="[object Number]",o="[object String]",s="[object Boolean]",l=Math.PI/180,h=180/Math.PI,f="#",b="",w="0",c="Konva warning: ",_="Konva error: ",g="rgb(",T={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},P=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,N=[];n.Util={_isElement:function(d){return!!(d&&d.nodeType==1)},_isFunction:function(d){return!!(d&&d.constructor&&d.call&&d.apply)},_isPlainObject:function(d){return!!d&&d.constructor===Object},_isArray:function(d){return Object.prototype.toString.call(d)===i},_isNumber:function(d){return Object.prototype.toString.call(d)===a&&!isNaN(d)&&isFinite(d)},_isString:function(d){return Object.prototype.toString.call(d)===o},_isBoolean:function(d){return Object.prototype.toString.call(d)===s},isObject:function(d){return d instanceof Object},isValidSelector:function(d){if(typeof d!="string")return!1;var p=d[0];return p==="#"||p==="."||p===p.toUpperCase()},_sign:function(d){return d===0||d>0?1:-1},requestAnimFrame:function(d){N.push(d),N.length===1&&requestAnimationFrame(function(){var p=N;N=[],p.forEach(function(m){m()})})},createCanvasElement:function(){var d=document.createElement("canvas");try{d.style=d.style||{}}catch{}return d},createImageElement:function(){return document.createElement("img")},_isInDocument:function(d){for(;d=d.parentNode;)if(d==document)return!0;return!1},_simplifyArray:function(d){var p=[],m=d.length,A=n.Util,E,C;for(E=0;E<m;E++)C=d[E],A._isNumber(C)?C=Math.round(C*1e3)/1e3:A._isString(C)||(C=C.toString()),p.push(C);return p},_urlToImage:function(d,p){var m=new r.glob.Image;m.onload=function(){p(m)},m.src=d},_rgbToHex:function(d,p,m){return((1<<24)+(d<<16)+(p<<8)+m).toString(16).slice(1)},_hexToRgb:function(d){d=d.replace(f,b);var p=parseInt(d,16);return{r:p>>16&255,g:p>>8&255,b:p&255}},getRandomColor:function(){for(var d=(Math.random()*16777215<<0).toString(16);d.length<6;)d=w+d;return f+d},get:function(d,p){return d===void 0?p:d},getRGB:function(d){var p;return d in T?(p=T[d],{r:p[0],g:p[1],b:p[2]}):d[0]===f?this._hexToRgb(d.substring(1)):d.substr(0,4)===g?(p=P.exec(d.replace(/ /g,"")),{r:parseInt(p[1],10),g:parseInt(p[2],10),b:parseInt(p[3],10)}):{r:0,g:0,b:0}},colorToRGBA:function(d){return d=d||"black",n.Util._namedColorToRBA(d)||n.Util._hex3ColorToRGBA(d)||n.Util._hex6ColorToRGBA(d)||n.Util._rgbColorToRGBA(d)||n.Util._rgbaColorToRGBA(d)||n.Util._hslColorToRGBA(d)},_namedColorToRBA:function(d){var p=T[d.toLowerCase()];return p?{r:p[0],g:p[1],b:p[2],a:1}:null},_rgbColorToRGBA:function(d){if(d.indexOf("rgb(")===0){d=d.match(/rgb\(([^)]+)\)/)[1];var p=d.split(/ *, */).map(Number);return{r:p[0],g:p[1],b:p[2],a:1}}},_rgbaColorToRGBA:function(d){if(d.indexOf("rgba(")===0){d=d.match(/rgba\(([^)]+)\)/)[1];var p=d.split(/ *, */).map(Number);return{r:p[0],g:p[1],b:p[2],a:p[3]}}},_hex6ColorToRGBA:function(d){if(d[0]==="#"&&d.length===7)return{r:parseInt(d.slice(1,3),16),g:parseInt(d.slice(3,5),16),b:parseInt(d.slice(5,7),16),a:1}},_hex3ColorToRGBA:function(d){if(d[0]==="#"&&d.length===4)return{r:parseInt(d[1]+d[1],16),g:parseInt(d[2]+d[2],16),b:parseInt(d[3]+d[3],16),a:1}},_hslColorToRGBA:function(d){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(d)){var p=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(d);p[0];var m=p.slice(1),A=Number(m[0])/360,E=Number(m[1])/100,C=Number(m[2])/100,G=void 0,M=void 0,O=void 0;if(E===0)return O=C*255,{r:Math.round(O),g:Math.round(O),b:Math.round(O),a:1};C<.5?G=C*(1+E):G=C+E-C*E;for(var R=2*C-G,D=[0,0,0],I=0;I<3;I++)M=A+1/3*-(I-1),M<0&&M++,M>1&&M--,6*M<1?O=R+(G-R)*6*M:2*M<1?O=G:3*M<2?O=R+(G-R)*(2/3-M)*6:O=R,D[I]=O*255;return{r:Math.round(D[0]),g:Math.round(D[1]),b:Math.round(D[2]),a:1}}},haveIntersection:function(d,p){return!(p.x>d.x+d.width||p.x+p.width<d.x||p.y>d.y+d.height||p.y+p.height<d.y)},cloneObject:function(d){var p={};for(var m in d)this._isPlainObject(d[m])?p[m]=this.cloneObject(d[m]):this._isArray(d[m])?p[m]=this.cloneArray(d[m]):p[m]=d[m];return p},cloneArray:function(d){return d.slice(0)},_degToRad:function(d){return d*l},_radToDeg:function(d){return d*h},_getRotation:function(d){return r.Konva.angleDeg?n.Util._radToDeg(d):d},_capitalize:function(d){return d.charAt(0).toUpperCase()+d.slice(1)},throw:function(d){throw new Error(_+d)},error:function(d){console.error(_+d)},warn:function(d){r.Konva.showWarnings&&console.warn(c+d)},extend:function(d,p){function m(){this.constructor=d}m.prototype=p.prototype;var A=d.prototype;d.prototype=new m;for(var E in A)A.hasOwnProperty(E)&&(d.prototype[E]=A[E]);d.__super__=p.prototype,d.super=p},_getControlPoints:function(d,p,m,A,E,C,G){var M=Math.sqrt(Math.pow(m-d,2)+Math.pow(A-p,2)),O=Math.sqrt(Math.pow(E-m,2)+Math.pow(C-A,2)),R=G*M/(M+O),D=G*O/(M+O),I=m-R*(E-d),j=A-R*(C-p),B=m+D*(E-d),U=A+D*(C-p);return[I,j,B,U]},_expandPoints:function(d,p){var m=d.length,A=[],E,C;for(E=2;E<m-2;E+=2)C=n.Util._getControlPoints(d[E-2],d[E-1],d[E],d[E+1],d[E+2],d[E+3],p),!isNaN(C[0])&&(A.push(C[0]),A.push(C[1]),A.push(d[E]),A.push(d[E+1]),A.push(C[2]),A.push(C[3]));return A},each:function(d,p){for(var m in d)p(m,d[m])},_inRange:function(d,p,m){return p<=d&&d<m},_getProjectionToSegment:function(d,p,m,A,E,C){var G,M,O,R=(d-m)*(d-m)+(p-A)*(p-A);if(R==0)G=d,M=p,O=(E-m)*(E-m)+(C-A)*(C-A);else{var D=((E-d)*(m-d)+(C-p)*(A-p))/R;D<0?(G=d,M=p,O=(d-E)*(d-E)+(p-C)*(p-C)):D>1?(G=m,M=A,O=(m-E)*(m-E)+(A-C)*(A-C)):(G=d+D*(m-d),M=p+D*(A-p),O=(G-E)*(G-E)+(M-C)*(M-C))}return[G,M,O]},_getProjectionToLine:function(d,p,m){var A=n.Util.cloneObject(d),E=Number.MAX_VALUE;return p.forEach(function(C,G){if(!(!m&&G===p.length-1)){var M=p[(G+1)%p.length],O=n.Util._getProjectionToSegment(C.x,C.y,M.x,M.y,d.x,d.y),R=O[0],D=O[1],I=O[2];I<E&&(A.x=R,A.y=D,E=I)}}),A},_prepareArrayForTween:function(d,p,m){var A,E=[],C=[];if(d.length>p.length){var G=p;p=d,d=G}for(A=0;A<d.length;A+=2)E.push({x:d[A],y:d[A+1]});for(A=0;A<p.length;A+=2)C.push({x:p[A],y:p[A+1]});var M=[];return C.forEach(function(O){var R=n.Util._getProjectionToLine(O,E,m);M.push(R.x),M.push(R.y)}),M},_prepareToStringify:function(d){var p;d.visitedByCircularReferenceRemoval=!0;for(var m in d)if(d.hasOwnProperty(m)&&d[m]&&typeof d[m]=="object"){if(p=Object.getOwnPropertyDescriptor(d,m),d[m].visitedByCircularReferenceRemoval||n.Util._isElement(d[m]))if(p.configurable)delete d[m];else return null;else if(n.Util._prepareToStringify(d[m])===null)if(p.configurable)delete d[m];else return null}return delete d.visitedByCircularReferenceRemoval,d},_assign:function(d,p){for(var m in p)d[m]=p[m];return d},_getFirstPointerId:function(d){return d.touches?d.changedTouches[0].identifier:999}}})(et);var st={},Q={},W={};Object.defineProperty(W,"__esModule",{value:!0});W.getComponentValidator=W.getBooleanValidator=W.getNumberArrayValidator=W.getFunctionValidator=W.getStringOrGradientValidator=W.getStringValidator=W.getNumberOrAutoValidator=W.getNumberOrArrayOfNumbersValidator=W.getNumberValidator=W.alphaComponent=W.RGBComponent=void 0;var Mt=J,ot=et;function Et(n){return ot.Util._isString(n)?'"'+n+'"':Object.prototype.toString.call(n)==="[object Number]"||ot.Util._isBoolean(n)?n:Object.prototype.toString.call(n)}function Sa(n){return n>255?255:n<0?0:Math.round(n)}W.RGBComponent=Sa;function ba(n){return n>1?1:n<1e-4?1e-4:n}W.alphaComponent=ba;function Ca(){if(Mt.Konva.isUnminified)return function(n,r){return ot.Util._isNumber(n)||ot.Util.warn(Et(n)+' is a not valid value for "'+r+'" attribute. The value should be a number.'),n}}W.getNumberValidator=Ca;function wa(n){if(Mt.Konva.isUnminified)return function(r,t){var e=ot.Util._isNumber(r),i=ot.Util._isArray(r)&&r.length==n;return!e&&!i&&ot.Util.warn(Et(r)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>('+n+")"),r}}W.getNumberOrArrayOfNumbersValidator=wa;function Pa(){if(Mt.Konva.isUnminified)return function(n,r){var t=ot.Util._isNumber(n),e=n==="auto";return t||e||ot.Util.warn(Et(n)+' is a not valid value for "'+r+'" attribute. The value should be a number or "auto".'),n}}W.getNumberOrAutoValidator=Pa;function Ta(){if(Mt.Konva.isUnminified)return function(n,r){return ot.Util._isString(n)||ot.Util.warn(Et(n)+' is a not valid value for "'+r+'" attribute. The value should be a string.'),n}}W.getStringValidator=Ta;function Oa(){if(Mt.Konva.isUnminified)return function(n,r){var t=ot.Util._isString(n),e=Object.prototype.toString.call(n)==="[object CanvasGradient]";return t||e||ot.Util.warn(Et(n)+' is a not valid value for "'+r+'" attribute. The value should be a string or a native gradient.'),n}}W.getStringOrGradientValidator=Oa;function Aa(){if(Mt.Konva.isUnminified)return function(n,r){return ot.Util._isFunction(n)||ot.Util.warn(Et(n)+' is a not valid value for "'+r+'" attribute. The value should be a function.'),n}}W.getFunctionValidator=Aa;function xa(){if(Mt.Konva.isUnminified)return function(n,r){return ot.Util._isArray(n)?n.forEach(function(t){ot.Util._isNumber(t)||ot.Util.warn('"'+r+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")}):ot.Util.warn(Et(n)+' is a not valid value for "'+r+'" attribute. The value should be a array of numbers.'),n}}W.getNumberArrayValidator=xa;function Fa(){if(Mt.Konva.isUnminified)return function(n,r){var t=n===!0||n===!1;return t||ot.Util.warn(Et(n)+' is a not valid value for "'+r+'" attribute. The value should be a boolean.'),n}}W.getBooleanValidator=Fa;function Ma(n){if(Mt.Konva.isUnminified)return function(r,t){return ot.Util.isObject(r)||ot.Util.warn(Et(r)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+n),r}}W.getComponentValidator=Ma;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Factory=void 0;var r=et,t=W,e="get",i="set";n.Factory={addGetterSetter:function(a,o,s,l,h){n.Factory.addGetter(a,o,s),n.Factory.addSetter(a,o,l,h),n.Factory.addOverloadedGetterSetter(a,o)},addGetter:function(a,o,s){var l=e+r.Util._capitalize(o);a.prototype[l]=a.prototype[l]||function(){var h=this.attrs[o];return h===void 0?s:h}},addSetter:function(a,o,s,l){var h=i+r.Util._capitalize(o);a.prototype[h]||n.Factory.overWriteSetter(a,o,s,l)},overWriteSetter:function(a,o,s,l){var h=i+r.Util._capitalize(o);a.prototype[h]=function(f){return s&&f!==void 0&&f!==null&&(f=s.call(this,f,o)),this._setAttr(o,f),l&&l.call(this),this}},addComponentsGetterSetter:function(a,o,s,l,h){var f=s.length,b=r.Util._capitalize,w=e+b(o),c=i+b(o),_,g;a.prototype[w]=function(){var P={};for(_=0;_<f;_++)g=s[_],P[g]=this.getAttr(o+b(g));return P};var T=t.getComponentValidator(s);a.prototype[c]=function(P){var N=this.attrs[o],d;l&&(P=l.call(this,P)),T&&T.call(this,P,o);for(d in P)P.hasOwnProperty(d)&&this._setAttr(o+b(d),P[d]);return this._fireChangeEvent(o,N,P),h&&h.call(this),this},n.Factory.addOverloadedGetterSetter(a,o)},addOverloadedGetterSetter:function(a,o){var s=r.Util._capitalize(o),l=i+s,h=e+s;a.prototype[o]=function(){return arguments.length?(this[l](arguments[0]),this):this[h]()}},addDeprecatedGetterSetter:function(a,o,s,l){r.Util.error("Adding deprecated "+o);var h=e+r.Util._capitalize(o),f=o+" property is deprecated and will be removed soon. Look at Konva change log for more information.";a.prototype[h]=function(){r.Util.error(f);var b=this.attrs[o];return b===void 0?s:b},n.Factory.addSetter(a,o,l,function(){r.Util.error(f)}),n.Factory.addOverloadedGetterSetter(a,o)},backCompat:function(a,o){r.Util.each(o,function(s,l){var h=a.prototype[l],f=e+r.Util._capitalize(s),b=i+r.Util._capitalize(s);function w(){h.apply(this,arguments),r.Util.error('"'+s+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}a.prototype[s]=w,a.prototype[f]=w,a.prototype[b]=w})},afterSetFilter:function(){this._filterUpToDate=!1}}})(Q);var St={},Ft={},xi=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ft,"__esModule",{value:!0});Ft.HitContext=Ft.SceneContext=Ft.Context=void 0;var Lr=et,Fi=J,ii=",",Ea="(",ka=")",Na="([",Ga="])",Ra=";",Da="()",La="=",ai=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],Ia=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],Ua=100,Ge=function(){function n(r){this.canvas=r,this._context=r._canvas.getContext("2d"),Fi.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}return n.prototype.fillShape=function(r){r.fillEnabled()&&this._fill(r)},n.prototype._fill=function(r){},n.prototype.strokeShape=function(r){r.hasStroke()&&this._stroke(r)},n.prototype._stroke=function(r){},n.prototype.fillStrokeShape=function(r){r.attrs.fillAfterStrokeEnabled?(this.strokeShape(r),this.fillShape(r)):(this.fillShape(r),this.strokeShape(r))},n.prototype.getTrace=function(r){var t=this.traceArr,e=t.length,i="",a,o,s,l;for(a=0;a<e;a++)o=t[a],s=o.method,s?(l=o.args,i+=s,r?i+=Da:Lr.Util._isArray(l[0])?i+=Na+l.join(ii)+Ga:i+=Ea+l.join(ii)+ka):(i+=o.property,r||(i+=La+o.val)),i+=Ra;return i},n.prototype.clearTrace=function(){this.traceArr=[]},n.prototype._trace=function(r){var t=this.traceArr,e;t.push(r),e=t.length,e>=Ua&&t.shift()},n.prototype.reset=function(){var r=this.getCanvas().getPixelRatio();this.setTransform(1*r,0,0,1*r,0,0)},n.prototype.getCanvas=function(){return this.canvas},n.prototype.clear=function(r){var t=this.getCanvas();r?this.clearRect(r.x||0,r.y||0,r.width||0,r.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)},n.prototype._applyLineCap=function(r){var t=r.getLineCap();t&&this.setAttr("lineCap",t)},n.prototype._applyOpacity=function(r){var t=r.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)},n.prototype._applyLineJoin=function(r){var t=r.attrs.lineJoin;t&&this.setAttr("lineJoin",t)},n.prototype.setAttr=function(r,t){this._context[r]=t},n.prototype.arc=function(r,t,e,i,a,o){this._context.arc(r,t,e,i,a,o)},n.prototype.arcTo=function(r,t,e,i,a){this._context.arcTo(r,t,e,i,a)},n.prototype.beginPath=function(){this._context.beginPath()},n.prototype.bezierCurveTo=function(r,t,e,i,a,o){this._context.bezierCurveTo(r,t,e,i,a,o)},n.prototype.clearRect=function(r,t,e,i){this._context.clearRect(r,t,e,i)},n.prototype.clip=function(){this._context.clip()},n.prototype.closePath=function(){this._context.closePath()},n.prototype.createImageData=function(r,t){var e=arguments;if(e.length===2)return this._context.createImageData(r,t);if(e.length===1)return this._context.createImageData(r)},n.prototype.createLinearGradient=function(r,t,e,i){return this._context.createLinearGradient(r,t,e,i)},n.prototype.createPattern=function(r,t){return this._context.createPattern(r,t)},n.prototype.createRadialGradient=function(r,t,e,i,a,o){return this._context.createRadialGradient(r,t,e,i,a,o)},n.prototype.drawImage=function(r,t,e,i,a,o,s,l,h){var f=arguments,b=this._context;f.length===3?b.drawImage(r,t,e):f.length===5?b.drawImage(r,t,e,i,a):f.length===9&&b.drawImage(r,t,e,i,a,o,s,l,h)},n.prototype.ellipse=function(r,t,e,i,a,o,s,l){this._context.ellipse(r,t,e,i,a,o,s,l)},n.prototype.isPointInPath=function(r,t){return this._context.isPointInPath(r,t)},n.prototype.fill=function(){this._context.fill()},n.prototype.fillRect=function(r,t,e,i){this._context.fillRect(r,t,e,i)},n.prototype.strokeRect=function(r,t,e,i){this._context.strokeRect(r,t,e,i)},n.prototype.fillText=function(r,t,e){this._context.fillText(r,t,e)},n.prototype.measureText=function(r){return this._context.measureText(r)},n.prototype.getImageData=function(r,t,e,i){return this._context.getImageData(r,t,e,i)},n.prototype.lineTo=function(r,t){this._context.lineTo(r,t)},n.prototype.moveTo=function(r,t){this._context.moveTo(r,t)},n.prototype.rect=function(r,t,e,i){this._context.rect(r,t,e,i)},n.prototype.putImageData=function(r,t,e){this._context.putImageData(r,t,e)},n.prototype.quadraticCurveTo=function(r,t,e,i){this._context.quadraticCurveTo(r,t,e,i)},n.prototype.restore=function(){this._context.restore()},n.prototype.rotate=function(r){this._context.rotate(r)},n.prototype.save=function(){this._context.save()},n.prototype.scale=function(r,t){this._context.scale(r,t)},n.prototype.setLineDash=function(r){this._context.setLineDash?this._context.setLineDash(r):"mozDash"in this._context?this._context.mozDash=r:"webkitLineDash"in this._context&&(this._context.webkitLineDash=r)},n.prototype.getLineDash=function(){return this._context.getLineDash()},n.prototype.setTransform=function(r,t,e,i,a,o){this._context.setTransform(r,t,e,i,a,o)},n.prototype.stroke=function(){this._context.stroke()},n.prototype.strokeText=function(r,t,e,i){this._context.strokeText(r,t,e,i)},n.prototype.transform=function(r,t,e,i,a,o){this._context.transform(r,t,e,i,a,o)},n.prototype.translate=function(r,t){this._context.translate(r,t)},n.prototype._enableTrace=function(){var r=this,t=ai.length,e=Lr.Util._simplifyArray,i=this.setAttr,a,o,s=function(l){var h=r[l],f;r[l]=function(){return o=e(Array.prototype.slice.call(arguments,0)),f=h.apply(r,arguments),r._trace({method:l,args:o}),f}};for(a=0;a<t;a++)s(ai[a]);r.setAttr=function(){i.apply(r,arguments);var l=arguments[0],h=arguments[1];(l==="shadowOffsetX"||l==="shadowOffsetY"||l==="shadowBlur")&&(h=h/this.canvas.getPixelRatio()),r._trace({property:l,val:h})}},n.prototype._applyGlobalCompositeOperation=function(r){var t=r.getGlobalCompositeOperation();t!=="source-over"&&this.setAttr("globalCompositeOperation",t)},n}();Ft.Context=Ge;Ia.forEach(function(n){Object.defineProperty(Ge.prototype,n,{get:function(){return this._context[n]},set:function(r){this._context[n]=r}})});var Va=function(n){xi(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._fillColor=function(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)},r.prototype._fillPattern=function(t){var e=t.getFillPatternX(),i=t.getFillPatternY(),a=Fi.Konva.getAngle(t.getFillPatternRotation()),o=t.getFillPatternOffsetX(),s=t.getFillPatternOffsetY();t.getFillPatternScaleX(),t.getFillPatternScaleY(),(e||i)&&this.translate(e||0,i||0),a&&this.rotate(a),(o||s)&&this.translate(-1*o,-1*s),this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)},r.prototype._fillLinearGradient=function(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},r.prototype._fillRadialGradient=function(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))},r.prototype._fill=function(t){var e=t.fill(),i=t.getFillPriority();if(e&&i==="color"){this._fillColor(t);return}var a=t.getFillPatternImage();if(a&&i==="pattern"){this._fillPattern(t);return}var o=t.getFillLinearGradientColorStops();if(o&&i==="linear-gradient"){this._fillLinearGradient(t);return}var s=t.getFillRadialGradientColorStops();if(s&&i==="radial-gradient"){this._fillRadialGradient(t);return}e?this._fillColor(t):a?this._fillPattern(t):o?this._fillLinearGradient(t):s&&this._fillRadialGradient(t)},r.prototype._strokeLinearGradient=function(t){var e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),a=t.getStrokeLinearGradientColorStops(),o=this.createLinearGradient(e.x,e.y,i.x,i.y);if(a){for(var s=0;s<a.length;s+=2)o.addColorStop(a[s],a[s+1]);this.setAttr("strokeStyle",o)}},r.prototype._stroke=function(t){var e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();var a=this.getCanvas().getPixelRatio();this.setTransform(a,0,0,a,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var o=t.getStrokeLinearGradientColorStops();o?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),i||this.restore()}},r.prototype._applyShadow=function(t){var e=Lr.Util,i=e.get(t.getShadowRGBA(),"black"),a=e.get(t.getShadowBlur(),5),o=e.get(t.getShadowOffset(),{x:0,y:0}),s=t.getAbsoluteScale(),l=this.canvas.getPixelRatio(),h=s.x*l,f=s.y*l;this.setAttr("shadowColor",i),this.setAttr("shadowBlur",a*Math.min(Math.abs(h),Math.abs(f))),this.setAttr("shadowOffsetX",o.x*h),this.setAttr("shadowOffsetY",o.y*f)},r}(Ge);Ft.SceneContext=Va;var $a=function(n){xi(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._fill=function(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()},r.prototype.strokeShape=function(t){t.hasHitStroke()&&this._stroke(t)},r.prototype._stroke=function(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(t);var a=t.hitStrokeWidth(),o=a==="auto"?t.strokeWidth():a;this.setAttr("lineWidth",o),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}},r}(Ge);Ft.HitContext=$a;var Mi=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(St,"__esModule",{value:!0});St.HitCanvas=St.SceneCanvas=St.Canvas=void 0;var Ir=et,Ei=Ft,ki=J,Ba=Q,Ha=W,be;function ja(){if(be)return be;var n=Ir.Util.createCanvasElement(),r=n.getContext("2d");return be=function(){var t=ki.Konva._global.devicePixelRatio||1,e=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1;return t/e}(),be}var Re=function(){function n(r){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var t=r||{},e=t.pixelRatio||ki.Konva.pixelRatio||ja();this.pixelRatio=e,this._canvas=Ir.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}return n.prototype.getContext=function(){return this.context},n.prototype.getPixelRatio=function(){return this.pixelRatio},n.prototype.setPixelRatio=function(r){var t=this.pixelRatio;this.pixelRatio=r,this.setSize(this.getWidth()/t,this.getHeight()/t)},n.prototype.setWidth=function(r){this.width=this._canvas.width=r*this.pixelRatio,this._canvas.style.width=r+"px";var t=this.pixelRatio,e=this.getContext()._context;e.scale(t,t)},n.prototype.setHeight=function(r){this.height=this._canvas.height=r*this.pixelRatio,this._canvas.style.height=r+"px";var t=this.pixelRatio,e=this.getContext()._context;e.scale(t,t)},n.prototype.getWidth=function(){return this.width},n.prototype.getHeight=function(){return this.height},n.prototype.setSize=function(r,t){this.setWidth(r||0),this.setHeight(t||0)},n.prototype.toDataURL=function(r,t){try{return this._canvas.toDataURL(r,t)}catch{try{return this._canvas.toDataURL()}catch(i){return Ir.Util.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}},n}();St.Canvas=Re;Ba.Factory.addGetterSetter(Re,"pixelRatio",void 0,Ha.getNumberValidator());var za=function(n){Mi(r,n);function r(t){t===void 0&&(t={width:0,height:0});var e=n.call(this,t)||this;return e.context=new Ei.SceneContext(e),e.setSize(t.width,t.height),e}return r}(Re);St.SceneCanvas=za;var Wa=function(n){Mi(r,n);function r(t){t===void 0&&(t={width:0,height:0});var e=n.call(this,t)||this;return e.hitCanvas=!0,e.context=new Ei.HitContext(e),e.setSize(t.width,t.height),e}return r}(Re);St.HitCanvas=Wa;var De={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.DD=void 0;var r=J,t=et;n.DD={get isDragging(){var e=!1;return n.DD._dragElements.forEach(function(i){i.dragStatus==="dragging"&&(e=!0)}),e},justDragged:!1,get node(){var e;return n.DD._dragElements.forEach(function(i){e=i.node}),e},_dragElements:new Map,_drag:function(e){var i=[];n.DD._dragElements.forEach(function(a,o){var s=a.node,l=s.getStage();l.setPointersPositions(e),a.pointerId===void 0&&(a.pointerId=t.Util._getFirstPointerId(e));var h=l._changedPointerPositions.find(function(w){return w.id===a.pointerId});if(h){if(a.dragStatus!=="dragging"){var f=s.dragDistance(),b=Math.max(Math.abs(h.x-a.startPointerPos.x),Math.abs(h.y-a.startPointerPos.y));if(b<f||(s.startDrag({evt:e}),!s.isDragging()))return}s._setDragPosition(e,a),i.push(s)}}),i.forEach(function(a){a.fire("dragmove",{type:"dragmove",target:a,evt:e},!0)})},_endDragBefore:function(e){n.DD._dragElements.forEach(function(i,a){var o=i.node,s=o.getStage();e&&s.setPointersPositions(e);var l=s._changedPointerPositions.find(function(f){return f.id===i.pointerId});if(l){(i.dragStatus==="dragging"||i.dragStatus==="stopped")&&(n.DD.justDragged=!0,r.Konva.listenClickTap=!1,i.dragStatus="stopped");var h=i.node.getLayer()||i.node instanceof r.Konva.Stage&&i.node;h&&h.batchDraw()}})},_endDragAfter:function(e){n.DD._dragElements.forEach(function(i,a){i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:e},!0),i.dragStatus!=="dragging"&&n.DD._dragElements.delete(a)})}},r.Konva.isBrowser&&(window.addEventListener("mouseup",n.DD._endDragBefore,!0),window.addEventListener("touchend",n.DD._endDragBefore,!0),window.addEventListener("mousemove",n.DD._drag),window.addEventListener("touchmove",n.DD._drag),window.addEventListener("mouseup",n.DD._endDragAfter,!1),window.addEventListener("touchend",n.DD._endDragAfter,!1))})(De);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Node=n._removeName=n._addName=n._removeId=n.names=n.ids=void 0;var r=et,t=Q,e=St,i=J,a=De,o=W;n.ids={},n.names={};var s=function(F,u){u&&(n.ids[u]=F)},l=function(F,u){F&&n.ids[F]===u&&delete n.ids[F]};n._removeId=l;var h=function(F,u){u&&(n.names[u]||(n.names[u]=[]),n.names[u].push(F))};n._addName=h;var f=function(F,u){if(F){var v=n.names[F];if(v){for(var y=0;y<v.length;y++){var x=v[y];x._id===u&&v.splice(y,1)}v.length===0&&delete n.names[F]}}};n._removeName=f;var b="absoluteOpacity",w="allEventListeners",c="absoluteTransform",_="absoluteScale",g="canvas",T="Change",P="children",N="konva",d="listening",p="mouseenter",m="mouseleave",A="name",E="set",C="Shape",G=" ",M="stage",O="transform",R="Stage",D="visible",I=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(G),j=new r.Collection,B=1,U=function(){function F(u){this._id=B++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this.children=j,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(u),this._shouldFireChangeEvents=!0}return F.prototype.hasChildren=function(){return!1},F.prototype.getChildren=function(){return j},F.prototype._clearCache=function(u){(u===O||u===c)&&this._cache.get(u)?this._cache.get(u).dirty=!0:u?this._cache.delete(u):this._cache.clear()},F.prototype._getCache=function(u,v){var y=this._cache.get(u),x=u===O||u===c,k=y===void 0||x&&y.dirty===!0;return k&&(y=v.call(this),this._cache.set(u,y)),y},F.prototype._calculate=function(u,v,y){var x=this;if(!this._attachedDepsListeners.get(u)){var k=v.map(function(V){return V+"Change.konva"}).join(G);this.on(k,function(){x._clearCache(u)}),this._attachedDepsListeners.set(u,!0)}return this._getCache(u,y)},F.prototype._getCanvasCache=function(){return this._cache.get(g)},F.prototype._clearSelfAndDescendantCache=function(u,v){this._clearCache(u),v&&u===c&&this.fire("_clearTransformCache"),!this.isCached()&&this.children&&this.children.each(function(y){y._clearSelfAndDescendantCache(u,!0)})},F.prototype.clearCache=function(){return this._cache.delete(g),this._clearSelfAndDescendantCache(),this},F.prototype.cache=function(u){var v=u||{},y={};(v.x===void 0||v.y===void 0||v.width===void 0||v.height===void 0)&&(y=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var x=Math.ceil(v.width||y.width),k=Math.ceil(v.height||y.height),V=v.pixelRatio,H=v.x===void 0?y.x:v.x,X=v.y===void 0?y.y:v.y,rt=v.offset||0,lt=v.drawBorder||!1;if(!x||!k){r.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}x+=rt*2,k+=rt*2,H-=rt,X-=rt;var yt=new e.SceneCanvas({pixelRatio:V,width:x,height:k}),$t=new e.SceneCanvas({pixelRatio:V,width:0,height:0}),qt=new e.HitCanvas({pixelRatio:1,width:x,height:k}),vt=yt.getContext(),se=qt.getContext();return qt.isCache=!0,yt.isCache=!0,this._cache.delete("canvas"),this._filterUpToDate=!1,v.imageSmoothingEnabled===!1&&(yt.getContext()._context.imageSmoothingEnabled=!1,$t.getContext()._context.imageSmoothingEnabled=!1),vt.save(),se.save(),vt.translate(-H,-X),se.translate(-H,-X),this._isUnderCache=!0,this._clearSelfAndDescendantCache(b),this._clearSelfAndDescendantCache(_),this.drawScene(yt,this),this.drawHit(qt,this),this._isUnderCache=!1,vt.restore(),se.restore(),lt&&(vt.save(),vt.beginPath(),vt.rect(0,0,x,k),vt.closePath(),vt.setAttr("strokeStyle","red"),vt.setAttr("lineWidth",5),vt.stroke(),vt.restore()),this._cache.set(g,{scene:yt,filter:$t,hit:qt,x:H,y:X}),this},F.prototype.isCached=function(){return this._cache.has("canvas")},F.prototype.getClientRect=function(u){throw new Error('abstract "getClientRect" method call')},F.prototype._transformedRect=function(u,v){var y=[{x:u.x,y:u.y},{x:u.x+u.width,y:u.y},{x:u.x+u.width,y:u.y+u.height},{x:u.x,y:u.y+u.height}],x,k,V,H,X=this.getAbsoluteTransform(v);return y.forEach(function(rt){var lt=X.point(rt);x===void 0&&(x=V=lt.x,k=H=lt.y),x=Math.min(x,lt.x),k=Math.min(k,lt.y),V=Math.max(V,lt.x),H=Math.max(H,lt.y)}),{x,y:k,width:V-x,height:H-k}},F.prototype._drawCachedSceneCanvas=function(u){u.save(),u._applyOpacity(this),u._applyGlobalCompositeOperation(this);var v=this._getCanvasCache();u.translate(v.x,v.y);var y=this._getCachedSceneCanvas(),x=y.pixelRatio;u.drawImage(y._canvas,0,0,y.width/x,y.height/x),u.restore()},F.prototype._drawCachedHitCanvas=function(u){var v=this._getCanvasCache(),y=v.hit;u.save(),u.translate(v.x,v.y),u.drawImage(y._canvas,0,0),u.restore()},F.prototype._getCachedSceneCanvas=function(){var u=this.filters(),v=this._getCanvasCache(),y=v.scene,x=v.filter,k=x.getContext(),V,H,X,rt;if(u){if(!this._filterUpToDate){var lt=y.pixelRatio;x.setSize(y.width/y.pixelRatio,y.height/y.pixelRatio);try{for(V=u.length,k.clear(),k.drawImage(y._canvas,0,0,y.getWidth()/lt,y.getHeight()/lt),H=k.getImageData(0,0,x.getWidth(),x.getHeight()),X=0;X<V;X++){if(rt=u[X],typeof rt!="function"){r.Util.error("Filter should be type of function, but got "+typeof rt+" instead. Please check correct filters");continue}rt.call(this,H),k.putImageData(H,0,0)}}catch(yt){r.Util.error("Unable to apply filter. "+yt.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return x}return y},F.prototype.on=function(u,v){if(this._cache&&this._cache.delete(w),arguments.length===3)return this._delegate.apply(this,arguments);var y=u.split(G),x=y.length,k,V,H,X,rt;for(k=0;k<x;k++)V=y[k],H=V.split("."),X=H[0],rt=H[1]||"",this.eventListeners[X]||(this.eventListeners[X]=[]),this.eventListeners[X].push({name:rt,handler:v});return this},F.prototype.off=function(u,v){var y=(u||"").split(G),x=y.length,k,V,H,X,rt,lt;if(this._cache&&this._cache.delete(w),!u)for(V in this.eventListeners)this._off(V);for(k=0;k<x;k++)if(H=y[k],X=H.split("."),rt=X[0],lt=X[1],rt)this.eventListeners[rt]&&this._off(rt,lt,v);else for(V in this.eventListeners)this._off(V,lt,v);return this},F.prototype.dispatchEvent=function(u){var v={target:this,type:u.type,evt:u};return this.fire(u.type,v),this},F.prototype.addEventListener=function(u,v){return this.on(u,function(y){v.call(this,y.evt)}),this},F.prototype.removeEventListener=function(u){return this.off(u),this},F.prototype._delegate=function(u,v,y){var x=this;this.on(u,function(k){for(var V=k.target.findAncestors(v,!0,x),H=0;H<V.length;H++)k=r.Util.cloneObject(k),k.currentTarget=V[H],y.call(V[H],k)})},F.prototype.remove=function(){return this.isDragging()&&this.stopDrag(),a.DD._dragElements.delete(this._id),this._remove(),this},F.prototype._clearCaches=function(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(b),this._clearSelfAndDescendantCache(_),this._clearSelfAndDescendantCache(M),this._clearSelfAndDescendantCache(D),this._clearSelfAndDescendantCache(d)},F.prototype._remove=function(){this._clearCaches();var u=this.getParent();u&&u.children&&(u.children.splice(this.index,1),u._setChildrenIndices(),this.parent=null)},F.prototype.destroy=function(){n._removeId(this.id(),this);for(var u=(this.name()||"").split(/\s/g),v=0;v<u.length;v++){var y=u[v];n._removeName(y,this._id)}return this.remove(),this},F.prototype.getAttr=function(u){var v="get"+r.Util._capitalize(u);return r.Util._isFunction(this[v])?this[v]():this.attrs[u]},F.prototype.getAncestors=function(){for(var u=this.getParent(),v=new r.Collection;u;)v.push(u),u=u.getParent();return v},F.prototype.getAttrs=function(){return this.attrs||{}},F.prototype.setAttrs=function(u){var v=this;return this._batchTransformChanges(function(){var y,x;if(!u)return v;for(y in u)y!==P&&(x=E+r.Util._capitalize(y),r.Util._isFunction(v[x])?v[x](u[y]):v._setAttr(y,u[y]))}),this},F.prototype.isListening=function(){return this._getCache(d,this._isListening)},F.prototype._isListening=function(u){var v=this.listening();if(!v)return!1;var y=this.getParent();return y&&y!==u&&this!==u?y._isListening(u):!0},F.prototype.isVisible=function(){return this._getCache(D,this._isVisible)},F.prototype._isVisible=function(u){var v=this.visible();if(!v)return!1;var y=this.getParent();return y&&y!==u&&this!==u?y._isVisible(u):!0},F.prototype.shouldDrawHit=function(u,v){if(v===void 0&&(v=!1),u)return this._isVisible(u)&&this._isListening(u);var y=this.getLayer(),x=!1;a.DD._dragElements.forEach(function(V){V.dragStatus==="dragging"&&(V.node.nodeType==="Stage"||V.node.getLayer()===y)&&(x=!0)});var k=!v&&!i.Konva.hitOnDragEnabled&&x;return this.isListening()&&this.isVisible()&&!k},F.prototype.show=function(){return this.visible(!0),this},F.prototype.hide=function(){return this.visible(!1),this},F.prototype.getZIndex=function(){return this.index||0},F.prototype.getAbsoluteZIndex=function(){var u=this.getDepth(),v=this,y=0,x,k,V,H;function X(rt){for(x=[],k=rt.length,V=0;V<k;V++)H=rt[V],y++,H.nodeType!==C&&(x=x.concat(H.getChildren().toArray())),H._id===v._id&&(V=k);x.length>0&&x[0].getDepth()<=u&&X(x)}return v.nodeType!==R&&X(v.getStage().getChildren()),y},F.prototype.getDepth=function(){for(var u=0,v=this.parent;v;)u++,v=v.parent;return u},F.prototype._batchTransformChanges=function(u){this._batchingTransformChange=!0,u(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(O),this._clearSelfAndDescendantCache(c,!0)),this._needClearTransformCache=!1},F.prototype.setPosition=function(u){var v=this;return this._batchTransformChanges(function(){v.x(u.x),v.y(u.y)}),this},F.prototype.getPosition=function(){return{x:this.x(),y:this.y()}},F.prototype.getAbsolutePosition=function(u){for(var v=!1,y=this.parent;y;){if(y.isCached()){v=!0;break}y=y.parent}v&&!u&&(u=!0);var x=this.getAbsoluteTransform(u).getMatrix(),k=new r.Transform,V=this.offset();return k.m=x.slice(),k.translate(V.x,V.y),k.getTranslation()},F.prototype.setAbsolutePosition=function(u){var v=this._clearTransform();this.attrs.x=v.x,this.attrs.y=v.y,delete v.x,delete v.y,this._clearCache(O);var y=this._getAbsoluteTransform().copy();return y.invert(),y.translate(u.x,u.y),u={x:this.attrs.x+y.getTranslation().x,y:this.attrs.y+y.getTranslation().y},this._setTransform(v),this.setPosition({x:u.x,y:u.y}),this._clearCache(O),this._clearSelfAndDescendantCache(c),this},F.prototype._setTransform=function(u){var v;for(v in u)this.attrs[v]=u[v]},F.prototype._clearTransform=function(){var u={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,u},F.prototype.move=function(u){var v=u.x,y=u.y,x=this.x(),k=this.y();return v!==void 0&&(x+=v),y!==void 0&&(k+=y),this.setPosition({x,y:k}),this},F.prototype._eachAncestorReverse=function(u,v){var y=[],x=this.getParent(),k,V;if(!(v&&v._id===this._id)){for(y.unshift(this);x&&(!v||x._id!==v._id);)y.unshift(x),x=x.parent;for(k=y.length,V=0;V<k;V++)u(y[V])}},F.prototype.rotate=function(u){return this.rotation(this.rotation()+u),this},F.prototype.moveToTop=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var u=this.index;return this.parent.children.splice(u,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},F.prototype.moveUp=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveUp function is ignored."),!1;var u=this.index,v=this.parent.getChildren().length;return u<v-1?(this.parent.children.splice(u,1),this.parent.children.splice(u+1,0,this),this.parent._setChildrenIndices(),!0):!1},F.prototype.moveDown=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveDown function is ignored."),!1;var u=this.index;return u>0?(this.parent.children.splice(u,1),this.parent.children.splice(u-1,0,this),this.parent._setChildrenIndices(),!0):!1},F.prototype.moveToBottom=function(){if(!this.parent)return r.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var u=this.index;return u>0?(this.parent.children.splice(u,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},F.prototype.setZIndex=function(u){if(!this.parent)return r.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(u<0||u>=this.parent.children.length)&&r.Util.warn("Unexpected value "+u+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var v=this.index;return this.parent.children.splice(v,1),this.parent.children.splice(u,0,this),this.parent._setChildrenIndices(),this},F.prototype.getAbsoluteOpacity=function(){return this._getCache(b,this._getAbsoluteOpacity)},F.prototype._getAbsoluteOpacity=function(){var u=this.opacity(),v=this.getParent();return v&&!v._isUnderCache&&(u*=v.getAbsoluteOpacity()),u},F.prototype.moveTo=function(u){return this.getParent()!==u&&(this._remove(),u.add(this)),this},F.prototype.toObject=function(){var u={},v=this.getAttrs(),y,x,k,V,H;u.attrs={};for(y in v)x=v[y],H=r.Util.isObject(x)&&!r.Util._isPlainObject(x)&&!r.Util._isArray(x),!H&&(k=typeof this[y]=="function"&&this[y],delete v[y],V=k?k.call(this):null,v[y]=x,V!==x&&(u.attrs[y]=x));return u.className=this.getClassName(),r.Util._prepareToStringify(u)},F.prototype.toJSON=function(){return JSON.stringify(this.toObject())},F.prototype.getParent=function(){return this.parent},F.prototype.findAncestors=function(u,v,y){var x=[];v&&this._isMatch(u)&&x.push(this);for(var k=this.parent;k;){if(k===y)return x;k._isMatch(u)&&x.push(k),k=k.parent}return x},F.prototype.isAncestorOf=function(u){return!1},F.prototype.findAncestor=function(u,v,y){return this.findAncestors(u,v,y)[0]},F.prototype._isMatch=function(u){if(!u)return!1;if(typeof u=="function")return u(this);var v=u.replace(/ /g,"").split(","),y=v.length,x,k;for(x=0;x<y;x++)if(k=v[x],r.Util.isValidSelector(k)||(r.Util.warn('Selector "'+k+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),r.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),r.Util.warn("Konva is awesome, right?")),k.charAt(0)==="#"){if(this.id()===k.slice(1))return!0}else if(k.charAt(0)==="."){if(this.hasName(k.slice(1)))return!0}else if(this.className===k||this.nodeType===k)return!0;return!1},F.prototype.getLayer=function(){var u=this.getParent();return u?u.getLayer():null},F.prototype.getStage=function(){return this._getCache(M,this._getStage)},F.prototype._getStage=function(){var u=this.getParent();if(u)return u.getStage()},F.prototype.fire=function(u,v,y){return v===void 0&&(v={}),v.target=v.target||this,y?this._fireAndBubble(u,v):this._fire(u,v),this},F.prototype.getAbsoluteTransform=function(u){return u?this._getAbsoluteTransform(u):this._getCache(c,this._getAbsoluteTransform)},F.prototype._getAbsoluteTransform=function(u){var v;if(u)return v=new r.Transform,this._eachAncestorReverse(function(X){var rt=X.transformsEnabled();rt==="all"?v.multiply(X.getTransform()):rt==="position"&&v.translate(X.x()-X.offsetX(),X.y()-X.offsetY())},u),v;v=this._cache.get(c)||new r.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(v):v.reset();var y=this.transformsEnabled();if(y==="all")v.multiply(this.getTransform());else if(y==="position"){var x=this.attrs.x||0,k=this.attrs.y||0,V=this.attrs.offsetX||0,H=this.attrs.offsetY||0;v.translate(x-V,k-H)}return v.dirty=!1,v},F.prototype.getAbsoluteScale=function(u){for(var v=this;v;)v._isUnderCache&&(u=v),v=v.getParent();var y=this.getAbsoluteTransform(u),x=y.decompose();return{x:x.scaleX,y:x.scaleY}},F.prototype.getAbsoluteRotation=function(){return this.getAbsoluteTransform().decompose().rotation},F.prototype.getTransform=function(){return this._getCache(O,this._getTransform)},F.prototype._getTransform=function(){var u,v,y=this._cache.get(O)||new r.Transform;y.reset();var x=this.x(),k=this.y(),V=i.Konva.getAngle(this.rotation()),H=(u=this.attrs.scaleX)!==null&&u!==void 0?u:1,X=(v=this.attrs.scaleY)!==null&&v!==void 0?v:1,rt=this.attrs.skewX||0,lt=this.attrs.skewY||0,yt=this.attrs.offsetX||0,$t=this.attrs.offsetY||0;return(x!==0||k!==0)&&y.translate(x,k),V!==0&&y.rotate(V),(rt!==0||lt!==0)&&y.skew(rt,lt),(H!==1||X!==1)&&y.scale(H,X),(yt!==0||$t!==0)&&y.translate(-1*yt,-1*$t),y.dirty=!1,y},F.prototype.clone=function(u){var v=r.Util.cloneObject(this.attrs),y,x,k,V,H;for(y in u)v[y]=u[y];var X=new this.constructor(v);for(y in this.eventListeners)for(x=this.eventListeners[y],k=x.length,V=0;V<k;V++)H=x[V],H.name.indexOf(N)<0&&(X.eventListeners[y]||(X.eventListeners[y]=[]),X.eventListeners[y].push(H));return X},F.prototype._toKonvaCanvas=function(u){u=u||{};var v=this.getClientRect(),y=this.getStage(),x=u.x!==void 0?u.x:v.x,k=u.y!==void 0?u.y:v.y,V=u.pixelRatio||1,H=new e.SceneCanvas({width:u.width||v.width||(y?y.width():0),height:u.height||v.height||(y?y.height():0),pixelRatio:V}),X=H.getContext();return X.save(),(x||k)&&X.translate(-1*x,-1*k),this.drawScene(H),X.restore(),H},F.prototype.toCanvas=function(u){return this._toKonvaCanvas(u)._canvas},F.prototype.toDataURL=function(u){u=u||{};var v=u.mimeType||null,y=u.quality||null,x=this._toKonvaCanvas(u).toDataURL(v,y);return u.callback&&u.callback(x),x},F.prototype.toImage=function(u){if(!u||!u.callback)throw"callback required for toImage method config argument";var v=u.callback;delete u.callback,r.Util._urlToImage(this.toDataURL(u),function(y){v(y)})},F.prototype.setSize=function(u){return this.width(u.width),this.height(u.height),this},F.prototype.getSize=function(){return{width:this.width(),height:this.height()}},F.prototype.getClassName=function(){return this.className||this.nodeType},F.prototype.getType=function(){return this.nodeType},F.prototype.getDragDistance=function(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():i.Konva.dragDistance},F.prototype._off=function(u,v,y){var x=this.eventListeners[u],k,V,H;for(k=0;k<x.length;k++)if(V=x[k].name,H=x[k].handler,(V!=="konva"||v==="konva")&&(!v||V===v)&&(!y||y===H)){if(x.splice(k,1),x.length===0){delete this.eventListeners[u];break}k--}},F.prototype._fireChangeEvent=function(u,v,y){this._fire(u+T,{oldVal:v,newVal:y})},F.prototype.setId=function(u){var v=this.id();return n._removeId(v,this),s(this,u),this._setAttr("id",u),this},F.prototype.setName=function(u){var v=(this.name()||"").split(/\s/g),y=(u||"").split(/\s/g),x,k;for(k=0;k<v.length;k++)x=v[k],y.indexOf(x)===-1&&x&&n._removeName(x,this._id);for(k=0;k<y.length;k++)x=y[k],v.indexOf(x)===-1&&x&&n._addName(this,x);return this._setAttr(A,u),this},F.prototype.addName=function(u){if(!this.hasName(u)){var v=this.name(),y=v?v+" "+u:u;this.setName(y)}return this},F.prototype.hasName=function(u){if(!u)return!1;var v=this.name();if(!v)return!1;var y=(v||"").split(/\s/g);return y.indexOf(u)!==-1},F.prototype.removeName=function(u){var v=(this.name()||"").split(/\s/g),y=v.indexOf(u);return y!==-1&&(v.splice(y,1),this.setName(v.join(" "))),this},F.prototype.setAttr=function(u,v){var y=this[E+r.Util._capitalize(u)];return r.Util._isFunction(y)?y.call(this,v):this._setAttr(u,v),this},F.prototype._setAttr=function(u,v,y){var x=this.attrs[u];x===v&&!r.Util.isObject(v)||(v==null?delete this.attrs[u]:this.attrs[u]=v,this._shouldFireChangeEvents&&this._fireChangeEvent(u,x,v))},F.prototype._setComponentAttr=function(u,v,y){var x;y!==void 0&&(x=this.attrs[u],x||(this.attrs[u]=this.getAttr(u)),this.attrs[u][v]=y,this._fireChangeEvent(u,x,y))},F.prototype._fireAndBubble=function(u,v,y){v&&this.nodeType===C&&(v.target=this);var x=(u===p||u===m)&&(y&&(this===y||this.isAncestorOf&&this.isAncestorOf(y))||this.nodeType==="Stage"&&!y);if(!x){this._fire(u,v);var k=(u===p||u===m)&&y&&y.isAncestorOf&&y.isAncestorOf(this)&&!y.isAncestorOf(this.parent);(v&&!v.cancelBubble||!v)&&this.parent&&this.parent.isListening()&&!k&&(y&&y.parent?this._fireAndBubble.call(this.parent,u,v,y):this._fireAndBubble.call(this.parent,u,v))}},F.prototype._getProtoListeners=function(u){var v=this._cache.get(w);if(!v){v={};for(var y=Object.getPrototypeOf(this);y;){if(!y.eventListeners){y=Object.getPrototypeOf(y);continue}for(var x in y.eventListeners){var k=y.eventListeners[x],V=v[x]||[];v[x]=k.concat(V)}y=Object.getPrototypeOf(y)}this._cache.set(w,v)}return v[u]},F.prototype._fire=function(u,v){v=v||{},v.currentTarget=this,v.type=u;var y=this._getProtoListeners(u);if(y)for(var x=0;x<y.length;x++)y[x].handler.call(this,v);var k=this.eventListeners[u];if(k)for(var x=0;x<k.length;x++)k[x].handler.call(this,v)},F.prototype.draw=function(){return this.drawScene(),this.drawHit(),this},F.prototype._createDragElement=function(u){var v=u?u.pointerId:void 0,y=this.getStage(),x=this.getAbsolutePosition(),k=y._getPointerById(v)||y._changedPointerPositions[0]||x;a.DD._dragElements.set(this._id,{node:this,startPointerPos:k,offset:{x:k.x-x.x,y:k.y-x.y},dragStatus:"ready",pointerId:v})},F.prototype.startDrag=function(u,v){v===void 0&&(v=!0),a.DD._dragElements.has(this._id)||this._createDragElement(u);var y=a.DD._dragElements.get(this._id);y.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:u&&u.evt},v)},F.prototype._setDragPosition=function(u,v){var y=this.getStage()._getPointerById(v.pointerId);if(y){var x={x:y.x-v.offset.x,y:y.y-v.offset.y},k=this.dragBoundFunc();if(k!==void 0){var V=k.call(this,x,u);V?x=V:r.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==x.x||this._lastPos.y!==x.y)&&(this.setAbsolutePosition(x),this.getLayer()?this.getLayer().batchDraw():this.getStage()&&this.getStage().batchDraw()),this._lastPos=x}},F.prototype.stopDrag=function(u){var v=a.DD._dragElements.get(this._id);v&&(v.dragStatus="stopped"),a.DD._endDragBefore(u),a.DD._endDragAfter(u)},F.prototype.setDraggable=function(u){this._setAttr("draggable",u),this._dragChange()},F.prototype.isDragging=function(){var u=a.DD._dragElements.get(this._id);return u?u.dragStatus==="dragging":!1},F.prototype._listenDrag=function(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(u){var v=this,y=u.evt.button!==void 0,x=!y||i.Konva.dragButtons.indexOf(u.evt.button)>=0;if(x&&!this.isDragging()){var k=!1;a.DD._dragElements.forEach(function(V){v.isAncestorOf(V.node)&&(k=!0)}),k||this._createDragElement(u)}})},F.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var u=this.getStage();if(!u)return;var v=a.DD._dragElements.get(this._id),y=v&&v.dragStatus==="dragging",x=v&&v.dragStatus==="ready";y?this.stopDrag():x&&a.DD._dragElements.delete(this._id)}},F.prototype._dragCleanup=function(){this.off("mousedown.konva"),this.off("touchstart.konva")},F.create=function(u,v){return r.Util._isString(u)&&(u=JSON.parse(u)),this._createNode(u,v)},F._createNode=function(u,v){var y=F.prototype.getClassName.call(u),x=u.children,k,V,H;v&&(u.attrs.container=v),i._NODES_REGISTRY[y]||(r.Util.warn('Can not find a node with class name "'+y+'". Fallback to "Shape".'),y="Shape");var X=i._NODES_REGISTRY[y];if(k=new X(u.attrs),x)for(V=x.length,H=0;H<V;H++)k.add(F._createNode(x[H]));return k},F}();n.Node=U,U.prototype.nodeType="Node",U.prototype._attrsAffectingSize=[],U.prototype.eventListeners={},U.prototype.on.call(U.prototype,I,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(O),this._clearSelfAndDescendantCache(c)}),U.prototype.on.call(U.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(D)}),U.prototype.on.call(U.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(d)}),U.prototype.on.call(U.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(b)});var z=t.Factory.addGetterSetter;z(U,"zIndex"),z(U,"absolutePosition"),z(U,"position"),z(U,"x",0,o.getNumberValidator()),z(U,"y",0,o.getNumberValidator()),z(U,"globalCompositeOperation","source-over",o.getStringValidator()),z(U,"opacity",1,o.getNumberValidator()),z(U,"name","",o.getStringValidator()),z(U,"id","",o.getStringValidator()),z(U,"rotation",0,o.getNumberValidator()),t.Factory.addComponentsGetterSetter(U,"scale",["x","y"]),z(U,"scaleX",1,o.getNumberValidator()),z(U,"scaleY",1,o.getNumberValidator()),t.Factory.addComponentsGetterSetter(U,"skew",["x","y"]),z(U,"skewX",0,o.getNumberValidator()),z(U,"skewY",0,o.getNumberValidator()),t.Factory.addComponentsGetterSetter(U,"offset",["x","y"]),z(U,"offsetX",0,o.getNumberValidator()),z(U,"offsetY",0,o.getNumberValidator()),z(U,"dragDistance",null,o.getNumberValidator()),z(U,"width",0,o.getNumberValidator()),z(U,"height",0,o.getNumberValidator()),z(U,"listening",!0,o.getBooleanValidator()),z(U,"preventDefault",!0,o.getBooleanValidator()),z(U,"filters",null,function(F){return this._filterUpToDate=!1,F}),z(U,"visible",!0,o.getBooleanValidator()),z(U,"transformsEnabled","all",o.getStringValidator()),z(U,"size"),z(U,"dragBoundFunc"),z(U,"draggable",!1,o.getBooleanValidator()),t.Factory.backCompat(U,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),r.Collection.mapMethods(U)})(st);var jt={},Ka=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(jt,"__esModule",{value:!0});jt.Container=void 0;var Bt=et,re=Q,Ar=st,Le=W,Dt=function(n){Ka(r,n);function r(){var t=n!==null&&n.apply(this,arguments)||this;return t.children=new Bt.Collection,t}return r.prototype.getChildren=function(t){if(!t)return this.children;var e=new Bt.Collection;return this.children.each(function(i){t(i)&&e.push(i)}),e},r.prototype.hasChildren=function(){return this.getChildren().length>0},r.prototype.removeChildren=function(){for(var t,e=0;e<this.children.length;e++)t=this.children[e],t.parent=null,t.index=0,t.remove();return this.children=new Bt.Collection,this},r.prototype.destroyChildren=function(){for(var t,e=0;e<this.children.length;e++)t=this.children[e],t.parent=null,t.index=0,t.destroy();return this.children=new Bt.Collection,this},r.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(arguments.length>1){for(var i=0;i<arguments.length;i++)this.add(arguments[i]);return this}var a=t[0];if(a.getParent())return a.moveTo(this),this;var o=this.children;return this._validateAdd(a),a._clearCaches(),a.index=o.length,a.parent=this,o.push(a),this._fire("add",{child:a}),this},r.prototype.destroy=function(){return this.hasChildren()&&this.destroyChildren(),n.prototype.destroy.call(this),this},r.prototype.find=function(t){return this._generalFind(t,!1)},r.prototype.get=function(t){return Bt.Util.warn("collection.get() method is deprecated. Please use collection.find() instead."),this.find(t)},r.prototype.findOne=function(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0},r.prototype._generalFind=function(t,e){var i=[];return this._descendants(function(a){var o=a._isMatch(t);return o&&i.push(a),!!(o&&e)}),Bt.Collection.toCollection(i)},r.prototype._descendants=function(t){for(var e=!1,i=0;i<this.children.length;i++){var a=this.children[i];if(e=t(a),e)return!0;if(a.hasChildren()&&(e=a._descendants(t),e))return!0}return!1},r.prototype.toObject=function(){var t=Ar.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),i=e.length,a=0;a<i;a++){var o=e[a];t.children.push(o.toObject())}return t},r.prototype.isAncestorOf=function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},r.prototype.clone=function(t){var e=Ar.Node.prototype.clone.call(this,t);return this.getChildren().each(function(i){e.add(i.clone())}),e},r.prototype.getAllIntersections=function(t){var e=[];return this.find("Shape").each(function(i){i.isVisible()&&i.intersects(t)&&e.push(i)}),e},r.prototype._setChildrenIndices=function(){this.children.each(function(t,e){t.index=e})},r.prototype.drawScene=function(t,e){var i=this.getLayer(),a=t||i&&i.getCanvas(),o=a&&a.getContext(),s=this._getCanvasCache(),l=s&&s.scene,h=a&&a.isCache;if(!this.isVisible()&&!h)return this;if(l){o.save();var f=this.getAbsoluteTransform(e).getMatrix();o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",a,e);return this},r.prototype.drawHit=function(t,e){if(!this.shouldDrawHit(e))return this;var i=this.getLayer(),a=t||i&&i.hitCanvas,o=a&&a.getContext(),s=this._getCanvasCache(),l=s&&s.hit;if(l){o.save();var h=this.getAbsoluteTransform(e).getMatrix();o.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedHitCanvas(o),o.restore()}else this._drawChildren("drawHit",a,e);return this},r.prototype._drawChildren=function(t,e,i){var a=e&&e.getContext(),o=this.clipWidth(),s=this.clipHeight(),l=this.clipFunc(),h=o&&s||l,f=i===this;if(h){a.save();var b=this.getAbsoluteTransform(i),w=b.getMatrix();if(a.transform(w[0],w[1],w[2],w[3],w[4],w[5]),a.beginPath(),l)l.call(this,a,this);else{var c=this.clipX(),_=this.clipY();a.rect(c,_,o,s)}a.clip(),w=b.copy().invert().getMatrix(),a.transform(w[0],w[1],w[2],w[3],w[4],w[5])}var g=!f&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";g&&(a.save(),a._applyGlobalCompositeOperation(this)),this.children.each(function(T){T[t](e,i)}),g&&a.restore(),h&&a.restore()},r.prototype.getClientRect=function(t){t=t||{};var e=t.skipTransform,i=t.relativeTo,a,o,s,l,h={x:1/0,y:1/0,width:0,height:0},f=this;this.children.each(function(g){if(g.visible()){var T=g.getClientRect({relativeTo:f,skipShadow:t.skipShadow,skipStroke:t.skipStroke});T.width===0&&T.height===0||(a===void 0?(a=T.x,o=T.y,s=T.x+T.width,l=T.y+T.height):(a=Math.min(a,T.x),o=Math.min(o,T.y),s=Math.max(s,T.x+T.width),l=Math.max(l,T.y+T.height)))}});for(var b=this.find("Shape"),w=!1,c=0;c<b.length;c++){var _=b[c];if(_._isVisible(this)){w=!0;break}}return w&&a!==void 0?h={x:a,y:o,width:s-a,height:l-o}:h={x:0,y:0,width:0,height:0},e?h:this._transformedRect(h,i)},r}(Ar.Node);jt.Container=Dt;re.Factory.addComponentsGetterSetter(Dt,"clip",["x","y","width","height"]);re.Factory.addGetterSetter(Dt,"clipX",void 0,Le.getNumberValidator());re.Factory.addGetterSetter(Dt,"clipY",void 0,Le.getNumberValidator());re.Factory.addGetterSetter(Dt,"clipWidth",void 0,Le.getNumberValidator());re.Factory.addGetterSetter(Dt,"clipHeight",void 0,Le.getNumberValidator());re.Factory.addGetterSetter(Dt,"clipFunc");Bt.Collection.mapMethods(Dt);var Ni={},_t={};Object.defineProperty(_t,"__esModule",{value:!0});_t.releaseCapture=_t.setPointerCapture=_t.hasPointerCapture=_t.createEvent=_t.getCapturedShape=void 0;var Ya=J,fe=new Map,Gi=Ya.Konva._global.PointerEvent!==void 0;function Xa(n){return fe.get(n)}_t.getCapturedShape=Xa;function Hr(n){return{evt:n,pointerId:n.pointerId}}_t.createEvent=Hr;function qa(n,r){return fe.get(n)===r}_t.hasPointerCapture=qa;function Qa(n,r){Ri(n);var t=r.getStage();t&&(fe.set(n,r),Gi&&r._fire("gotpointercapture",Hr(new PointerEvent("gotpointercapture"))))}_t.setPointerCapture=Qa;function Ri(n,r){var t=fe.get(n);if(t){var e=t.getStage();e&&e.content,fe.delete(n),Gi&&t._fire("lostpointercapture",Hr(new PointerEvent("lostpointercapture")))}}_t.releaseCapture=Ri;(function(n){var r=Y&&Y.__extends||function(){var ft=function(K,S){return ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,$){L.__proto__=$}||function(L,$){for(var q in $)Object.prototype.hasOwnProperty.call($,q)&&(L[q]=$[q])},ft(K,S)};return function(K,S){ft(K,S);function L(){this.constructor=K}K.prototype=S===null?Object.create(S):(L.prototype=S.prototype,new L)}}();Object.defineProperty(n,"__esModule",{value:!0}),n.Stage=n.stages=void 0;var t=et,e=Q,i=jt,a=J,o=St,s=De,l=J,h=_t,f="Stage",b="string",w="px",c="mouseout",_="mouseleave",g="mouseover",T="mouseenter",P="mousemove",N="mousedown",d="mouseup",p="pointermove",m="pointerdown",A="pointerup",E="pointercancel",C="lostpointercapture",G="contextmenu",M="click",O="dblclick",R="touchstart",D="touchend",I="tap",j="dbltap",B="touchmove",U="wheel",z="contentMouseout",F="contentMouseover",u="contentMousemove",v="contentMousedown",y="contentMouseup",x="contentContextmenu",k="contentClick",V="contentDblclick",H="contentTouchstart",X="contentTouchend",rt="contentDbltap",lt="contentTap",yt="contentTouchmove",$t="contentWheel",qt="relative",vt="konvajs-content",se="_",fa="container",ca=5,pa="",ei=[T,N,P,d,_,R,B,D,g,U,G,m,p,A,E,C],ga=ei.length;function va(ft,K){ft.content.addEventListener(K,function(S){ft[se+K](S)},!1)}var _a="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";n.stages=[];function ri(ft){return ft===void 0&&(ft={}),(ft.clipFunc||ft.clipWidth||ft.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),ft}var me=function(ft){r(K,ft);function K(S){var L=ft.call(this,ri(S))||this;return L._pointerPositions=[],L._changedPointerPositions=[],L._buildDOM(),L._bindContentEvents(),n.stages.push(L),L.on("widthChange.konva heightChange.konva",L._resizeDOM),L.on("visibleChange.konva",L._checkVisibility),L.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",function(){ri(L.attrs)}),L._checkVisibility(),L}return K.prototype._validateAdd=function(S){var L=S.getType()==="Layer",$=S.getType()==="FastLayer",q=L||$;q||t.Util.throw("You may only add layers to the stage.")},K.prototype._checkVisibility=function(){if(this.content){var S=this.visible()?"":"none";this.content.style.display=S}},K.prototype.setContainer=function(S){if(typeof S===b){if(S.charAt(0)==="."){var L=S.slice(1);S=document.getElementsByClassName(L)[0]}else{var $;S.charAt(0)!=="#"?$=S:$=S.slice(1),S=document.getElementById($)}if(!S)throw"Can not find container in document with id "+$}return this._setAttr(fa,S),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),S.appendChild(this.content)),this},K.prototype.shouldDrawHit=function(){return!0},K.prototype.clear=function(){var S=this.children,L=S.length,$;for($=0;$<L;$++)S[$].clear();return this},K.prototype.clone=function(S){return S||(S={}),S.container=document.createElement("div"),i.Container.prototype.clone.call(this,S)},K.prototype.destroy=function(){ft.prototype.destroy.call(this);var S=this.content;S&&t.Util._isInDocument(S)&&this.container().removeChild(S);var L=n.stages.indexOf(this);return L>-1&&n.stages.splice(L,1),this},K.prototype.getPointerPosition=function(){var S=this._pointerPositions[0]||this._changedPointerPositions[0];return S?{x:S.x,y:S.y}:(t.Util.warn(_a),null)},K.prototype._getPointerById=function(S){return this._pointerPositions.find(function(L){return L.id===S})},K.prototype.getPointersPositions=function(){return this._pointerPositions},K.prototype.getStage=function(){return this},K.prototype.getContent=function(){return this.content},K.prototype._toKonvaCanvas=function(S){S=S||{},S.x=S.x||0,S.y=S.y||0,S.width=S.width||this.width(),S.height=S.height||this.height();var L=new o.SceneCanvas({width:S.width,height:S.height,pixelRatio:S.pixelRatio||1}),$=L.getContext()._context,q=this.children;return(S.x||S.y)&&$.translate(-1*S.x,-1*S.y),q.each(function(Z){if(Z.isVisible()){var tt=Z._toKonvaCanvas(S);$.drawImage(tt._canvas,S.x,S.y,tt.getWidth()/tt.getPixelRatio(),tt.getHeight()/tt.getPixelRatio())}}),L},K.prototype.getIntersection=function(S,L){if(!S)return null;var $=this.children,q=$.length,Z=q-1,tt,ct;for(tt=Z;tt>=0;tt--)if(ct=$[tt].getIntersection(S,L),ct)return ct;return null},K.prototype._resizeDOM=function(){var S=this.width(),L=this.height();this.content&&(this.content.style.width=S+w,this.content.style.height=L+w),this.bufferCanvas.setSize(S,L),this.bufferHitCanvas.setSize(S,L),this.children.each(function($){$.setSize({width:S,height:L}),$.draw()})},K.prototype.add=function(S){if(arguments.length>1){for(var L=0;L<arguments.length;L++)this.add(arguments[L]);return this}ft.prototype.add.call(this,S);var $=this.children.length;return $>ca&&t.Util.warn("The stage has "+$+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),S.setSize({width:this.width(),height:this.height()}),S.draw(),a.Konva.isBrowser&&this.content.appendChild(S.canvas._canvas),this},K.prototype.getParent=function(){return null},K.prototype.getLayer=function(){return null},K.prototype.hasPointerCapture=function(S){return h.hasPointerCapture(S,this)},K.prototype.setPointerCapture=function(S){h.setPointerCapture(S,this)},K.prototype.releaseCapture=function(S){h.releaseCapture(S,this)},K.prototype.getLayers=function(){return this.getChildren()},K.prototype._bindContentEvents=function(){if(a.Konva.isBrowser)for(var S=0;S<ga;S++)va(this,ei[S])},K.prototype._mouseenter=function(S){this.setPointersPositions(S),this._fire(T,{evt:S,target:this,currentTarget:this})},K.prototype._mouseover=function(S){this.setPointersPositions(S),this._fire(F,{evt:S}),this._fire(g,{evt:S,target:this,currentTarget:this})},K.prototype._mouseleave=function(S){var L;this.setPointersPositions(S);var $=!((L=this.targetShape)===null||L===void 0)&&L.getStage()?this.targetShape:null,q=!s.DD.isDragging||a.Konva.hitOnDragEnabled;$&&q?($._fireAndBubble(c,{evt:S}),$._fireAndBubble(_,{evt:S}),this._fire(_,{evt:S,target:this,currentTarget:this}),this.targetShape=null):q&&(this._fire(_,{evt:S,target:this,currentTarget:this}),this._fire(c,{evt:S,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[],this._fire(z,{evt:S})},K.prototype._mousemove=function(S){var L;if(a.Konva.UA.ieMobile)return this._touchmove(S);this.setPointersPositions(S);var $=t.Util._getFirstPointerId(S),q,Z=!((L=this.targetShape)===null||L===void 0)&&L.getStage()?this.targetShape:null,tt=!s.DD.isDragging||a.Konva.hitOnDragEnabled;if(tt){if(q=this.getIntersection(this.getPointerPosition()),q&&q.isListening()){var ct=Z!==q;tt&&ct?(Z&&(Z._fireAndBubble(c,{evt:S,pointerId:$},q),Z._fireAndBubble(_,{evt:S,pointerId:$},q)),q._fireAndBubble(g,{evt:S,pointerId:$},Z),q._fireAndBubble(T,{evt:S,pointerId:$},Z),q._fireAndBubble(P,{evt:S,pointerId:$}),this.targetShape=q):q._fireAndBubble(P,{evt:S,pointerId:$})}else Z&&tt&&(Z._fireAndBubble(c,{evt:S,pointerId:$}),Z._fireAndBubble(_,{evt:S,pointerId:$}),this._fire(g,{evt:S,target:this,currentTarget:this,pointerId:$}),this.targetShape=null),this._fire(P,{evt:S,target:this,currentTarget:this,pointerId:$});this._fire(u,{evt:S})}S.cancelable&&S.preventDefault()},K.prototype._mousedown=function(S){if(a.Konva.UA.ieMobile)return this._touchstart(S);this.setPointersPositions(S);var L=t.Util._getFirstPointerId(S),$=this.getIntersection(this.getPointerPosition());s.DD.justDragged=!1,a.Konva.listenClickTap=!0,$&&$.isListening()?(this.clickStartShape=$,$._fireAndBubble(N,{evt:S,pointerId:L})):this._fire(N,{evt:S,target:this,currentTarget:this,pointerId:L}),this._fire(v,{evt:S})},K.prototype._mouseup=function(S){if(a.Konva.UA.ieMobile)return this._touchend(S);this.setPointersPositions(S);var L=t.Util._getFirstPointerId(S),$=this.getIntersection(this.getPointerPosition()),q=this.clickStartShape,Z=this.clickEndShape,tt=!1;a.Konva.inDblClickWindow?(tt=!0,clearTimeout(this.dblTimeout)):s.DD.justDragged||(a.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){a.Konva.inDblClickWindow=!1},a.Konva.dblClickWindow),$&&$.isListening()?(this.clickEndShape=$,$._fireAndBubble(d,{evt:S,pointerId:L}),a.Konva.listenClickTap&&q&&q._id===$._id&&($._fireAndBubble(M,{evt:S,pointerId:L}),tt&&Z&&Z===$&&$._fireAndBubble(O,{evt:S,pointerId:L}))):(this.clickEndShape=null,this._fire(d,{evt:S,target:this,currentTarget:this,pointerId:L}),a.Konva.listenClickTap&&this._fire(M,{evt:S,target:this,currentTarget:this,pointerId:L}),tt&&this._fire(O,{evt:S,target:this,currentTarget:this,pointerId:L})),this._fire(y,{evt:S}),a.Konva.listenClickTap&&(this._fire(k,{evt:S}),tt&&this._fire(V,{evt:S})),a.Konva.listenClickTap=!1,S.cancelable&&S.preventDefault()},K.prototype._contextmenu=function(S){this.setPointersPositions(S);var L=this.getIntersection(this.getPointerPosition());L&&L.isListening()?L._fireAndBubble(G,{evt:S}):this._fire(G,{evt:S,target:this,currentTarget:this}),this._fire(x,{evt:S})},K.prototype._touchstart=function(S){var L=this;this.setPointersPositions(S);var $=!1;this._changedPointerPositions.forEach(function(q){var Z=L.getIntersection(q);a.Konva.listenClickTap=!0,s.DD.justDragged=!1;var tt=Z&&Z.isListening();tt&&(a.Konva.captureTouchEventsEnabled&&Z.setPointerCapture(q.id),L.tapStartShape=Z,Z._fireAndBubble(R,{evt:S,pointerId:q.id},L),$=!0,Z.isListening()&&Z.preventDefault()&&S.cancelable&&S.preventDefault())}),$||this._fire(R,{evt:S,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(H,{evt:S})},K.prototype._touchmove=function(S){var L=this;this.setPointersPositions(S);var $=!s.DD.isDragging||a.Konva.hitOnDragEnabled;if($){var q=!1,Z={};this._changedPointerPositions.forEach(function(tt){var ct=h.getCapturedShape(tt.id)||L.getIntersection(tt),Se=ct&&ct.isListening();Se&&(Z[ct._id]||(Z[ct._id]=!0,ct._fireAndBubble(B,{evt:S,pointerId:tt.id}),q=!0,ct.isListening()&&ct.preventDefault()&&S.cancelable&&S.preventDefault()))}),q||this._fire(B,{evt:S,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(yt,{evt:S})}s.DD.isDragging&&s.DD.node.preventDefault()&&S.cancelable&&S.preventDefault()},K.prototype._touchend=function(S){var L=this;this.setPointersPositions(S);var $=this.tapEndShape,q=!1;a.Konva.inDblClickWindow?(q=!0,clearTimeout(this.dblTimeout)):s.DD.justDragged||(a.Konva.inDblClickWindow=!0,clearTimeout(this.dblTimeout)),this.dblTimeout=setTimeout(function(){a.Konva.inDblClickWindow=!1},a.Konva.dblClickWindow);var Z=!1,tt={},ct=!1,Se=!1;this._changedPointerPositions.forEach(function(Qt){var gt=h.getCapturedShape(Qt.id)||L.getIntersection(Qt);gt&&gt.releaseCapture(Qt.id);var ya=gt&&gt.isListening();ya&&(tt[gt._id]||(tt[gt._id]=!0,L.tapEndShape=gt,gt._fireAndBubble(D,{evt:S,pointerId:Qt.id}),Z=!0,a.Konva.listenClickTap&&gt===L.tapStartShape&&(ct=!0,gt._fireAndBubble(I,{evt:S,pointerId:Qt.id}),q&&$&&$===gt&&(Se=!0,gt._fireAndBubble(j,{evt:S,pointerId:Qt.id}))),gt.isListening()&&gt.preventDefault()&&S.cancelable&&S.preventDefault()))}),Z||this._fire(D,{evt:S,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),a.Konva.listenClickTap&&!ct&&(this.tapEndShape=null,this._fire(I,{evt:S,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})),q&&!Se&&this._fire(j,{evt:S,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),this._fire(X,{evt:S}),a.Konva.listenClickTap&&(this._fire(lt,{evt:S}),q&&this._fire(rt,{evt:S})),this.preventDefault()&&S.cancelable&&S.preventDefault(),a.Konva.listenClickTap=!1},K.prototype._wheel=function(S){this.setPointersPositions(S);var L=this.getIntersection(this.getPointerPosition());L&&L.isListening()?L._fireAndBubble(U,{evt:S}):this._fire(U,{evt:S,target:this,currentTarget:this}),this._fire($t,{evt:S})},K.prototype._pointerdown=function(S){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(S);var L=h.getCapturedShape(S.pointerId)||this.getIntersection(this.getPointerPosition());L&&L._fireAndBubble(m,h.createEvent(S))}},K.prototype._pointermove=function(S){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(S);var L=h.getCapturedShape(S.pointerId)||this.getIntersection(this.getPointerPosition());L&&L._fireAndBubble(p,h.createEvent(S))}},K.prototype._pointerup=function(S){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(S);var L=h.getCapturedShape(S.pointerId)||this.getIntersection(this.getPointerPosition());L&&L._fireAndBubble(A,h.createEvent(S)),h.releaseCapture(S.pointerId)}},K.prototype._pointercancel=function(S){if(a.Konva._pointerEventsEnabled){this.setPointersPositions(S);var L=h.getCapturedShape(S.pointerId)||this.getIntersection(this.getPointerPosition());L&&L._fireAndBubble(A,h.createEvent(S)),h.releaseCapture(S.pointerId)}},K.prototype._lostpointercapture=function(S){h.releaseCapture(S.pointerId)},K.prototype.setPointersPositions=function(S){var L=this,$=this._getContentPosition(),q=null,Z=null;S=S||window.event,S.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],t.Collection.prototype.each.call(S.touches,function(tt){L._pointerPositions.push({id:tt.identifier,x:(tt.clientX-$.left)/$.scaleX,y:(tt.clientY-$.top)/$.scaleY})}),t.Collection.prototype.each.call(S.changedTouches||S.touches,function(tt){L._changedPointerPositions.push({id:tt.identifier,x:(tt.clientX-$.left)/$.scaleX,y:(tt.clientY-$.top)/$.scaleY})})):(q=(S.clientX-$.left)/$.scaleX,Z=(S.clientY-$.top)/$.scaleY,this.pointerPos={x:q,y:Z},this._pointerPositions=[{x:q,y:Z,id:t.Util._getFirstPointerId(S)}],this._changedPointerPositions=[{x:q,y:Z,id:t.Util._getFirstPointerId(S)}])},K.prototype._setPointerPosition=function(S){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(S)},K.prototype._getContentPosition=function(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var S=this.content.getBoundingClientRect();return{top:S.top,left:S.left,scaleX:S.width/this.content.clientWidth||1,scaleY:S.height/this.content.clientHeight||1}},K.prototype._buildDOM=function(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!a.Konva.isBrowser){var S=this.container();if(!S)throw"Stage has no container. A container is required.";S.innerHTML=pa,this.content=document.createElement("div"),this.content.style.position=qt,this.content.style.userSelect="none",this.content.className=vt,this.content.setAttribute("role","presentation"),S.appendChild(this.content),this._resizeDOM()}},K.prototype.cache=function(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this},K.prototype.clearCache=function(){return this},K.prototype.batchDraw=function(){return this.children.each(function(S){S.batchDraw()}),this},K}(i.Container);n.Stage=me,me.prototype.nodeType=f,l._registerNode(me),e.Factory.addGetterSetter(me,"container")})(Ni);var pe={},dt={};(function(n){var r=Y&&Y.__extends||function(){var G=function(M,O){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,D){R.__proto__=D}||function(R,D){for(var I in D)Object.prototype.hasOwnProperty.call(D,I)&&(R[I]=D[I])},G(M,O)};return function(M,O){G(M,O);function R(){this.constructor=M}M.prototype=O===null?Object.create(O):(R.prototype=O.prototype,new R)}}();Object.defineProperty(n,"__esModule",{value:!0}),n.Shape=n.shapes=void 0;var t=et,e=Q,i=st,a=W,o=J,s=_t,l="hasShadow",h="shadowRGBA",f="patternImage",b="linearGradient",w="radialGradient",c;function _(){return c||(c=t.Util.createCanvasElement().getContext("2d"),c)}n.shapes={};function g(G){G.fill()}function T(G){G.stroke()}function P(G){G.fill()}function N(G){G.stroke()}function d(){this._clearCache(l)}function p(){this._clearCache(h)}function m(){this._clearCache(f)}function A(){this._clearCache(b)}function E(){this._clearCache(w)}var C=function(G){r(M,G);function M(O){for(var R=G.call(this,O)||this,D;D=t.Util.getRandomColor(),!(D&&!(D in n.shapes)););return R.colorKey=D,n.shapes[D]=R,R}return M.prototype.getContext=function(){return this.getLayer().getContext()},M.prototype.getCanvas=function(){return this.getLayer().getCanvas()},M.prototype.getSceneFunc=function(){return this.attrs.sceneFunc||this._sceneFunc},M.prototype.getHitFunc=function(){return this.attrs.hitFunc||this._hitFunc},M.prototype.hasShadow=function(){return this._getCache(l,this._hasShadow)},M.prototype._hasShadow=function(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())},M.prototype._getFillPattern=function(){return this._getCache(f,this.__getFillPattern)},M.prototype.__getFillPattern=function(){if(this.fillPatternImage()){var O=_(),R=O.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");return R&&R.setTransform&&R.setTransform({a:this.fillPatternScaleX(),b:0,c:0,d:this.fillPatternScaleY(),e:0,f:0}),R}},M.prototype._getLinearGradient=function(){return this._getCache(b,this.__getLinearGradient)},M.prototype.__getLinearGradient=function(){var O=this.fillLinearGradientColorStops();if(O){for(var R=_(),D=this.fillLinearGradientStartPoint(),I=this.fillLinearGradientEndPoint(),j=R.createLinearGradient(D.x,D.y,I.x,I.y),B=0;B<O.length;B+=2)j.addColorStop(O[B],O[B+1]);return j}},M.prototype._getRadialGradient=function(){return this._getCache(w,this.__getRadialGradient)},M.prototype.__getRadialGradient=function(){var O=this.fillRadialGradientColorStops();if(O){for(var R=_(),D=this.fillRadialGradientStartPoint(),I=this.fillRadialGradientEndPoint(),j=R.createRadialGradient(D.x,D.y,this.fillRadialGradientStartRadius(),I.x,I.y,this.fillRadialGradientEndRadius()),B=0;B<O.length;B+=2)j.addColorStop(O[B],O[B+1]);return j}},M.prototype.getShadowRGBA=function(){return this._getCache(h,this._getShadowRGBA)},M.prototype._getShadowRGBA=function(){if(this.hasShadow()){var O=t.Util.colorToRGBA(this.shadowColor());return"rgba("+O.r+","+O.g+","+O.b+","+O.a*(this.shadowOpacity()||1)+")"}},M.prototype.hasFill=function(){var O=this;return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],function(){return O.fillEnabled()&&!!(O.fill()||O.fillPatternImage()||O.fillLinearGradientColorStops()||O.fillRadialGradientColorStops())})},M.prototype.hasStroke=function(){var O=this;return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],function(){return O.strokeEnabled()&&O.strokeWidth()&&!!(O.stroke()||O.strokeLinearGradientColorStops())})},M.prototype.hasHitStroke=function(){var O=this.hitStrokeWidth();return O==="auto"?this.hasStroke():this.strokeEnabled()&&!!O},M.prototype.intersects=function(O){var R=this.getStage(),D=R.bufferHitCanvas,I;return D.getContext().clear(),this.drawHit(D,null,!0),I=D.context.getImageData(Math.round(O.x),Math.round(O.y),1,1).data,I[3]>0},M.prototype.destroy=function(){return i.Node.prototype.destroy.call(this),delete n.shapes[this.colorKey],delete this.colorKey,this},M.prototype._useBufferCanvas=function(O){var R;if(!this.getStage())return!1;var D=(R=this.attrs.perfectDrawEnabled)!==null&&R!==void 0?R:!0;if(!D)return!1;var I=O||this.hasFill(),j=this.hasStroke(),B=this.getAbsoluteOpacity()!==1;if(I&&j&&B)return!0;var U=this.hasShadow(),z=this.shadowForStrokeEnabled();return!!(I&&j&&U&&z)},M.prototype.setStrokeHitEnabled=function(O){t.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),O?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)},M.prototype.getStrokeHitEnabled=function(){return this.hitStrokeWidth()!==0},M.prototype.getSelfRect=function(){var O=this.size();return{x:this._centroid?-O.width/2:0,y:this._centroid?-O.height/2:0,width:O.width,height:O.height}},M.prototype.getClientRect=function(O){O===void 0&&(O={});var R=O.skipTransform,D=O.relativeTo,I=this.getSelfRect(),j=!O.skipStroke&&this.hasStroke(),B=j&&this.strokeWidth()||0,U=I.width+B,z=I.height+B,F=!O.skipShadow&&this.hasShadow(),u=F?this.shadowOffsetX():0,v=F?this.shadowOffsetY():0,y=U+Math.abs(u),x=z+Math.abs(v),k=F&&this.shadowBlur()||0,V=y+k*2,H=x+k*2,X=0;Math.round(B/2)!==B/2&&(X=1);var rt={width:V+X,height:H+X,x:-Math.round(B/2+k)+Math.min(u,0)+I.x,y:-Math.round(B/2+k)+Math.min(v,0)+I.y};return R?rt:this._transformedRect(rt,D)},M.prototype.drawScene=function(O,R){var D=this.getLayer(),I=O||D.getCanvas(),j=I.getContext(),B=this._getCanvasCache(),U=this.getSceneFunc(),z=this.hasShadow(),F,u,v,y=I.isCache,x=I.isCache,k=R===this;if(!this.isVisible()&&!y)return this;if(B){j.save();var V=this.getAbsoluteTransform(R).getMatrix();return j.transform(V[0],V[1],V[2],V[3],V[4],V[5]),this._drawCachedSceneCanvas(j),j.restore(),this}if(!U)return this;if(j.save(),this._useBufferCanvas()&&!x){F=this.getStage(),u=F.bufferCanvas,v=u.getContext(),v.clear(),v.save(),v._applyLineJoin(this);var H=this.getAbsoluteTransform(R).getMatrix();v.transform(H[0],H[1],H[2],H[3],H[4],H[5]),U.call(this,v,this),v.restore();var X=u.pixelRatio;z&&j._applyShadow(this),j._applyOpacity(this),j._applyGlobalCompositeOperation(this),j.drawImage(u._canvas,0,0,u.width/X,u.height/X)}else{if(j._applyLineJoin(this),!k){var H=this.getAbsoluteTransform(R).getMatrix();j.transform(H[0],H[1],H[2],H[3],H[4],H[5]),j._applyOpacity(this),j._applyGlobalCompositeOperation(this)}z&&j._applyShadow(this),U.call(this,j,this)}return j.restore(),this},M.prototype.drawHit=function(O,R,D){if(D===void 0&&(D=!1),!this.shouldDrawHit(R,D))return this;var I=this.getLayer(),j=O||I.hitCanvas,B=j&&j.getContext(),U=this.hitFunc()||this.sceneFunc(),z=this._getCanvasCache(),F=z&&z.hit;if(this.colorKey||(console.log(this),t.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()")),F){B.save();var u=this.getAbsoluteTransform(R).getMatrix();return B.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this._drawCachedHitCanvas(B),B.restore(),this}if(!U)return this;B.save(),B._applyLineJoin(this);var v=this===R;if(!v){var y=this.getAbsoluteTransform(R).getMatrix();B.transform(y[0],y[1],y[2],y[3],y[4],y[5])}return U.call(this,B,this),B.restore(),this},M.prototype.drawHitFromCache=function(O){O===void 0&&(O=0);var R=this._getCanvasCache(),D=this._getCachedSceneCanvas(),I=R.hit,j=I.getContext(),B=I.getWidth(),U=I.getHeight(),z,F,u,v,y,x;j.clear(),j.drawImage(D._canvas,0,0,B,U);try{for(z=j.getImageData(0,0,B,U),F=z.data,u=F.length,v=t.Util._hexToRgb(this.colorKey),y=0;y<u;y+=4)x=F[y+3],x>O?(F[y]=v.r,F[y+1]=v.g,F[y+2]=v.b,F[y+3]=255):F[y+3]=0;j.putImageData(z,0,0)}catch(k){t.Util.error("Unable to draw hit graph from cached scene canvas. "+k.message)}return this},M.prototype.hasPointerCapture=function(O){return s.hasPointerCapture(O,this)},M.prototype.setPointerCapture=function(O){s.setPointerCapture(O,this)},M.prototype.releaseCapture=function(O){s.releaseCapture(O,this)},M}(i.Node);n.Shape=C,C.prototype._fillFunc=g,C.prototype._strokeFunc=T,C.prototype._fillFuncHit=P,C.prototype._strokeFuncHit=N,C.prototype._centroid=!1,C.prototype.nodeType="Shape",o._registerNode(C),C.prototype.eventListeners={},C.prototype.on.call(C.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",d),C.prototype.on.call(C.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",p),C.prototype.on.call(C.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva",m),C.prototype.on.call(C.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",A),C.prototype.on.call(C.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",E),e.Factory.addGetterSetter(C,"stroke",void 0,a.getStringOrGradientValidator()),e.Factory.addGetterSetter(C,"strokeWidth",2,a.getNumberValidator()),e.Factory.addGetterSetter(C,"fillAfterStrokeEnabled",!1),e.Factory.addGetterSetter(C,"hitStrokeWidth","auto",a.getNumberOrAutoValidator()),e.Factory.addGetterSetter(C,"strokeHitEnabled",!0,a.getBooleanValidator()),e.Factory.addGetterSetter(C,"perfectDrawEnabled",!0,a.getBooleanValidator()),e.Factory.addGetterSetter(C,"shadowForStrokeEnabled",!0,a.getBooleanValidator()),e.Factory.addGetterSetter(C,"lineJoin"),e.Factory.addGetterSetter(C,"lineCap"),e.Factory.addGetterSetter(C,"sceneFunc"),e.Factory.addGetterSetter(C,"hitFunc"),e.Factory.addGetterSetter(C,"dash"),e.Factory.addGetterSetter(C,"dashOffset",0,a.getNumberValidator()),e.Factory.addGetterSetter(C,"shadowColor",void 0,a.getStringValidator()),e.Factory.addGetterSetter(C,"shadowBlur",0,a.getNumberValidator()),e.Factory.addGetterSetter(C,"shadowOpacity",1,a.getNumberValidator()),e.Factory.addComponentsGetterSetter(C,"shadowOffset",["x","y"]),e.Factory.addGetterSetter(C,"shadowOffsetX",0,a.getNumberValidator()),e.Factory.addGetterSetter(C,"shadowOffsetY",0,a.getNumberValidator()),e.Factory.addGetterSetter(C,"fillPatternImage"),e.Factory.addGetterSetter(C,"fill",void 0,a.getStringOrGradientValidator()),e.Factory.addGetterSetter(C,"fillPatternX",0,a.getNumberValidator()),e.Factory.addGetterSetter(C,"fillPatternY",0,a.getNumberValidator()),e.Factory.addGetterSetter(C,"fillLinearGradientColorStops"),e.Factory.addGetterSetter(C,"strokeLinearGradientColorStops"),e.Factory.addGetterSetter(C,"fillRadialGradientStartRadius",0),e.Factory.addGetterSetter(C,"fillRadialGradientEndRadius",0),e.Factory.addGetterSetter(C,"fillRadialGradientColorStops"),e.Factory.addGetterSetter(C,"fillPatternRepeat","repeat"),e.Factory.addGetterSetter(C,"fillEnabled",!0),e.Factory.addGetterSetter(C,"strokeEnabled",!0),e.Factory.addGetterSetter(C,"shadowEnabled",!0),e.Factory.addGetterSetter(C,"dashEnabled",!0),e.Factory.addGetterSetter(C,"strokeScaleEnabled",!0),e.Factory.addGetterSetter(C,"fillPriority","color"),e.Factory.addComponentsGetterSetter(C,"fillPatternOffset",["x","y"]),e.Factory.addGetterSetter(C,"fillPatternOffsetX",0,a.getNumberValidator()),e.Factory.addGetterSetter(C,"fillPatternOffsetY",0,a.getNumberValidator()),e.Factory.addComponentsGetterSetter(C,"fillPatternScale",["x","y"]),e.Factory.addGetterSetter(C,"fillPatternScaleX",1,a.getNumberValidator()),e.Factory.addGetterSetter(C,"fillPatternScaleY",1,a.getNumberValidator()),e.Factory.addComponentsGetterSetter(C,"fillLinearGradientStartPoint",["x","y"]),e.Factory.addComponentsGetterSetter(C,"strokeLinearGradientStartPoint",["x","y"]),e.Factory.addGetterSetter(C,"fillLinearGradientStartPointX",0),e.Factory.addGetterSetter(C,"strokeLinearGradientStartPointX",0),e.Factory.addGetterSetter(C,"fillLinearGradientStartPointY",0),e.Factory.addGetterSetter(C,"strokeLinearGradientStartPointY",0),e.Factory.addComponentsGetterSetter(C,"fillLinearGradientEndPoint",["x","y"]),e.Factory.addComponentsGetterSetter(C,"strokeLinearGradientEndPoint",["x","y"]),e.Factory.addGetterSetter(C,"fillLinearGradientEndPointX",0),e.Factory.addGetterSetter(C,"strokeLinearGradientEndPointX",0),e.Factory.addGetterSetter(C,"fillLinearGradientEndPointY",0),e.Factory.addGetterSetter(C,"strokeLinearGradientEndPointY",0),e.Factory.addComponentsGetterSetter(C,"fillRadialGradientStartPoint",["x","y"]),e.Factory.addGetterSetter(C,"fillRadialGradientStartPointX",0),e.Factory.addGetterSetter(C,"fillRadialGradientStartPointY",0),e.Factory.addComponentsGetterSetter(C,"fillRadialGradientEndPoint",["x","y"]),e.Factory.addGetterSetter(C,"fillRadialGradientEndPointX",0),e.Factory.addGetterSetter(C,"fillRadialGradientEndPointY",0),e.Factory.addGetterSetter(C,"fillPatternRotation",0),e.Factory.backCompat(C,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"}),t.Collection.mapMethods(C)})(dt);var Ja=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(pe,"__esModule",{value:!0});pe.Layer=void 0;var At=et,xr=jt,Jt=st,jr=Q,ni=St,Za=W,tn=dt,en=J,rn="#",an="beforeDraw",nn="draw",Di=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],on=Di.length,zt=function(n){Ja(r,n);function r(t){var e=n.call(this,t)||this;return e.canvas=new ni.SceneCanvas,e.hitCanvas=new ni.HitCanvas({pixelRatio:1}),e._waitingForDraw=!1,e.on("visibleChange.konva",e._checkVisibility),e._checkVisibility(),e.on("imageSmoothingEnabledChange.konva",e._setSmoothEnabled),e._setSmoothEnabled(),e}return r.prototype.createPNGStream=function(){var t=this.canvas._canvas;return t.createPNGStream()},r.prototype.getCanvas=function(){return this.canvas},r.prototype.getHitCanvas=function(){return this.hitCanvas},r.prototype.getContext=function(){return this.getCanvas().getContext()},r.prototype.clear=function(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this},r.prototype.setZIndex=function(t){n.prototype.setZIndex.call(this,t);var e=this.getStage();return e&&(e.content.removeChild(this.getCanvas()._canvas),t<e.children.length-1?e.content.insertBefore(this.getCanvas()._canvas,e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas)),this},r.prototype.moveToTop=function(){Jt.Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&(t.content.removeChild(this.getCanvas()._canvas),t.content.appendChild(this.getCanvas()._canvas)),!0},r.prototype.moveUp=function(){var t=Jt.Node.prototype.moveUp.call(this);if(!t)return!1;var e=this.getStage();return e?(e.content.removeChild(this.getCanvas()._canvas),this.index<e.children.length-1?e.content.insertBefore(this.getCanvas()._canvas,e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas),!0):!1},r.prototype.moveDown=function(){if(Jt.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[this.index+1].getCanvas()._canvas)}return!0}return!1},r.prototype.moveToBottom=function(){if(Jt.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[1].getCanvas()._canvas)}return!0}return!1},r.prototype.getLayer=function(){return this},r.prototype.remove=function(){var t=this.getCanvas()._canvas;return Jt.Node.prototype.remove.call(this),t&&t.parentNode&&At.Util._isInDocument(t)&&t.parentNode.removeChild(t),this},r.prototype.getStage=function(){return this.parent},r.prototype.setSize=function(t){var e=t.width,i=t.height;return this.canvas.setSize(e,i),this.hitCanvas.setSize(e,i),this._setSmoothEnabled(),this},r.prototype._validateAdd=function(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&At.Util.throw("You may only add groups and shapes to a layer.")},r.prototype._toKonvaCanvas=function(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),Jt.Node.prototype._toKonvaCanvas.call(this,t)},r.prototype._checkVisibility=function(){var t=this.visible();t?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"},r.prototype._setSmoothEnabled=function(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()},r.prototype.getWidth=function(){if(this.parent)return this.parent.width()},r.prototype.setWidth=function(){At.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},r.prototype.getHeight=function(){if(this.parent)return this.parent.height()},r.prototype.setHeight=function(){At.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')},r.prototype.batchDraw=function(){var t=this;return this._waitingForDraw||(this._waitingForDraw=!0,At.Util.requestAnimFrame(function(){t.draw(),t._waitingForDraw=!1})),this},r.prototype.getIntersection=function(t,e){if(!this.isListening()||!this.isVisible())return null;for(var i=1,a=!1;;){for(var o=0;o<on;o++){var s=Di[o],l=this._getIntersection({x:t.x+s.x*i,y:t.y+s.y*i}),h=l.shape;if(h&&e)return h.findAncestor(e,!0);if(h)return h;if(a=!!l.antialiased,!l.antialiased)break}if(a)i+=1;else return null}},r.prototype._getIntersection=function(t){var e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,a=i[3];if(a===255){var o=At.Util._rgbToHex(i[0],i[1],i[2]),s=tn.shapes[rn+o];return s?{shape:s}:{antialiased:!0}}else if(a>0)return{antialiased:!0};return{}},r.prototype.drawScene=function(t,e){var i=this.getLayer(),a=t||i&&i.getCanvas();return this._fire(an,{node:this}),this.clearBeforeDraw()&&a.getContext().clear(),xr.Container.prototype.drawScene.call(this,a,e),this._fire(nn,{node:this}),this},r.prototype.drawHit=function(t,e){var i=this.getLayer(),a=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),xr.Container.prototype.drawHit.call(this,a,e),this},r.prototype.enableHitGraph=function(){return this.hitGraphEnabled(!0),this},r.prototype.disableHitGraph=function(){return this.hitGraphEnabled(!1),this},r.prototype.setHitGraphEnabled=function(t){At.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)},r.prototype.getHitGraphEnabled=function(t){return At.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()},r.prototype.toggleHitCanvas=function(){if(this.parent){var t=this.parent,e=!!this.hitCanvas._canvas.parentNode;e?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}},r}(xr.Container);pe.Layer=zt;zt.prototype.nodeType="Layer";en._registerNode(zt);jr.Factory.addGetterSetter(zt,"imageSmoothingEnabled",!0);jr.Factory.addGetterSetter(zt,"clearBeforeDraw",!0);jr.Factory.addGetterSetter(zt,"hitGraphEnabled",!0,Za.getBooleanValidator());At.Collection.mapMethods(zt);var Ie={},sn=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ie,"__esModule",{value:!0});Ie.FastLayer=void 0;var Li=et,hn=pe,ln=J,Ue=function(n){sn(r,n);function r(t){var e=n.call(this,t)||this;return e.listening(!1),Li.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.'),e}return r}(hn.Layer);Ie.FastLayer=Ue;Ue.prototype.nodeType="FastLayer";ln._registerNode(Ue);Li.Collection.mapMethods(Ue);var ie={},un=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(ie,"__esModule",{value:!0});ie.Group=void 0;var Ii=et,dn=jt,fn=J,Ve=function(n){un(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._validateAdd=function(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&Ii.Util.throw("You may only add groups and shapes to groups.")},r}(dn.Container);ie.Group=Ve;Ve.prototype.nodeType="Group";fn._registerNode(Ve);Ii.Collection.mapMethods(Ve);var ae={};Object.defineProperty(ae,"__esModule",{value:!0});ae.Animation=void 0;var Fr=J,Mr=function(){return Fr.glob.performance&&Fr.glob.performance.now?function(){return Fr.glob.performance.now()}:function(){return new Date().getTime()}}(),cn=function(){function n(r,t){this.id=n.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Mr(),frameRate:0},this.func=r,this.setLayers(t)}return n.prototype.setLayers=function(r){var t=[];return r?r.length>0?t=r:t=[r]:t=[],this.layers=t,this},n.prototype.getLayers=function(){return this.layers},n.prototype.addLayer=function(r){var t=this.layers,e=t.length,i;for(i=0;i<e;i++)if(t[i]._id===r._id)return!1;return this.layers.push(r),!0},n.prototype.isRunning=function(){var r=n,t=r.animations,e=t.length,i;for(i=0;i<e;i++)if(t[i].id===this.id)return!0;return!1},n.prototype.start=function(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Mr(),n._addAnimation(this),this},n.prototype.stop=function(){return n._removeAnimation(this),this},n.prototype._updateFrameObject=function(r){this.frame.timeDiff=r-this.frame.lastTime,this.frame.lastTime=r,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff},n._addAnimation=function(r){this.animations.push(r),this._handleAnimation()},n._removeAnimation=function(r){var t=r.id,e=this.animations,i=e.length,a;for(a=0;a<i;a++)if(e[a].id===t){this.animations.splice(a,1);break}},n._runFrames=function(){var r={},t=this.animations,e,i,a,o,s,l,h,f,b;for(o=0;o<t.length;o++)if(e=t[o],i=e.layers,a=e.func,e._updateFrameObject(Mr()),l=i.length,a?b=a.call(e,e.frame)!==!1:b=!0,!!b)for(s=0;s<l;s++)h=i[s],h._id!==void 0&&(r[h._id]=h);for(f in r)r.hasOwnProperty(f)&&r[f].draw()},n._animationLoop=function(){var r=n;r.animations.length?(r._runFrames(),requestAnimationFrame(r._animationLoop)):r.animRunning=!1},n._handleAnimation=function(){this.animRunning||(this.animRunning=!0,requestAnimationFrame(this._animationLoop))},n.animations=[],n.animIdCounter=0,n.animRunning=!1,n}();ae.Animation=cn;var Ui={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.Easings=n.Tween=void 0;var r=et,t=ae,e=st,i=J,a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},o=1,s=2,l=3,h=0,f=["fill","stroke","shadowColor"],b=function(){function c(_,g,T,P,N,d,p){this.prop=_,this.propFunc=g,this.begin=P,this._pos=P,this.duration=d,this._change=0,this.prevPos=0,this.yoyo=p,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=T,this._change=N-this.begin,this.pause()}return c.prototype.fire=function(_){var g=this[_];g&&g()},c.prototype.setTime=function(_){_>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():_<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=_,this.update())},c.prototype.getTime=function(){return this._time},c.prototype.setPosition=function(_){this.prevPos=this._pos,this.propFunc(_),this._pos=_},c.prototype.getPosition=function(_){return _===void 0&&(_=this._time),this.func(_,this.begin,this._change,this.duration)},c.prototype.play=function(){this.state=s,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},c.prototype.reverse=function(){this.state=l,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},c.prototype.seek=function(_){this.pause(),this._time=_,this.update(),this.fire("onSeek")},c.prototype.reset=function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},c.prototype.finish=function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},c.prototype.update=function(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")},c.prototype.onEnterFrame=function(){var _=this.getTimer()-this._startTime;this.state===s?this.setTime(_):this.state===l&&this.setTime(this.duration-_)},c.prototype.pause=function(){this.state=o,this.fire("onPause")},c.prototype.getTimer=function(){return new Date().getTime()},c}(),w=function(){function c(_){var g=this,T=_.node,P=T._id,N,d=_.easing||n.Easings.Linear,p=!!_.yoyo,m;typeof _.duration>"u"?N=.3:_.duration===0?N=.001:N=_.duration,this.node=T,this._id=h++;var A=T.getLayer()||(T instanceof i.Konva.Stage?T.getLayers():null);A||r.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new t.Animation(function(){g.tween.onEnterFrame()},A),this.tween=new b(m,function(E){g._tweenFunc(E)},d,0,1,N*1e3,p),this._addListeners(),c.attrs[P]||(c.attrs[P]={}),c.attrs[P][this._id]||(c.attrs[P][this._id]={}),c.tweens[P]||(c.tweens[P]={});for(m in _)a[m]===void 0&&this._addAttr(m,_[m]);this.reset(),this.onFinish=_.onFinish,this.onReset=_.onReset,this.onUpdate=_.onUpdate}return c.prototype._addAttr=function(_,g){var T=this.node,P=T._id,N,d,p,m,A,E,C,G;if(p=c.tweens[P][_],p&&delete c.attrs[P][p][_],N=T.getAttr(_),r.Util._isArray(g))if(d=[],A=Math.max(g.length,N.length),_==="points"&&g.length!==N.length&&(g.length>N.length?(C=N,N=r.Util._prepareArrayForTween(N,g,T.closed())):(E=g,g=r.Util._prepareArrayForTween(g,N,T.closed()))),_.indexOf("fill")===0)for(m=0;m<A;m++)if(m%2===0)d.push(g[m]-N[m]);else{var M=r.Util.colorToRGBA(N[m]);G=r.Util.colorToRGBA(g[m]),N[m]=M,d.push({r:G.r-M.r,g:G.g-M.g,b:G.b-M.b,a:G.a-M.a})}else for(m=0;m<A;m++)d.push(g[m]-N[m]);else f.indexOf(_)!==-1?(N=r.Util.colorToRGBA(N),G=r.Util.colorToRGBA(g),d={r:G.r-N.r,g:G.g-N.g,b:G.b-N.b,a:G.a-N.a}):d=g-N;c.attrs[P][this._id][_]={start:N,diff:d,end:g,trueEnd:E,trueStart:C},c.tweens[P][_]=this._id},c.prototype._tweenFunc=function(_){var g=this.node,T=c.attrs[g._id][this._id],P,N,d,p,m,A,E,C;for(P in T){if(N=T[P],d=N.start,p=N.diff,C=N.end,r.Util._isArray(d))if(m=[],E=Math.max(d.length,C.length),P.indexOf("fill")===0)for(A=0;A<E;A++)A%2===0?m.push((d[A]||0)+p[A]*_):m.push("rgba("+Math.round(d[A].r+p[A].r*_)+","+Math.round(d[A].g+p[A].g*_)+","+Math.round(d[A].b+p[A].b*_)+","+(d[A].a+p[A].a*_)+")");else for(A=0;A<E;A++)m.push((d[A]||0)+p[A]*_);else f.indexOf(P)!==-1?m="rgba("+Math.round(d.r+p.r*_)+","+Math.round(d.g+p.g*_)+","+Math.round(d.b+p.b*_)+","+(d.a+p.a*_)+")":m=d+p*_;g.setAttr(P,m)}},c.prototype._addListeners=function(){var _=this;this.tween.onPlay=function(){_.anim.start()},this.tween.onReverse=function(){_.anim.start()},this.tween.onPause=function(){_.anim.stop()},this.tween.onFinish=function(){var g=_.node,T=c.attrs[g._id][_._id];T.points&&T.points.trueEnd&&g.setAttr("points",T.points.trueEnd),_.onFinish&&_.onFinish.call(_)},this.tween.onReset=function(){var g=_.node,T=c.attrs[g._id][_._id];T.points&&T.points.trueStart&&g.points(T.points.trueStart),_.onReset&&_.onReset()},this.tween.onUpdate=function(){_.onUpdate&&_.onUpdate.call(_)}},c.prototype.play=function(){return this.tween.play(),this},c.prototype.reverse=function(){return this.tween.reverse(),this},c.prototype.reset=function(){return this.tween.reset(),this},c.prototype.seek=function(_){return this.tween.seek(_*1e3),this},c.prototype.pause=function(){return this.tween.pause(),this},c.prototype.finish=function(){return this.tween.finish(),this},c.prototype.destroy=function(){var _=this.node._id,g=this._id,T=c.tweens[_],P;this.pause();for(P in T)delete c.tweens[_][P];delete c.attrs[_][g]},c.attrs={},c.tweens={},c}();n.Tween=w,e.Node.prototype.to=function(c){var _=c.onFinish;c.node=this,c.onFinish=function(){this.destroy(),_&&_()};var g=new w(c);g.play()},n.Easings={BackEaseIn:function(c,_,g,T){var P=1.70158;return g*(c/=T)*c*((P+1)*c-P)+_},BackEaseOut:function(c,_,g,T){var P=1.70158;return g*((c=c/T-1)*c*((P+1)*c+P)+1)+_},BackEaseInOut:function(c,_,g,T){var P=1.70158;return(c/=T/2)<1?g/2*(c*c*(((P*=1.525)+1)*c-P))+_:g/2*((c-=2)*c*(((P*=1.525)+1)*c+P)+2)+_},ElasticEaseIn:function(c,_,g,T,P,N){var d=0;return c===0?_:(c/=T)===1?_+g:(N||(N=T*.3),!P||P<Math.abs(g)?(P=g,d=N/4):d=N/(2*Math.PI)*Math.asin(g/P),-(P*Math.pow(2,10*(c-=1))*Math.sin((c*T-d)*(2*Math.PI)/N))+_)},ElasticEaseOut:function(c,_,g,T,P,N){var d=0;return c===0?_:(c/=T)===1?_+g:(N||(N=T*.3),!P||P<Math.abs(g)?(P=g,d=N/4):d=N/(2*Math.PI)*Math.asin(g/P),P*Math.pow(2,-10*c)*Math.sin((c*T-d)*(2*Math.PI)/N)+g+_)},ElasticEaseInOut:function(c,_,g,T,P,N){var d=0;return c===0?_:(c/=T/2)===2?_+g:(N||(N=T*(.3*1.5)),!P||P<Math.abs(g)?(P=g,d=N/4):d=N/(2*Math.PI)*Math.asin(g/P),c<1?-.5*(P*Math.pow(2,10*(c-=1))*Math.sin((c*T-d)*(2*Math.PI)/N))+_:P*Math.pow(2,-10*(c-=1))*Math.sin((c*T-d)*(2*Math.PI)/N)*.5+g+_)},BounceEaseOut:function(c,_,g,T){return(c/=T)<1/2.75?g*(7.5625*c*c)+_:c<2/2.75?g*(7.5625*(c-=1.5/2.75)*c+.75)+_:c<2.5/2.75?g*(7.5625*(c-=2.25/2.75)*c+.9375)+_:g*(7.5625*(c-=2.625/2.75)*c+.984375)+_},BounceEaseIn:function(c,_,g,T){return g-n.Easings.BounceEaseOut(T-c,0,g,T)+_},BounceEaseInOut:function(c,_,g,T){return c<T/2?n.Easings.BounceEaseIn(c*2,0,g,T)*.5+_:n.Easings.BounceEaseOut(c*2-T,0,g,T)*.5+g*.5+_},EaseIn:function(c,_,g,T){return g*(c/=T)*c+_},EaseOut:function(c,_,g,T){return-g*(c/=T)*(c-2)+_},EaseInOut:function(c,_,g,T){return(c/=T/2)<1?g/2*c*c+_:-g/2*(--c*(c-2)-1)+_},StrongEaseIn:function(c,_,g,T){return g*(c/=T)*c*c*c*c+_},StrongEaseOut:function(c,_,g,T){return g*((c=c/T-1)*c*c*c*c+1)+_},StrongEaseInOut:function(c,_,g,T){return(c/=T/2)<1?g/2*c*c*c*c*c+_:g/2*((c-=2)*c*c*c*c+2)+_},Linear:function(c,_,g,T){return g*c/T+_}}})(Ui);Object.defineProperty(Ne,"__esModule",{value:!0});Ne.Konva=void 0;var pn=J,Ce=et,Er=st,gn=jt,oi=Ni,vn=pe,_n=Ie,yn=ie,mn=De,si=dt,Sn=ae,hi=Ui,bn=Ft,Cn=St;Ne.Konva=Ce.Util._assign(pn.Konva,{Collection:Ce.Collection,Util:Ce.Util,Transform:Ce.Transform,Node:Er.Node,ids:Er.ids,names:Er.names,Container:gn.Container,Stage:oi.Stage,stages:oi.stages,Layer:vn.Layer,FastLayer:_n.FastLayer,Group:yn.Group,DD:mn.DD,Shape:si.Shape,shapes:si.shapes,Animation:Sn.Animation,Tween:hi.Tween,Easings:hi.Easings,Context:bn.Context,Canvas:Cn.Canvas});var $e={},wn=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty($e,"__esModule",{value:!0});$e.Arc=void 0;var Pn=et,Be=Q,Tn=dt,On=J,He=W,An=J,Pt=function(n){wn(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=On.Konva.getAngle(this.angle()),i=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,i),t.arc(0,0,this.innerRadius(),e,0,!i),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.outerRadius()*2},r.prototype.getHeight=function(){return this.outerRadius()*2},r.prototype.setWidth=function(t){this.outerRadius(t/2)},r.prototype.setHeight=function(t){this.outerRadius(t/2)},r}(Tn.Shape);$e.Arc=Pt;Pt.prototype._centroid=!0;Pt.prototype.className="Arc";Pt.prototype._attrsAffectingSize=["innerRadius","outerRadius"];An._registerNode(Pt);Be.Factory.addGetterSetter(Pt,"innerRadius",0,He.getNumberValidator());Be.Factory.addGetterSetter(Pt,"outerRadius",0,He.getNumberValidator());Be.Factory.addGetterSetter(Pt,"angle",0,He.getNumberValidator());Be.Factory.addGetterSetter(Pt,"clockwise",!1,He.getBooleanValidator());Pn.Collection.mapMethods(Pt);var je={},ge={},xn=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Fn=Y&&Y.__spreadArrays||function(){for(var n=0,r=0,t=arguments.length;r<t;r++)n+=arguments[r].length;for(var e=Array(n),i=0,r=0;r<t;r++)for(var a=arguments[r],o=0,s=a.length;o<s;o++,i++)e[i]=a[o];return e};Object.defineProperty(ge,"__esModule",{value:!0});ge.Line=void 0;var de=et,ze=Q,Mn=dt,Vi=W,En=J,kt=function(n){xn(r,n);function r(t){var e=n.call(this,t)||this;return e.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")}),e}return r.prototype._sceneFunc=function(t){var e=this.points(),i=e.length,a=this.tension(),o=this.closed(),s=this.bezier(),l,h,f;if(i){if(t.beginPath(),t.moveTo(e[0],e[1]),a!==0&&i>4){for(l=this.getTensionPoints(),h=l.length,f=o?0:4,o||t.quadraticCurveTo(l[0],l[1],l[2],l[3]);f<h-2;)t.bezierCurveTo(l[f++],l[f++],l[f++],l[f++],l[f++],l[f++]);o||t.quadraticCurveTo(l[h-2],l[h-1],e[i-2],e[i-1])}else if(s)for(f=2;f<i;)t.bezierCurveTo(e[f++],e[f++],e[f++],e[f++],e[f++],e[f++]);else for(f=2;f<i;f+=2)t.lineTo(e[f],e[f+1]);o?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}},r.prototype.getTensionPoints=function(){return this._getCache("tensionPoints",this._getTensionPoints)},r.prototype._getTensionPoints=function(){return this.closed()?this._getTensionPointsClosed():de.Util._expandPoints(this.points(),this.tension())},r.prototype._getTensionPointsClosed=function(){var t=this.points(),e=t.length,i=this.tension(),a=de.Util._getControlPoints(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),o=de.Util._getControlPoints(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),s=de.Util._expandPoints(t,i),l=[a[2],a[3]].concat(s).concat([o[0],o[1],t[e-2],t[e-1],o[2],o[3],a[0],a[1],t[0],t[1]]);return l},r.prototype.getWidth=function(){return this.getSelfRect().width},r.prototype.getHeight=function(){return this.getSelfRect().height},r.prototype.getSelfRect=function(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};this.tension()!==0?t=Fn([t[0],t[1]],this._getTensionPoints(),[t[t.length-2],t[t.length-1]]):t=this.points();for(var e=t[0],i=t[0],a=t[1],o=t[1],s,l,h=0;h<t.length/2;h++)s=t[h*2],l=t[h*2+1],e=Math.min(e,s),i=Math.max(i,s),a=Math.min(a,l),o=Math.max(o,l);return{x:e,y:a,width:i-e,height:o-a}},r}(Mn.Shape);ge.Line=kt;kt.prototype.className="Line";kt.prototype._attrsAffectingSize=["points","bezier","tension"];En._registerNode(kt);ze.Factory.addGetterSetter(kt,"closed",!1);ze.Factory.addGetterSetter(kt,"bezier",!1);ze.Factory.addGetterSetter(kt,"tension",0,Vi.getNumberValidator());ze.Factory.addGetterSetter(kt,"points",[],Vi.getNumberArrayValidator());de.Collection.mapMethods(kt);var kn=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(je,"__esModule",{value:!0});je.Arrow=void 0;var Nn=et,zr=Q,Gn=ge,$i=W,Rn=J,Wt=function(n){kn(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){n.prototype._sceneFunc.call(this,t);var e=Math.PI*2,i=this.points(),a=i,o=this.tension()!==0&&i.length>4;o&&(a=this.getTensionPoints());var s=i.length,l,h;o?(l=i[s-2]-(a[a.length-2]+a[a.length-4])/2,h=i[s-1]-(a[a.length-1]+a[a.length-3])/2):(l=i[s-2]-i[s-4],h=i[s-1]-i[s-3]);var f=(Math.atan2(h,l)+e)%e,b=this.pointerLength(),w=this.pointerWidth();t.save(),t.beginPath(),t.translate(i[s-2],i[s-1]),t.rotate(f),t.moveTo(0,0),t.lineTo(-b,w/2),t.lineTo(-b,-w/2),t.closePath(),t.restore(),this.pointerAtBeginning()&&(t.save(),t.translate(i[0],i[1]),o?(l=(a[0]+a[2])/2-i[0],h=(a[1]+a[3])/2-i[1]):(l=i[2]-i[0],h=i[3]-i[1]),t.rotate((Math.atan2(-h,-l)+e)%e),t.moveTo(0,0),t.lineTo(-b,w/2),t.lineTo(-b,-w/2),t.closePath(),t.restore());var c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)},r.prototype.getSelfRect=function(){var t=n.prototype.getSelfRect.call(this),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+e*2,height:t.height+e*2}},r}(Gn.Line);je.Arrow=Wt;Wt.prototype.className="Arrow";Rn._registerNode(Wt);zr.Factory.addGetterSetter(Wt,"pointerLength",10,$i.getNumberValidator());zr.Factory.addGetterSetter(Wt,"pointerWidth",10,$i.getNumberValidator());zr.Factory.addGetterSetter(Wt,"pointerAtBeginning",!1);Nn.Collection.mapMethods(Wt);var We={},Dn=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(We,"__esModule",{value:!0});We.Circle=void 0;var Ln=et,In=Q,Un=dt,Vn=W,$n=J,Kt=function(n){Dn(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.radius()*2},r.prototype.getHeight=function(){return this.radius()*2},r.prototype.setWidth=function(t){this.radius()!==t/2&&this.radius(t/2)},r.prototype.setHeight=function(t){this.radius()!==t/2&&this.radius(t/2)},r}(Un.Shape);We.Circle=Kt;Kt.prototype._centroid=!0;Kt.prototype.className="Circle";Kt.prototype._attrsAffectingSize=["radius"];$n._registerNode(Kt);In.Factory.addGetterSetter(Kt,"radius",0,Vn.getNumberValidator());Ln.Collection.mapMethods(Kt);var Ke={},Bn=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ke,"__esModule",{value:!0});Ke.Ellipse=void 0;var Hn=et,Wr=Q,jn=dt,Bi=W,zn=J,Nt=function(n){Bn(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.radiusX(),i=this.radiusY();t.beginPath(),t.save(),e!==i&&t.scale(1,i/e),t.arc(0,0,e,0,Math.PI*2,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.radiusX()*2},r.prototype.getHeight=function(){return this.radiusY()*2},r.prototype.setWidth=function(t){this.radiusX(t/2)},r.prototype.setHeight=function(t){this.radiusY(t/2)},r}(jn.Shape);Ke.Ellipse=Nt;Nt.prototype.className="Ellipse";Nt.prototype._centroid=!0;Nt.prototype._attrsAffectingSize=["radiusX","radiusY"];zn._registerNode(Nt);Wr.Factory.addComponentsGetterSetter(Nt,"radius",["x","y"]);Wr.Factory.addGetterSetter(Nt,"radiusX",0,Bi.getNumberValidator());Wr.Factory.addGetterSetter(Nt,"radiusY",0,Bi.getNumberValidator());Hn.Collection.mapMethods(Nt);var Ye={},Wn=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ye,"__esModule",{value:!0});Ye.Image=void 0;var Hi=et,ne=Q,Kn=dt,Xe=W,Yn=J,Tt=function(n){Wn(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._useBufferCanvas=function(){return n.prototype._useBufferCanvas.call(this,!0)},r.prototype._sceneFunc=function(t){var e=this.getWidth(),i=this.getHeight(),a=this.attrs.image,o;if(a){var s=this.attrs.cropWidth,l=this.attrs.cropHeight;s&&l?o=[a,this.cropX(),this.cropY(),s,l,0,0,e,i]:o=[a,0,0,e,i]}(this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)),a&&t.drawImage.apply(t,o)},r.prototype._hitFunc=function(t){var e=this.width(),i=this.height();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){var t,e;return(t=this.attrs.width)!==null&&t!==void 0?t:((e=this.image())===null||e===void 0?void 0:e.width)||0},r.prototype.getHeight=function(){var t,e;return(t=this.attrs.height)!==null&&t!==void 0?t:((e=this.image())===null||e===void 0?void 0:e.height)||0},r.fromURL=function(t,e){var i=Hi.Util.createImageElement();i.onload=function(){var a=new r({image:i});e(a)},i.crossOrigin="Anonymous",i.src=t},r}(Kn.Shape);Ye.Image=Tt;Tt.prototype.className="Image";Yn._registerNode(Tt);ne.Factory.addGetterSetter(Tt,"image");ne.Factory.addComponentsGetterSetter(Tt,"crop",["x","y","width","height"]);ne.Factory.addGetterSetter(Tt,"cropX",0,Xe.getNumberValidator());ne.Factory.addGetterSetter(Tt,"cropY",0,Xe.getNumberValidator());ne.Factory.addGetterSetter(Tt,"cropWidth",0,Xe.getNumberValidator());ne.Factory.addGetterSetter(Tt,"cropHeight",0,Xe.getNumberValidator());Hi.Collection.mapMethods(Tt);var Zt={},ji=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Zt,"__esModule",{value:!0});Zt.Tag=Zt.Label=void 0;var zi=et,qe=Q,Xn=dt,qn=ie,Kr=W,Wi=J,Ki=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height"],Qn="Change.konva",Jn="none",Ur="up",Vr="right",$r="down",Br="left",Zn=Ki.length,Qe=function(n){ji(r,n);function r(t){var e=n.call(this,t)||this;return e.on("add.konva",function(i){this._addListeners(i.child),this._sync()}),e}return r.prototype.getText=function(){return this.find("Text")[0]},r.prototype.getTag=function(){return this.find("Tag")[0]},r.prototype._addListeners=function(t){var e=this,i,a=function(){e._sync()};for(i=0;i<Zn;i++)t.on(Ki[i]+Qn,a)},r.prototype.getWidth=function(){return this.getText().width()},r.prototype.getHeight=function(){return this.getText().height()},r.prototype._sync=function(){var t=this.getText(),e=this.getTag(),i,a,o,s,l,h,f;if(t&&e){switch(i=t.width(),a=t.height(),o=e.pointerDirection(),s=e.pointerWidth(),f=e.pointerHeight(),l=0,h=0,o){case Ur:l=i/2,h=-1*f;break;case Vr:l=i+s,h=a/2;break;case $r:l=i/2,h=a+f;break;case Br:l=-1*s,h=a/2;break}e.setAttrs({x:-1*l,y:-1*h,width:i,height:a}),t.setAttrs({x:-1*l,y:-1*h})}},r}(qn.Group);Zt.Label=Qe;Qe.prototype.className="Label";Wi._registerNode(Qe);zi.Collection.mapMethods(Qe);var Lt=function(n){ji(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.width(),i=this.height(),a=this.pointerDirection(),o=this.pointerWidth(),s=this.pointerHeight(),l=this.cornerRadius(),h=0,f=0,b=0,w=0;typeof l=="number"?h=f=b=w=Math.min(l,e/2,i/2):(h=Math.min(l[0]||0,e/2,i/2),f=Math.min(l[1]||0,e/2,i/2),w=Math.min(l[2]||0,e/2,i/2),b=Math.min(l[3]||0,e/2,i/2)),t.beginPath(),t.moveTo(h,0),a===Ur&&(t.lineTo((e-o)/2,0),t.lineTo(e/2,-1*s),t.lineTo((e+o)/2,0)),t.lineTo(e-f,0),t.arc(e-f,f,f,Math.PI*3/2,0,!1),a===Vr&&(t.lineTo(e,(i-s)/2),t.lineTo(e+o,i/2),t.lineTo(e,(i+s)/2)),t.lineTo(e,i-w),t.arc(e-w,i-w,w,0,Math.PI/2,!1),a===$r&&(t.lineTo((e+o)/2,i),t.lineTo(e/2,i+s),t.lineTo((e-o)/2,i)),t.lineTo(b,i),t.arc(b,i-b,b,Math.PI/2,Math.PI,!1),a===Br&&(t.lineTo(0,(i+s)/2),t.lineTo(-1*o,i/2),t.lineTo(0,(i-s)/2)),t.lineTo(0,h),t.arc(h,h,h,Math.PI,Math.PI*3/2,!1),t.closePath(),t.fillStrokeShape(this)},r.prototype.getSelfRect=function(){var t=0,e=0,i=this.pointerWidth(),a=this.pointerHeight(),o=this.pointerDirection(),s=this.width(),l=this.height();return o===Ur?(e-=a,l+=a):o===$r?l+=a:o===Br?(t-=i*1.5,s+=i):o===Vr&&(s+=i*1.5),{x:t,y:e,width:s,height:l}},r}(Xn.Shape);Zt.Tag=Lt;Lt.prototype.className="Tag";Wi._registerNode(Lt);qe.Factory.addGetterSetter(Lt,"pointerDirection",Jn);qe.Factory.addGetterSetter(Lt,"pointerWidth",0,Kr.getNumberValidator());qe.Factory.addGetterSetter(Lt,"pointerHeight",0,Kr.getNumberValidator());qe.Factory.addGetterSetter(Lt,"cornerRadius",0,Kr.getNumberOrArrayOfNumbersValidator(4));zi.Collection.mapMethods(Lt);var ve={},to=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(ve,"__esModule",{value:!0});ve.Path=void 0;var eo=et,ro=Q,io=dt,ao=J,oe=function(n){to(r,n);function r(t){var e=n.call(this,t)||this;e.dataArray=[],e.pathLength=0,e.dataArray=r.parsePathData(e.data()),e.pathLength=0;for(var i=0;i<e.dataArray.length;++i)e.pathLength+=e.dataArray[i].pathLength;return e.on("dataChange.konva",function(){this.dataArray=r.parsePathData(this.data()),this.pathLength=0;for(var a=0;a<this.dataArray.length;++a)this.pathLength+=this.dataArray[a].pathLength}),e}return r.prototype._sceneFunc=function(t){var e=this.dataArray;t.beginPath();for(var i=!1,a=0;a<e.length;a++){var o=e[a].command,s=e[a].points;switch(o){case"L":t.lineTo(s[0],s[1]);break;case"M":t.moveTo(s[0],s[1]);break;case"C":t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"Q":t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case"A":var l=s[0],h=s[1],f=s[2],b=s[3],w=s[4],c=s[5],_=s[6],g=s[7],T=f>b?f:b,P=f>b?1:f/b,N=f>b?b/f:1;t.translate(l,h),t.rotate(_),t.scale(P,N),t.arc(0,0,T,w,w+c,1-g),t.scale(1/P,1/N),t.rotate(-_),t.translate(-l,-h);break;case"z":i=!0,t.closePath();break}}!i&&!this.hasFill()?t.strokeShape(this):t.fillStrokeShape(this)},r.prototype.getSelfRect=function(){var t=[];this.dataArray.forEach(function(f){if(f.command==="A"){var b=f.points[4],w=f.points[5],c=f.points[4]+w,_=Math.PI/180;if(Math.abs(b-c)<_&&(_=Math.abs(b-c)),w<0)for(var g=b-_;g>c;g-=_){var T=r.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],g,0);t.push(T.x,T.y)}else for(var g=b+_;g<c;g+=_){var T=r.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],g,0);t.push(T.x,T.y)}}else if(f.command==="C")for(var g=0;g<=1;g+=.01){var T=r.getPointOnCubicBezier(g,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);t.push(T.x,T.y)}else t=t.concat(f.points)});for(var e=t[0],i=t[0],a=t[1],o=t[1],s,l,h=0;h<t.length/2;h++)s=t[h*2],l=t[h*2+1],isNaN(s)||(e=Math.min(e,s),i=Math.max(i,s)),isNaN(l)||(a=Math.min(a,l),o=Math.max(o,l));return{x:Math.round(e),y:Math.round(a),width:Math.round(i-e),height:Math.round(o-a)}},r.prototype.getLength=function(){return this.pathLength},r.prototype.getPointAtLength=function(t){var e,i=0,a=this.dataArray.length;if(!a)return null;for(;i<a&&t>this.dataArray[i].pathLength;)t-=this.dataArray[i].pathLength,++i;if(i===a)return e=this.dataArray[i-1].points.slice(-2),{x:e[0],y:e[1]};if(t<.01)return e=this.dataArray[i].points.slice(0,2),{x:e[0],y:e[1]};var o=this.dataArray[i],s=o.points;switch(o.command){case"L":return r.getPointOnLine(t,o.start.x,o.start.y,s[0],s[1]);case"C":return r.getPointOnCubicBezier(t/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3],s[4],s[5]);case"Q":return r.getPointOnQuadraticBezier(t/o.pathLength,o.start.x,o.start.y,s[0],s[1],s[2],s[3]);case"A":var l=s[0],h=s[1],f=s[2],b=s[3],w=s[4],c=s[5],_=s[6];return w+=c*t/o.pathLength,r.getPointOnEllipticalArc(l,h,f,b,w,_)}return null},r.getLineLength=function(t,e,i,a){return Math.sqrt((i-t)*(i-t)+(a-e)*(a-e))},r.getPointOnLine=function(t,e,i,a,o,s,l){s===void 0&&(s=e),l===void 0&&(l=i);var h=(o-i)/(a-e+1e-8),f=Math.sqrt(t*t/(1+h*h));a<e&&(f*=-1);var b=h*f,w;if(a===e)w={x:s,y:l+b};else if((l-i)/(s-e+1e-8)===h)w={x:s+f,y:l+b};else{var c,_,g=this.getLineLength(e,i,a,o),T=(s-e)*(a-e)+(l-i)*(o-i);T=T/(g*g),c=e+T*(a-e),_=i+T*(o-i);var P=this.getLineLength(s,l,c,_),N=Math.sqrt(t*t-P*P);f=Math.sqrt(N*N/(1+h*h)),a<e&&(f*=-1),b=h*f,w={x:c+f,y:_+b}}return w},r.getPointOnCubicBezier=function(t,e,i,a,o,s,l,h,f){function b(P){return P*P*P}function w(P){return 3*P*P*(1-P)}function c(P){return 3*P*(1-P)*(1-P)}function _(P){return(1-P)*(1-P)*(1-P)}var g=h*b(t)+s*w(t)+a*c(t)+e*_(t),T=f*b(t)+l*w(t)+o*c(t)+i*_(t);return{x:g,y:T}},r.getPointOnQuadraticBezier=function(t,e,i,a,o,s,l){function h(_){return _*_}function f(_){return 2*_*(1-_)}function b(_){return(1-_)*(1-_)}var w=s*h(t)+a*f(t)+e*b(t),c=l*h(t)+o*f(t)+i*b(t);return{x:w,y:c}},r.getPointOnEllipticalArc=function(t,e,i,a,o,s){var l=Math.cos(s),h=Math.sin(s),f={x:i*Math.cos(o),y:a*Math.sin(o)};return{x:t+(f.x*l-f.y*h),y:e+(f.x*h+f.y*l)}},r.parsePathData=function(t){if(!t)return[];var e=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var a=0;a<i.length;a++)e=e.replace(new RegExp(i[a],"g"),"|"+i[a]);var o=e.split("|"),s=[],l=[],h=0,f=0,b=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,w;for(a=1;a<o.length;a++){var c=o[a],_=c.charAt(0);for(c=c.slice(1),l.length=0;w=b.exec(c);)l.push(w[0]);for(var g=[],T=0,P=l.length;T<P;T++){var N=parseFloat(l[T]);isNaN(N)?g.push(0):g.push(N)}for(;g.length>0&&!isNaN(g[0]);){var d=null,p=[],m=h,A=f,E,C,G,M,O,R,D,I,j,B;switch(_){case"l":h+=g.shift(),f+=g.shift(),d="L",p.push(h,f);break;case"L":h=g.shift(),f=g.shift(),p.push(h,f);break;case"m":var U=g.shift(),z=g.shift();if(h+=U,f+=z,d="M",s.length>2&&s[s.length-1].command==="z"){for(var F=s.length-2;F>=0;F--)if(s[F].command==="M"){h=s[F].points[0]+U,f=s[F].points[1]+z;break}}p.push(h,f),_="l";break;case"M":h=g.shift(),f=g.shift(),d="M",p.push(h,f),_="L";break;case"h":h+=g.shift(),d="L",p.push(h,f);break;case"H":h=g.shift(),d="L",p.push(h,f);break;case"v":f+=g.shift(),d="L",p.push(h,f);break;case"V":f=g.shift(),d="L",p.push(h,f);break;case"C":p.push(g.shift(),g.shift(),g.shift(),g.shift()),h=g.shift(),f=g.shift(),p.push(h,f);break;case"c":p.push(h+g.shift(),f+g.shift(),h+g.shift(),f+g.shift()),h+=g.shift(),f+=g.shift(),d="C",p.push(h,f);break;case"S":C=h,G=f,E=s[s.length-1],E.command==="C"&&(C=h+(h-E.points[2]),G=f+(f-E.points[3])),p.push(C,G,g.shift(),g.shift()),h=g.shift(),f=g.shift(),d="C",p.push(h,f);break;case"s":C=h,G=f,E=s[s.length-1],E.command==="C"&&(C=h+(h-E.points[2]),G=f+(f-E.points[3])),p.push(C,G,h+g.shift(),f+g.shift()),h+=g.shift(),f+=g.shift(),d="C",p.push(h,f);break;case"Q":p.push(g.shift(),g.shift()),h=g.shift(),f=g.shift(),p.push(h,f);break;case"q":p.push(h+g.shift(),f+g.shift()),h+=g.shift(),f+=g.shift(),d="Q",p.push(h,f);break;case"T":C=h,G=f,E=s[s.length-1],E.command==="Q"&&(C=h+(h-E.points[0]),G=f+(f-E.points[1])),h=g.shift(),f=g.shift(),d="Q",p.push(C,G,h,f);break;case"t":C=h,G=f,E=s[s.length-1],E.command==="Q"&&(C=h+(h-E.points[0]),G=f+(f-E.points[1])),h+=g.shift(),f+=g.shift(),d="Q",p.push(C,G,h,f);break;case"A":M=g.shift(),O=g.shift(),R=g.shift(),D=g.shift(),I=g.shift(),j=h,B=f,h=g.shift(),f=g.shift(),d="A",p=this.convertEndpointToCenterParameterization(j,B,h,f,D,I,M,O,R);break;case"a":M=g.shift(),O=g.shift(),R=g.shift(),D=g.shift(),I=g.shift(),j=h,B=f,h+=g.shift(),f+=g.shift(),d="A",p=this.convertEndpointToCenterParameterization(j,B,h,f,D,I,M,O,R);break}s.push({command:d||_,points:p,start:{x:m,y:A},pathLength:this.calcLength(m,A,d||_,p)})}(_==="z"||_==="Z")&&s.push({command:"z",points:[],start:void 0,pathLength:0})}return s},r.calcLength=function(t,e,i,a){var o,s,l,h,f=r;switch(i){case"L":return f.getLineLength(t,e,a[0],a[1]);case"C":for(o=0,s=f.getPointOnCubicBezier(0,t,e,a[0],a[1],a[2],a[3],a[4],a[5]),h=.01;h<=1;h+=.01)l=f.getPointOnCubicBezier(h,t,e,a[0],a[1],a[2],a[3],a[4],a[5]),o+=f.getLineLength(s.x,s.y,l.x,l.y),s=l;return o;case"Q":for(o=0,s=f.getPointOnQuadraticBezier(0,t,e,a[0],a[1],a[2],a[3]),h=.01;h<=1;h+=.01)l=f.getPointOnQuadraticBezier(h,t,e,a[0],a[1],a[2],a[3]),o+=f.getLineLength(s.x,s.y,l.x,l.y),s=l;return o;case"A":o=0;var b=a[4],w=a[5],c=a[4]+w,_=Math.PI/180;if(Math.abs(b-c)<_&&(_=Math.abs(b-c)),s=f.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],b,0),w<0)for(h=b-_;h>c;h-=_)l=f.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],h,0),o+=f.getLineLength(s.x,s.y,l.x,l.y),s=l;else for(h=b+_;h<c;h+=_)l=f.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],h,0),o+=f.getLineLength(s.x,s.y,l.x,l.y),s=l;return l=f.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],c,0),o+=f.getLineLength(s.x,s.y,l.x,l.y),o}return 0},r.convertEndpointToCenterParameterization=function(t,e,i,a,o,s,l,h,f){var b=f*(Math.PI/180),w=Math.cos(b)*(t-i)/2+Math.sin(b)*(e-a)/2,c=-1*Math.sin(b)*(t-i)/2+Math.cos(b)*(e-a)/2,_=w*w/(l*l)+c*c/(h*h);_>1&&(l*=Math.sqrt(_),h*=Math.sqrt(_));var g=Math.sqrt((l*l*(h*h)-l*l*(c*c)-h*h*(w*w))/(l*l*(c*c)+h*h*(w*w)));o===s&&(g*=-1),isNaN(g)&&(g=0);var T=g*l*c/h,P=g*-h*w/l,N=(t+i)/2+Math.cos(b)*T-Math.sin(b)*P,d=(e+a)/2+Math.sin(b)*T+Math.cos(b)*P,p=function(O){return Math.sqrt(O[0]*O[0]+O[1]*O[1])},m=function(O,R){return(O[0]*R[0]+O[1]*R[1])/(p(O)*p(R))},A=function(O,R){return(O[0]*R[1]<O[1]*R[0]?-1:1)*Math.acos(m(O,R))},E=A([1,0],[(w-T)/l,(c-P)/h]),C=[(w-T)/l,(c-P)/h],G=[(-1*w-T)/l,(-1*c-P)/h],M=A(C,G);return m(C,G)<=-1&&(M=Math.PI),m(C,G)>=1&&(M=0),s===0&&M>0&&(M=M-2*Math.PI),s===1&&M<0&&(M=M+2*Math.PI),[N,d,l,h,E,M,b,s]},r}(io.Shape);ve.Path=oe;oe.prototype.className="Path";oe.prototype._attrsAffectingSize=["data"];ao._registerNode(oe);ro.Factory.addGetterSetter(oe,"data");eo.Collection.mapMethods(oe);var _e={},no=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(_e,"__esModule",{value:!0});_e.Rect=void 0;var oo=et,so=Q,ho=dt,lo=J,uo=W,ye=function(n){no(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.cornerRadius(),i=this.width(),a=this.height();if(t.beginPath(),!e)t.rect(0,0,i,a);else{var o=0,s=0,l=0,h=0;typeof e=="number"?o=s=l=h=Math.min(e,i/2,a/2):(o=Math.min(e[0]||0,i/2,a/2),s=Math.min(e[1]||0,i/2,a/2),h=Math.min(e[2]||0,i/2,a/2),l=Math.min(e[3]||0,i/2,a/2)),t.moveTo(o,0),t.lineTo(i-s,0),t.arc(i-s,s,s,Math.PI*3/2,0,!1),t.lineTo(i,a-h),t.arc(i-h,a-h,h,0,Math.PI/2,!1),t.lineTo(l,a),t.arc(l,a-l,l,Math.PI/2,Math.PI,!1),t.lineTo(0,o),t.arc(o,o,o,Math.PI,Math.PI*3/2,!1)}t.closePath(),t.fillStrokeShape(this)},r}(ho.Shape);_e.Rect=ye;ye.prototype.className="Rect";lo._registerNode(ye);so.Factory.addGetterSetter(ye,"cornerRadius",0,uo.getNumberOrArrayOfNumbersValidator(4));oo.Collection.mapMethods(ye);var Je={},fo=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Je,"__esModule",{value:!0});Je.RegularPolygon=void 0;var co=et,Yi=Q,po=dt,Xi=W,go=J,It=function(n){fo(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),t.fillStrokeShape(this)},r.prototype._getPoints=function(){for(var t=this.attrs.sides,e=this.attrs.radius||0,i=[],a=0;a<t;a++)i.push({x:e*Math.sin(a*2*Math.PI/t),y:-1*e*Math.cos(a*2*Math.PI/t)});return i},r.prototype.getSelfRect=function(){var t=this._getPoints(),e=t[0].x,i=t[0].y,a=t[0].x,o=t[0].y;return t.forEach(function(s){e=Math.min(e,s.x),i=Math.max(i,s.x),a=Math.min(a,s.y),o=Math.max(o,s.y)}),{x:e,y:a,width:i-e,height:o-a}},r.prototype.getWidth=function(){return this.radius()*2},r.prototype.getHeight=function(){return this.radius()*2},r.prototype.setWidth=function(t){this.radius(t/2)},r.prototype.setHeight=function(t){this.radius(t/2)},r}(po.Shape);Je.RegularPolygon=It;It.prototype.className="RegularPolygon";It.prototype._centroid=!0;It.prototype._attrsAffectingSize=["radius"];go._registerNode(It);Yi.Factory.addGetterSetter(It,"radius",0,Xi.getNumberValidator());Yi.Factory.addGetterSetter(It,"sides",0,Xi.getNumberValidator());co.Collection.mapMethods(It);var Ze={},vo=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ze,"__esModule",{value:!0});Ze.Ring=void 0;var _o=et,qi=Q,yo=dt,Qi=W,mo=J,li=Math.PI*2,Ut=function(n){vo(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,li,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),li,0,!0),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.outerRadius()*2},r.prototype.getHeight=function(){return this.outerRadius()*2},r.prototype.setWidth=function(t){this.outerRadius(t/2)},r.prototype.setHeight=function(t){this.outerRadius(t/2)},r}(yo.Shape);Ze.Ring=Ut;Ut.prototype.className="Ring";Ut.prototype._centroid=!0;Ut.prototype._attrsAffectingSize=["innerRadius","outerRadius"];mo._registerNode(Ut);qi.Factory.addGetterSetter(Ut,"innerRadius",0,Qi.getNumberValidator());qi.Factory.addGetterSetter(Ut,"outerRadius",0,Qi.getNumberValidator());_o.Collection.mapMethods(Ut);var tr={},So=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(tr,"__esModule",{value:!0});tr.Sprite=void 0;var bo=et,Yt=Q,Co=dt,wo=ae,Ji=W,Po=J,bt=function(n){So(r,n);function r(t){var e=n.call(this,t)||this;return e._updated=!0,e.anim=new wo.Animation(function(){var i=e._updated;return e._updated=!1,i}),e.on("animationChange.konva",function(){this.frameIndex(0)}),e.on("frameIndexChange.konva",function(){this._updated=!0}),e.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}),e}return r.prototype._sceneFunc=function(t){var e=this.animation(),i=this.frameIndex(),a=i*4,o=this.animations()[e],s=this.frameOffsets(),l=o[a+0],h=o[a+1],f=o[a+2],b=o[a+3],w=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,f,b),t.closePath(),t.fillStrokeShape(this)),w)if(s){var c=s[e],_=i*2;t.drawImage(w,l,h,f,b,c[_+0],c[_+1],f,b)}else t.drawImage(w,l,h,f,b,0,0,f,b)},r.prototype._hitFunc=function(t){var e=this.animation(),i=this.frameIndex(),a=i*4,o=this.animations()[e],s=this.frameOffsets(),l=o[a+2],h=o[a+3];if(t.beginPath(),s){var f=s[e],b=i*2;t.rect(f[b+0],f[b+1],l,h)}else t.rect(0,0,l,h);t.closePath(),t.fillShape(this)},r.prototype._useBufferCanvas=function(){return n.prototype._useBufferCanvas.call(this,!0)},r.prototype._setInterval=function(){var t=this;this.interval=setInterval(function(){t._updateIndex()},1e3/this.frameRate())},r.prototype.start=function(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}},r.prototype.stop=function(){this.anim.stop(),clearInterval(this.interval)},r.prototype.isRunning=function(){return this.anim.isRunning()},r.prototype._updateIndex=function(){var t=this.frameIndex(),e=this.animation(),i=this.animations(),a=i[e],o=a.length/4;t<o-1?this.frameIndex(t+1):this.frameIndex(0)},r}(Co.Shape);tr.Sprite=bt;bt.prototype.className="Sprite";Po._registerNode(bt);Yt.Factory.addGetterSetter(bt,"animation");Yt.Factory.addGetterSetter(bt,"animations");Yt.Factory.addGetterSetter(bt,"frameOffsets");Yt.Factory.addGetterSetter(bt,"image");Yt.Factory.addGetterSetter(bt,"frameIndex",0,Ji.getNumberValidator());Yt.Factory.addGetterSetter(bt,"frameRate",17,Ji.getNumberValidator());Yt.Factory.backCompat(bt,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});bo.Collection.mapMethods(bt);var er={},To=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(er,"__esModule",{value:!0});er.Star=void 0;var Oo=et,Yr=Q,Ao=dt,Xr=W,xo=J,Gt=function(n){To(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){var e=this.innerRadius(),i=this.outerRadius(),a=this.numPoints();t.beginPath(),t.moveTo(0,0-i);for(var o=1;o<a*2;o++){var s=o%2===0?i:e,l=s*Math.sin(o*Math.PI/a),h=-1*s*Math.cos(o*Math.PI/a);t.lineTo(l,h)}t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.outerRadius()*2},r.prototype.getHeight=function(){return this.outerRadius()*2},r.prototype.setWidth=function(t){this.outerRadius(t/2)},r.prototype.setHeight=function(t){this.outerRadius(t/2)},r}(Ao.Shape);er.Star=Gt;Gt.prototype.className="Star";Gt.prototype._centroid=!0;Gt.prototype._attrsAffectingSize=["innerRadius","outerRadius"];xo._registerNode(Gt);Yr.Factory.addGetterSetter(Gt,"numPoints",5,Xr.getNumberValidator());Yr.Factory.addGetterSetter(Gt,"innerRadius",0,Xr.getNumberValidator());Yr.Factory.addGetterSetter(Gt,"outerRadius",0,Xr.getNumberValidator());Oo.Collection.mapMethods(Gt);var Ht={},Fo=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(Ht,"__esModule",{value:!0});Ht.Text=Ht.stringToArray=void 0;var Ae=et,pt=Q,Mo=dt,Eo=J,Vt=W,ko=J;function Zi(n){return Array.from(n)}Ht.stringToArray=Zi;var we="auto",No="center",he="justify",Go="Change.konva",Ro="2d",ui="-",ta="left",Do="text",Lo="Text",Io="top",Uo="bottom",di="middle",ea="normal",fi="px ",le=" ",Vo="right",$o="word",Bo="char",Ho="none",kr="",ra=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],jo=ra.length;function zo(n){return n.split(",").map(function(r){r=r.trim();var t=r.indexOf(" ")>=0,e=r.indexOf('"')>=0||r.indexOf("'")>=0;return t&&!e&&(r='"'+r+'"'),r}).join(", ")}var Pe;function Nr(){return Pe||(Pe=Ae.Util.createCanvasElement().getContext(Ro),Pe)}function Wo(n){n.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Ko(n){n.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Yo(n){return n=n||{},!n.fillLinearGradientColorStops&&!n.fillRadialGradientColorStops&&!n.fillPatternImage&&(n.fill=n.fill||"black"),n}var ht=function(n){Fo(r,n);function r(t){var e=n.call(this,Yo(t))||this;e._partialTextX=0,e._partialTextY=0;for(var i=0;i<jo;i++)e.on(ra[i]+Go,e._setTextData);return e._setTextData(),e}return r.prototype._sceneFunc=function(t){var e=this.textArr,i=e.length;if(this.text()){var a=this.padding(),o=this.fontSize(),s=this.lineHeight()*o,l=this.verticalAlign(),h=0,f=this.align(),b=this.getWidth(),w=this.letterSpacing(),c=this.fill(),_=this.textDecoration(),g=_.indexOf("underline")!==-1,T=_.indexOf("line-through")!==-1,P,N=0,N=s/2,d=0,p=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",di),t.setAttr("textAlign",ta),l===di?h=(this.getHeight()-i*s-a*2)/2:l===Uo&&(h=this.getHeight()-i*s-a*2),t.translate(a,h+a),P=0;P<i;P++){var d=0,p=0,m=e[P],A=m.text,E=m.width,C=P!==i-1,G,M,O;if(t.save(),f===Vo?d+=b-E-a*2:f===No&&(d+=(b-E-a*2)/2),g&&(t.save(),t.beginPath(),t.moveTo(d,N+p+Math.round(o/2)),G=A.split(" ").length-1,M=G===0,O=f===he&&C&&!M?b-a*2:E,t.lineTo(d+Math.round(O),N+p+Math.round(o/2)),t.lineWidth=o/15,t.strokeStyle=c,t.stroke(),t.restore()),T&&(t.save(),t.beginPath(),t.moveTo(d,N+p),G=A.split(" ").length-1,M=G===0,O=f===he&&C&&!M?b-a*2:E,t.lineTo(d+Math.round(O),N+p),t.lineWidth=o/15,t.strokeStyle=c,t.stroke(),t.restore()),w!==0||f===he){G=A.split(" ").length-1;for(var R=Zi(A),D=0;D<R.length;D++){var I=R[D];I===" "&&P!==i-1&&f===he&&(d+=(b-a*2-E)/G),this._partialTextX=d,this._partialTextY=N+p,this._partialText=I,t.fillStrokeShape(this),d+=this.measureSize(I).width+w}}else this._partialTextX=d,this._partialTextY=N+p,this._partialText=A,t.fillStrokeShape(this);t.restore(),i>1&&(N+=s)}}},r.prototype._hitFunc=function(t){var e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)},r.prototype.setText=function(t){var e=Ae.Util._isString(t)?t:t==null?"":t+"";return this._setAttr(Do,e),this},r.prototype.getWidth=function(){var t=this.attrs.width===we||this.attrs.width===void 0;return t?this.getTextWidth()+this.padding()*2:this.attrs.width},r.prototype.getHeight=function(){var t=this.attrs.height===we||this.attrs.height===void 0;return t?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height},r.prototype.getTextWidth=function(){return this.textWidth},r.prototype.getTextHeight=function(){return Ae.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight},r.prototype.measureSize=function(t){var e=Nr(),i=this.fontSize(),a;return e.save(),e.font=this._getContextFont(),a=e.measureText(t),e.restore(),{width:a.width,height:i}},r.prototype._getContextFont=function(){return Eo.Konva.UA.isIE?this.fontStyle()+le+this.fontSize()+fi+this.fontFamily():this.fontStyle()+le+this.fontVariant()+le+(this.fontSize()+fi)+zo(this.fontFamily())},r.prototype._addTextLine=function(t){this.align()===he&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e})},r.prototype._getTextWidth=function(t){var e=this.letterSpacing(),i=t.length;return Nr().measureText(t).width+(i?e*(i-1):0)},r.prototype._setTextData=function(){var t=this.text().split(`
`),e=+this.fontSize(),i=0,a=this.lineHeight()*e,o=this.attrs.width,s=this.attrs.height,l=o!==we&&o!==void 0,h=s!==we&&s!==void 0,f=this.padding(),b=o-f*2,w=s-f*2,c=0,_=this.wrap(),g=_!==Ho,T=_!==Bo&&g,P=this.ellipsis();this.textArr=[],Nr().font=this._getContextFont();for(var N=P?this._getTextWidth(kr):0,d=0,p=t.length;d<p;++d){var m=t[d],A=this._getTextWidth(m);if(l&&A>b)for(;m.length>0;){for(var E=0,C=m.length,G="",M=0;E<C;){var O=E+C>>>1,R=m.slice(0,O+1),D=this._getTextWidth(R)+N;D<=b?(E=O+1,G=R,M=D):C=O}if(G){if(T){var I,j=m[G.length],B=j===le||j===ui;B&&M<=b?I=G.length:I=Math.max(G.lastIndexOf(le),G.lastIndexOf(ui))+1,I>0&&(E=I,G=G.slice(0,E),M=this._getTextWidth(G))}if(G=G.trimRight(),this._addTextLine(G),i=Math.max(i,M),c+=a,!g||h&&c+a>w){var U=this.textArr[this.textArr.length-1];if(U&&P){var z=this._getTextWidth(U.text+kr)<b;z||(U.text=U.text.slice(0,U.text.length-3)),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(U.text+kr)}break}if(m=m.slice(E),m=m.trimLeft(),m.length>0&&(A=this._getTextWidth(m),A<=b)){this._addTextLine(m),c+=a,i=Math.max(i,A);break}}else break}else this._addTextLine(m),c+=a,i=Math.max(i,A);if(h&&c+a>w)break}this.textHeight=e,this.textWidth=i},r.prototype.getStrokeScaleEnabled=function(){return!0},r}(Mo.Shape);Ht.Text=ht;ht.prototype._fillFunc=Wo;ht.prototype._strokeFunc=Ko;ht.prototype.className=Lo;ht.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];ko._registerNode(ht);pt.Factory.overWriteSetter(ht,"width",Vt.getNumberOrAutoValidator());pt.Factory.overWriteSetter(ht,"height",Vt.getNumberOrAutoValidator());pt.Factory.addGetterSetter(ht,"fontFamily","Arial");pt.Factory.addGetterSetter(ht,"fontSize",12,Vt.getNumberValidator());pt.Factory.addGetterSetter(ht,"fontStyle",ea);pt.Factory.addGetterSetter(ht,"fontVariant",ea);pt.Factory.addGetterSetter(ht,"padding",0,Vt.getNumberValidator());pt.Factory.addGetterSetter(ht,"align",ta);pt.Factory.addGetterSetter(ht,"verticalAlign",Io);pt.Factory.addGetterSetter(ht,"lineHeight",1,Vt.getNumberValidator());pt.Factory.addGetterSetter(ht,"wrap",$o);pt.Factory.addGetterSetter(ht,"ellipsis",!1,Vt.getBooleanValidator());pt.Factory.addGetterSetter(ht,"letterSpacing",0,Vt.getNumberValidator());pt.Factory.addGetterSetter(ht,"text","",Vt.getStringValidator());pt.Factory.addGetterSetter(ht,"textDecoration","");Ae.Collection.mapMethods(ht);var rr={},Xo=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(rr,"__esModule",{value:!0});rr.TextPath=void 0;var Oe=et,Ct=Q,qo=dt,wt=ve,Gr=Ht,ia=W,Qo=J,Jo="",aa="normal";function na(n){n.fillText(this.partialText,0,0)}function oa(n){n.strokeText(this.partialText,0,0)}var ut=function(n){Xo(r,n);function r(t){var e=n.call(this,t)||this;return e.dummyCanvas=Oe.Util.createCanvasElement(),e.dataArray=[],e.dataArray=wt.Path.parsePathData(e.attrs.data),e.on("dataChange.konva",function(){this.dataArray=wt.Path.parsePathData(this.attrs.data),this._setTextData()}),e.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva",e._setTextData),t&&t.getKerning&&(Oe.Util.warn('getKerning TextPath API is deprecated. Please use "kerningFunc" instead.'),e.kerningFunc(t.getKerning)),e._setTextData(),e}return r.prototype._sceneFunc=function(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),i=this.fill(),a=this.fontSize(),o=this.glyphInfo;e==="underline"&&t.beginPath();for(var s=0;s<o.length;s++){t.save();var l=o[s].p0;t.translate(l.x,l.y),t.rotate(o[s].rotation),this.partialText=o[s].text,t.fillStrokeShape(this),e==="underline"&&(s===0&&t.moveTo(0,a/2+1),t.lineTo(a,a/2+1)),t.restore()}e==="underline"&&(t.strokeStyle=i,t.lineWidth=a/20,t.stroke()),t.restore()},r.prototype._hitFunc=function(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var i=e[0].p0;t.moveTo(i.x,i.y)}for(var a=0;a<e.length;a++){var o=e[a].p1;t.lineTo(o.x,o.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()},r.prototype.getTextWidth=function(){return this.textWidth},r.prototype.getTextHeight=function(){return Oe.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight},r.prototype.setText=function(t){return Gr.Text.prototype.setText.call(this,t)},r.prototype._getContextFont=function(){return Gr.Text.prototype._getContextFont.call(this)},r.prototype._getTextSize=function(t){var e=this.dummyCanvas,i=e.getContext("2d");i.save(),i.font=this._getContextFont();var a=i.measureText(t);return i.restore(),{width:a.width,height:parseInt(this.attrs.fontSize,10)}},r.prototype._setTextData=function(){var t=this,e=this._getTextSize(this.attrs.text),i=this.letterSpacing(),a=this.align(),o=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var s=Math.max(this.textWidth+((this.attrs.text||"").length-1)*i,0);this.glyphInfo=[];for(var l=0,h=0;h<t.dataArray.length;h++)t.dataArray[h].pathLength>0&&(l+=t.dataArray[h].pathLength);var f=0;a==="center"&&(f=Math.max(0,l/2-s/2)),a==="right"&&(f=Math.max(0,l-s));for(var b=Gr.stringToArray(this.text()),w=this.text().split(" ").length-1,c,_,g,T=-1,P=0,N=function(){P=0;for(var D=t.dataArray,I=T+1;I<D.length;I++){if(D[I].pathLength>0)return T=I,D[I];D[I].command==="M"&&(c={x:D[I].points[0],y:D[I].points[1]})}return{}},d=function(D){var I=t._getTextSize(D).width+i;D===" "&&a==="justify"&&(I+=(l-s)/w);var j=0,B=0;for(_=void 0;Math.abs(I-j)/I>.01&&B<20;){B++;for(var U=j;g===void 0;)g=N(),g&&U+g.pathLength<I&&(U+=g.pathLength,g=void 0);if(g==={}||c===void 0)return;var z=!1;switch(g.command){case"L":wt.Path.getLineLength(c.x,c.y,g.points[0],g.points[1])>I?_=wt.Path.getPointOnLine(I,c.x,c.y,g.points[0],g.points[1],c.x,c.y):g=void 0;break;case"A":var F=g.points[4],u=g.points[5],v=g.points[4]+u;P===0?P=F+1e-8:I>j?P+=Math.PI/180*u/Math.abs(u):P-=Math.PI/360*u/Math.abs(u),(u<0&&P<v||u>=0&&P>v)&&(P=v,z=!0),_=wt.Path.getPointOnEllipticalArc(g.points[0],g.points[1],g.points[2],g.points[3],P,g.points[6]);break;case"C":P===0?I>g.pathLength?P=1e-8:P=I/g.pathLength:I>j?P+=(I-j)/g.pathLength/2:P=Math.max(P-(j-I)/g.pathLength/2,0),P>1&&(P=1,z=!0),_=wt.Path.getPointOnCubicBezier(P,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3],g.points[4],g.points[5]);break;case"Q":P===0?P=I/g.pathLength:I>j?P+=(I-j)/g.pathLength:P-=(j-I)/g.pathLength,P>1&&(P=1,z=!0),_=wt.Path.getPointOnQuadraticBezier(P,g.start.x,g.start.y,g.points[0],g.points[1],g.points[2],g.points[3]);break}_!==void 0&&(j=wt.Path.getLineLength(c.x,c.y,_.x,_.y)),z&&(z=!1,g=void 0)}},p="C",m=t._getTextSize(p).width+i,A=f/m-1,E=0;E<A&&(d(p),!(c===void 0||_===void 0));E++)c=_;for(var C=0;C<b.length&&(d(b[C]),!(c===void 0||_===void 0));C++){var G=wt.Path.getLineLength(c.x,c.y,_.x,_.y),M=0;if(o)try{M=o(b[C-1],b[C])*this.fontSize()}catch{M=0}c.x+=M,_.x+=M,this.textWidth+=M;var O=wt.Path.getPointOnLine(M+G/2,c.x,c.y,_.x,_.y),R=Math.atan2(_.y-c.y,_.x-c.x);this.glyphInfo.push({transposeX:O.x,transposeY:O.y,text:b[C],rotation:R,p0:c,p1:_}),c=_}},r.prototype.getSelfRect=function(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach(function(b){t.push(b.p0.x),t.push(b.p0.y),t.push(b.p1.x),t.push(b.p1.y)});for(var e=t[0]||0,i=t[0]||0,a=t[1]||0,o=t[1]||0,s,l,h=0;h<t.length/2;h++)s=t[h*2],l=t[h*2+1],e=Math.min(e,s),i=Math.max(i,s),a=Math.min(a,l),o=Math.max(o,l);var f=this.fontSize();return{x:e-f/2,y:a-f/2,width:i-e+f,height:o-a+f}},r}(qo.Shape);rr.TextPath=ut;ut.prototype._fillFunc=na;ut.prototype._strokeFunc=oa;ut.prototype._fillFuncHit=na;ut.prototype._strokeFuncHit=oa;ut.prototype.className="TextPath";ut.prototype._attrsAffectingSize=["text","fontSize","data"];Qo._registerNode(ut);Ct.Factory.addGetterSetter(ut,"data");Ct.Factory.addGetterSetter(ut,"fontFamily","Arial");Ct.Factory.addGetterSetter(ut,"fontSize",12,ia.getNumberValidator());Ct.Factory.addGetterSetter(ut,"fontStyle",aa);Ct.Factory.addGetterSetter(ut,"align","left");Ct.Factory.addGetterSetter(ut,"letterSpacing",0,ia.getNumberValidator());Ct.Factory.addGetterSetter(ut,"textBaseline","middle");Ct.Factory.addGetterSetter(ut,"fontVariant",aa);Ct.Factory.addGetterSetter(ut,"text",Jo);Ct.Factory.addGetterSetter(ut,"textDecoration",null);Ct.Factory.addGetterSetter(ut,"kerningFunc",null);Oe.Collection.mapMethods(ut);var ir={},Zo=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),xe=Y&&Y.__assign||function(){return xe=Object.assign||function(n){for(var r,t=1,e=arguments.length;t<e;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n},xe.apply(this,arguments)};Object.defineProperty(ir,"__esModule",{value:!0});ir.Transformer=void 0;var it=et,nt=Q,ts=st,es=dt,rs=_e,ci=ie,mt=J,Xt=W,is=J,xt="tr-konva",as=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map(function(n){return n+("."+xt)}).join(" "),pi="nodesRect",ns=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"].map(function(n){return n+("."+xt)}).join(" "),os={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},ss="ontouchstart"in mt.Konva._global;function hs(n,r){if(n==="rotater")return"crosshair";r+=it.Util._degToRad(os[n]||0);var t=(it.Util._radToDeg(r)%360+360)%360;return it.Util._inRange(t,315+22.5,360)||it.Util._inRange(t,0,22.5)?"ns-resize":it.Util._inRange(t,45-22.5,45+22.5)?"nesw-resize":it.Util._inRange(t,90-22.5,90+22.5)?"ew-resize":it.Util._inRange(t,135-22.5,135+22.5)?"nwse-resize":it.Util._inRange(t,180-22.5,180+22.5)?"ns-resize":it.Util._inRange(t,225-22.5,225+22.5)?"nesw-resize":it.Util._inRange(t,270-22.5,270+22.5)?"ew-resize":it.Util._inRange(t,315-22.5,315+22.5)?"nwse-resize":(it.Util.error("Transformer has unknown angle for cursor detection: "+t),"pointer")}var Fe=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],gi=1e8;function ls(n){return{x:n.x+n.width/2*Math.cos(n.rotation)+n.height/2*Math.sin(-n.rotation),y:n.y+n.height/2*Math.cos(n.rotation)+n.width/2*Math.sin(n.rotation)}}function sa(n,r,t){var e=t.x+(n.x-t.x)*Math.cos(r)-(n.y-t.y)*Math.sin(r),i=t.y+(n.x-t.x)*Math.sin(r)+(n.y-t.y)*Math.cos(r);return xe(xe({},n),{rotation:n.rotation+r,x:e,y:i})}function us(n,r){var t=ls(n);return sa(n,r,t)}function ds(n,r,t){for(var e=r,i=0;i<n.length;i++){var a=mt.Konva.getAngle(n[i]),o=Math.abs(a-r)%(Math.PI*2),s=Math.min(o,Math.PI*2-o);s<t&&(e=a)}return e}var at=function(n){Zo(r,n);function r(t){var e=n.call(this,t)||this;return e._transforming=!1,e._createElements(),e._handleMouseMove=e._handleMouseMove.bind(e),e._handleMouseUp=e._handleMouseUp.bind(e),e.update=e.update.bind(e),e.on(as,e.update),e.getNode()&&e.update(),e}return r.prototype.attachTo=function(t){return this.setNode(t),this},r.prototype.setNode=function(t){return it.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])},r.prototype.getNode=function(){return this._nodes&&this._nodes[0]},r.prototype.setNodes=function(t){var e=this;t===void 0&&(t=[]),this._nodes&&this._nodes.length&&this.detach(),this._nodes=t,t.length===1?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(function(a){var o=a._attrsAffectingSize.map(function(l){return l+"Change."+xt}).join(" "),s=function(){e.nodes().length===1&&e.rotation(e.nodes()[0].getAbsoluteRotation()),e._resetTransformCache(),!e._transforming&&!e.isDragging()&&e.update()};a.on(o,s),a.on(ns,s),a.on("_clearTransformCache."+xt,s),a.on("xChange."+xt+" yChange."+xt,s),e._proxyDrag(a)}),this._resetTransformCache();var i=!!this.findOne(".top-left");return i&&this.update(),this},r.prototype._proxyDrag=function(t){var e=this,i;t.on("dragstart."+xt,function(a){i=t.getAbsolutePosition(),!e.isDragging()&&t!==e.findOne(".back")&&e.startDrag(a,!1)}),t.on("dragmove."+xt,function(a){if(i){var o=t.getAbsolutePosition(),s=o.x-i.x,l=o.y-i.y;e.nodes().forEach(function(h){if(h!==t&&!h.isDragging()){var f=h.getAbsolutePosition();h.setAbsolutePosition({x:f.x+s,y:f.y+l}),h.startDrag(a)}}),i=null}})},r.prototype.getNodes=function(){return this._nodes||[]},r.prototype.getActiveAnchor=function(){return this._movingAnchorName},r.prototype.detach=function(){this._nodes&&this._nodes.forEach(function(t){t.off("."+xt)}),this._nodes=[],this._resetTransformCache()},r.prototype._resetTransformCache=function(){this._clearCache(pi),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")},r.prototype._getNodeRect=function(){return this._getCache(pi,this.__getNodeRect)},r.prototype.__getNodeShape=function(t,e,i){e===void 0&&(e=this.rotation());var a=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),o=t.getAbsoluteScale(i),s=t.getAbsolutePosition(i),l=a.x*o.x-t.offsetX()*o.x,h=a.y*o.y-t.offsetY()*o.y,f=(mt.Konva.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),b={x:s.x+l*Math.cos(f)+h*Math.sin(-f),y:s.y+h*Math.cos(f)+l*Math.sin(f),width:a.width*o.x,height:a.height*o.y,rotation:f};return sa(b,-mt.Konva.getAngle(e),{x:0,y:0})},r.prototype.__getNodeRect=function(){var t=this,e=this.getNode();if(!e)return{x:-gi,y:-gi,width:0,height:0,rotation:0};var i=[];this.nodes().map(function(b){var w=b.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:t.ignoreStroke()}),c=[{x:w.x,y:w.y},{x:w.x+w.width,y:w.y},{x:w.x+w.width,y:w.y+w.height},{x:w.x,y:w.y+w.height}],_=b.getAbsoluteTransform();c.forEach(function(g){var T=_.point(g);i.push(T)})});var a=new it.Transform;a.rotate(-mt.Konva.getAngle(this.rotation()));var o,s,l,h;i.forEach(function(b){var w=a.point(b);o===void 0&&(o=l=w.x,s=h=w.y),o=Math.min(o,w.x),s=Math.min(s,w.y),l=Math.max(l,w.x),h=Math.max(h,w.y)}),a.invert();var f=a.point({x:o,y:s});return{x:f.x,y:f.y,width:l-o,height:h-s,rotation:mt.Konva.getAngle(this.rotation())}},r.prototype.getX=function(){return this._getNodeRect().x},r.prototype.getY=function(){return this._getNodeRect().y},r.prototype.getWidth=function(){return this._getNodeRect().width},r.prototype.getHeight=function(){return this._getNodeRect().height},r.prototype._createElements=function(){this._createBack(),Fe.forEach((function(t){this._createAnchor(t)}).bind(this)),this._createAnchor("rotater")},r.prototype._createAnchor=function(t){var e=this,i=new rs.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:ss?10:"auto"}),a=this;i.on("mousedown touchstart",function(o){a._handleMouseDown(o)}),i.on("dragstart",function(o){i.stopDrag(),o.cancelBubble=!0}),i.on("dragend",function(o){o.cancelBubble=!0}),i.on("mouseenter",function(){var o=mt.Konva.getAngle(e.rotation()),s=hs(t,o);i.getStage().content.style.cursor=s,e._cursorChange=!0}),i.on("mouseout",function(){i.getStage().content.style.cursor="",e._cursorChange=!1}),this.add(i)},r.prototype._createBack=function(){var t=this,e=new es.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc:function(i){var a=this.getParent(),o=a.padding();i.beginPath(),i.rect(-o,-o,this.width()+o*2,this.height()+o*2),i.moveTo(this.width()/2,-o),a.rotateEnabled()&&i.lineTo(this.width()/2,-a.rotateAnchorOffset()*it.Util._sign(this.height())-o),i.fillStrokeShape(this)},hitFunc:function(i,a){if(t.shouldOverdrawWholeArea()){var o=t.padding();i.beginPath(),i.rect(-o,-o,a.width()+o*2,a.height()+o*2),i.fillStrokeShape(a)}}});this.add(e),this._proxyDrag(e),e.on("dragstart",function(i){i.cancelBubble=!0}),e.on("dragmove",function(i){i.cancelBubble=!0}),e.on("dragend",function(i){i.cancelBubble=!0})},r.prototype._handleMouseDown=function(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),i=e.width,a=e.height,o=Math.sqrt(Math.pow(i,2)+Math.pow(a,2));this.sin=Math.abs(a/o),this.cos=Math.abs(i/o),window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0),this._transforming=!0;var s=t.target.getAbsolutePosition(),l=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:l.x-s.x,y:l.y-s.y},this._fire("transformstart",{evt:t,target:this.getNode()}),this._nodes.forEach(function(h){h._fire("transformstart",{evt:t,target:h})})},r.prototype._handleMouseMove=function(t){var e,i,a,o=this.findOne("."+this._movingAnchorName),s=o.getStage();s.setPointersPositions(t);var l=s.getPointerPosition(),h={x:l.x-this._anchorDragOffset.x,y:l.y-this._anchorDragOffset.y},f=o.getAbsolutePosition();o.setAbsolutePosition(h);var b=o.getAbsolutePosition();if(!(f.x===b.x&&f.y===b.y)){if(this._movingAnchorName==="rotater"){var w=this._getNodeRect();e=o.x()-w.width/2,i=-o.y()+w.height/2;var c=Math.atan2(-i,e)+Math.PI/2;w.height<0&&(c-=Math.PI);var _=mt.Konva.getAngle(this.rotation()),g=_+c,T=mt.Konva.getAngle(this.rotationSnapTolerance()),P=ds(this.rotationSnaps(),g,T),N=P-w.rotation,d=us(w,N);this._fitNodesInto(d,t);return}var p=this.keepRatio()||t.shiftKey,G=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(p){var m=G?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};a=Math.sqrt(Math.pow(m.x-o.x(),2)+Math.pow(m.y-o.y(),2));var A=this.findOne(".top-left").x()>m.x?-1:1,E=this.findOne(".top-left").y()>m.y?-1:1;e=a*this.cos*A,i=a*this.sin*E,this.findOne(".top-left").x(m.x-e),this.findOne(".top-left").y(m.y-i)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(o.y());else if(this._movingAnchorName==="top-right"){if(p){var m=G?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};a=Math.sqrt(Math.pow(o.x()-m.x,2)+Math.pow(m.y-o.y(),2));var A=this.findOne(".top-right").x()<m.x?-1:1,E=this.findOne(".top-right").y()>m.y?-1:1;e=a*this.cos*A,i=a*this.sin*E,this.findOne(".top-right").x(m.x+e),this.findOne(".top-right").y(m.y-i)}var C=o.position();this.findOne(".top-left").y(C.y),this.findOne(".bottom-right").x(C.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(o.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(o.x());else if(this._movingAnchorName==="bottom-left"){if(p){var m=G?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};a=Math.sqrt(Math.pow(m.x-o.x(),2)+Math.pow(o.y()-m.y,2));var A=m.x<o.x()?-1:1,E=o.y()<m.y?-1:1;e=a*this.cos*A,i=a*this.sin*E,o.x(m.x-e),o.y(m.y+i)}C=o.position(),this.findOne(".top-left").x(C.x),this.findOne(".bottom-right").y(C.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(o.y());else if(this._movingAnchorName==="bottom-right"){if(p){var m=G?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};a=Math.sqrt(Math.pow(o.x()-m.x,2)+Math.pow(o.y()-m.y,2));var A=this.findOne(".bottom-right").x()<m.x?-1:1,E=this.findOne(".bottom-right").y()<m.y?-1:1;e=a*this.cos*A,i=a*this.sin*E,this.findOne(".bottom-right").x(m.x+e),this.findOne(".bottom-right").y(m.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var G=this.centeredScaling()||t.altKey;if(G){var M=this.findOne(".top-left"),O=this.findOne(".bottom-right"),R=M.x(),D=M.y(),I=this.getWidth()-O.x(),j=this.getHeight()-O.y();O.move({x:-R,y:-D}),M.move({x:I,y:j})}var B=this.findOne(".top-left").getAbsolutePosition();e=B.x,i=B.y;var U=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),z=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:i,width:U,height:z,rotation:mt.Konva.getAngle(this.rotation())},t)}},r.prototype._handleMouseUp=function(t){this._removeEvents(t)},r.prototype.getAbsoluteTransform=function(){return this.getTransform()},r.prototype._removeEvents=function(t){if(this._transforming){this._transforming=!1,window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0);var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach(function(i){i._fire("transformend",{evt:t,target:i})}),this._movingAnchorName=null}},r.prototype._fitNodesInto=function(t,e){var i=this,a=this._getNodeRect(),o=1;if(it.Util._inRange(t.width,-this.padding()*2-o,o)){this.update();return}if(it.Util._inRange(t.height,-this.padding()*2-o,o)){this.update();return}var s=new it.Transform;if(s.rotate(mt.Konva.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){var l=s.point({x:-this.padding()*2,y:0});t.x+=l.x,t.y+=l.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){var l=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y,t.width+=this.padding()*2}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){var l=s.point({x:0,y:-this.padding()*2});t.x+=l.x,t.y+=l.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y,t.height+=this.padding()*2}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){var l=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y,t.height+=this.padding()*2}if(this.boundBoxFunc()){var h=this.boundBoxFunc()(a,t);h?t=h:it.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}var f=1e7,b=new it.Transform;b.translate(a.x,a.y),b.rotate(a.rotation),b.scale(a.width/f,a.height/f);var w=new it.Transform;w.translate(t.x,t.y),w.rotate(t.rotation),w.scale(t.width/f,t.height/f);var c=w.multiply(b.invert());this._nodes.forEach(function(_){var g,T=_.getParent().getAbsoluteTransform(),P=_.getTransform().copy();P.translate(_.offsetX(),_.offsetY());var N=new it.Transform;N.multiply(T.copy().invert()).multiply(c).multiply(T).multiply(P);var d=N.decompose();_.setAttrs(d),i._fire("transform",{evt:e,target:_}),_._fire("transform",{evt:e,target:_}),(g=_.getLayer())===null||g===void 0||g.batchDraw()}),this.rotation(it.Util._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()},r.prototype.forceUpdate=function(){this._resetTransformCache(),this.update()},r.prototype._batchChangeChild=function(t,e){var i=this.findOne(t);i.setAttrs(e)},r.prototype.update=function(){var t=this,e,i=this._getNodeRect();this.rotation(it.Util._getRotation(i.rotation));var a=i.width,o=i.height,s=this.enabledAnchors(),l=this.resizeEnabled(),h=this.padding(),f=this.anchorSize();this.find("._anchor").each(function(b){b.setAttrs({width:f,height:f,offsetX:f/2,offsetY:f/2,stroke:t.anchorStroke(),strokeWidth:t.anchorStrokeWidth(),fill:t.anchorFill(),cornerRadius:t.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:f/2+h,offsetY:f/2+h,visible:l&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:a/2,y:0,offsetY:f/2+h,visible:l&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:a,y:0,offsetX:f/2-h,offsetY:f/2+h,visible:l&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:o/2,offsetX:f/2+h,visible:l&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:a,y:o/2,offsetX:f/2-h,visible:l&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:o,offsetX:f/2+h,offsetY:f/2-h,visible:l&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:a/2,y:o,offsetY:f/2-h,visible:l&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:a,y:o,offsetX:f/2-h,offsetY:f/2-h,visible:l&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:a/2,y:-this.rotateAnchorOffset()*it.Util._sign(o)-h,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:a,height:o,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0}),(e=this.getLayer())===null||e===void 0||e.batchDraw()},r.prototype.isTransforming=function(){return this._transforming},r.prototype.stopTransform=function(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}},r.prototype.destroy=function(){return this.getStage()&&this._cursorChange&&(this.getStage().content.style.cursor=""),ci.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this},r.prototype.toObject=function(){return ts.Node.prototype.toObject.call(this)},r}(ci.Group);ir.Transformer=at;function fs(n){return n instanceof Array||it.Util.warn("enabledAnchors value should be an array"),n instanceof Array&&n.forEach(function(r){Fe.indexOf(r)===-1&&it.Util.warn("Unknown anchor name: "+r+". Available names are: "+Fe.join(", "))}),n||[]}at.prototype.className="Transformer";is._registerNode(at);nt.Factory.addGetterSetter(at,"enabledAnchors",Fe,fs);nt.Factory.addGetterSetter(at,"resizeEnabled",!0);nt.Factory.addGetterSetter(at,"anchorSize",10,Xt.getNumberValidator());nt.Factory.addGetterSetter(at,"rotateEnabled",!0);nt.Factory.addGetterSetter(at,"rotationSnaps",[]);nt.Factory.addGetterSetter(at,"rotateAnchorOffset",50,Xt.getNumberValidator());nt.Factory.addGetterSetter(at,"rotationSnapTolerance",5,Xt.getNumberValidator());nt.Factory.addGetterSetter(at,"borderEnabled",!0);nt.Factory.addGetterSetter(at,"anchorStroke","rgb(0, 161, 255)");nt.Factory.addGetterSetter(at,"anchorStrokeWidth",1,Xt.getNumberValidator());nt.Factory.addGetterSetter(at,"anchorFill","white");nt.Factory.addGetterSetter(at,"anchorCornerRadius",0,Xt.getNumberValidator());nt.Factory.addGetterSetter(at,"borderStroke","rgb(0, 161, 255)");nt.Factory.addGetterSetter(at,"borderStrokeWidth",1,Xt.getNumberValidator());nt.Factory.addGetterSetter(at,"borderDash");nt.Factory.addGetterSetter(at,"keepRatio",!0);nt.Factory.addGetterSetter(at,"centeredScaling",!1);nt.Factory.addGetterSetter(at,"ignoreStroke",!1);nt.Factory.addGetterSetter(at,"padding",0,Xt.getNumberValidator());nt.Factory.addGetterSetter(at,"node");nt.Factory.addGetterSetter(at,"nodes");nt.Factory.addGetterSetter(at,"boundBoxFunc");nt.Factory.addGetterSetter(at,"shouldOverdrawWholeArea",!1);nt.Factory.backCompat(at,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});it.Collection.mapMethods(at);var ar={},cs=Y&&Y.__extends||function(){var n=function(r,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])},n(r,t)};return function(r,t){n(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();Object.defineProperty(ar,"__esModule",{value:!0});ar.Wedge=void 0;var ps=et,nr=Q,gs=dt,vs=J,ha=W,_s=J,Ot=function(n){cs(r,n);function r(){return n!==null&&n.apply(this,arguments)||this}return r.prototype._sceneFunc=function(t){t.beginPath(),t.arc(0,0,this.radius(),0,vs.Konva.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)},r.prototype.getWidth=function(){return this.radius()*2},r.prototype.getHeight=function(){return this.radius()*2},r.prototype.setWidth=function(t){this.radius(t/2)},r.prototype.setHeight=function(t){this.radius(t/2)},r}(gs.Shape);ar.Wedge=Ot;Ot.prototype.className="Wedge";Ot.prototype._centroid=!0;Ot.prototype._attrsAffectingSize=["radius"];_s._registerNode(Ot);nr.Factory.addGetterSetter(Ot,"radius",0,ha.getNumberValidator());nr.Factory.addGetterSetter(Ot,"angle",0,ha.getNumberValidator());nr.Factory.addGetterSetter(Ot,"clockwise",!1);nr.Factory.backCompat(Ot,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});ps.Collection.mapMethods(Ot);var or={};Object.defineProperty(or,"__esModule",{value:!0});or.Blur=void 0;var vi=Q,ys=st,ms=W;function _i(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var Ss=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],bs=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function Cs(n,r){var t=n.data,e=n.width,i=n.height,a,o,s,l,h,f,b,w,c,_,g,T,P,N,d,p,m,A,E,C,G,M,O,R,D=r+r+1,I=e-1,j=i-1,B=r+1,U=B*(B+1)/2,z=new _i,F=null,u=z,v=null,y=null,x=Ss[r],k=bs[r];for(s=1;s<D;s++)u=u.next=new _i,s===B&&(F=u);for(u.next=z,b=f=0,o=0;o<i;o++){for(p=m=A=E=w=c=_=g=0,T=B*(C=t[f]),P=B*(G=t[f+1]),N=B*(M=t[f+2]),d=B*(O=t[f+3]),w+=U*C,c+=U*G,_+=U*M,g+=U*O,u=z,s=0;s<B;s++)u.r=C,u.g=G,u.b=M,u.a=O,u=u.next;for(s=1;s<B;s++)l=f+((I<s?I:s)<<2),w+=(u.r=C=t[l])*(R=B-s),c+=(u.g=G=t[l+1])*R,_+=(u.b=M=t[l+2])*R,g+=(u.a=O=t[l+3])*R,p+=C,m+=G,A+=M,E+=O,u=u.next;for(v=z,y=F,a=0;a<e;a++)t[f+3]=O=g*x>>k,O!==0?(O=255/O,t[f]=(w*x>>k)*O,t[f+1]=(c*x>>k)*O,t[f+2]=(_*x>>k)*O):t[f]=t[f+1]=t[f+2]=0,w-=T,c-=P,_-=N,g-=d,T-=v.r,P-=v.g,N-=v.b,d-=v.a,l=b+((l=a+r+1)<I?l:I)<<2,p+=v.r=t[l],m+=v.g=t[l+1],A+=v.b=t[l+2],E+=v.a=t[l+3],w+=p,c+=m,_+=A,g+=E,v=v.next,T+=C=y.r,P+=G=y.g,N+=M=y.b,d+=O=y.a,p-=C,m-=G,A-=M,E-=O,y=y.next,f+=4;b+=e}for(a=0;a<e;a++){for(m=A=E=p=c=_=g=w=0,f=a<<2,T=B*(C=t[f]),P=B*(G=t[f+1]),N=B*(M=t[f+2]),d=B*(O=t[f+3]),w+=U*C,c+=U*G,_+=U*M,g+=U*O,u=z,s=0;s<B;s++)u.r=C,u.g=G,u.b=M,u.a=O,u=u.next;for(h=e,s=1;s<=r;s++)f=h+a<<2,w+=(u.r=C=t[f])*(R=B-s),c+=(u.g=G=t[f+1])*R,_+=(u.b=M=t[f+2])*R,g+=(u.a=O=t[f+3])*R,p+=C,m+=G,A+=M,E+=O,u=u.next,s<j&&(h+=e);for(f=a,v=z,y=F,o=0;o<i;o++)l=f<<2,t[l+3]=O=g*x>>k,O>0?(O=255/O,t[l]=(w*x>>k)*O,t[l+1]=(c*x>>k)*O,t[l+2]=(_*x>>k)*O):t[l]=t[l+1]=t[l+2]=0,w-=T,c-=P,_-=N,g-=d,T-=v.r,P-=v.g,N-=v.b,d-=v.a,l=a+((l=o+B)<j?l:j)*e<<2,w+=p+=v.r=t[l],c+=m+=v.g=t[l+1],_+=A+=v.b=t[l+2],g+=E+=v.a=t[l+3],v=v.next,T+=C=y.r,P+=G=y.g,N+=M=y.b,d+=O=y.a,p-=C,m-=G,A-=M,E-=O,y=y.next,f+=e}}var ws=function(r){var t=Math.round(this.blurRadius());t>0&&Cs(r,t)};or.Blur=ws;vi.Factory.addGetterSetter(ys.Node,"blurRadius",0,ms.getNumberValidator(),vi.Factory.afterSetFilter);var sr={};Object.defineProperty(sr,"__esModule",{value:!0});sr.Brighten=void 0;var yi=Q,Ps=st,Ts=W,Os=function(n){var r=this.brightness()*255,t=n.data,e=t.length,i;for(i=0;i<e;i+=4)t[i]+=r,t[i+1]+=r,t[i+2]+=r};sr.Brighten=Os;yi.Factory.addGetterSetter(Ps.Node,"brightness",0,Ts.getNumberValidator(),yi.Factory.afterSetFilter);var hr={};Object.defineProperty(hr,"__esModule",{value:!0});hr.Contrast=void 0;var mi=Q,As=st,xs=W,Fs=function(n){var r=Math.pow((this.contrast()+100)/100,2),t=n.data,e=t.length,i=150,a=150,o=150,s;for(s=0;s<e;s+=4)i=t[s],a=t[s+1],o=t[s+2],i/=255,i-=.5,i*=r,i+=.5,i*=255,a/=255,a-=.5,a*=r,a+=.5,a*=255,o/=255,o-=.5,o*=r,o+=.5,o*=255,i=i<0?0:i>255?255:i,a=a<0?0:a>255?255:a,o=o<0?0:o>255?255:o,t[s]=i,t[s+1]=a,t[s+2]=o};hr.Contrast=Fs;mi.Factory.addGetterSetter(As.Node,"contrast",0,xs.getNumberValidator(),mi.Factory.afterSetFilter);var lr={};Object.defineProperty(lr,"__esModule",{value:!0});lr.Emboss=void 0;var Rt=Q,ur=st,Ms=et,la=W,Es=function(n){var r=this.embossStrength()*10,t=this.embossWhiteLevel()*255,e=this.embossDirection(),i=this.embossBlend(),a=0,o=0,s=n.data,l=n.width,h=n.height,f=l*4,b=h;switch(e){case"top-left":a=-1,o=-1;break;case"top":a=-1,o=0;break;case"top-right":a=-1,o=1;break;case"right":a=0,o=1;break;case"bottom-right":a=1,o=1;break;case"bottom":a=1,o=0;break;case"bottom-left":a=1,o=-1;break;case"left":a=0,o=-1;break;default:Ms.Util.error("Unknown emboss direction: "+e)}do{var w=(b-1)*f,c=a;b+c<1&&(c=0),b+c>h&&(c=0);var _=(b-1+c)*l*4,g=l;do{var T=w+(g-1)*4,P=o;g+P<1&&(P=0),g+P>l&&(P=0);var N=_+(g-1+P)*4,d=s[T]-s[N],p=s[T+1]-s[N+1],m=s[T+2]-s[N+2],A=d,E=A>0?A:-A,C=p>0?p:-p,G=m>0?m:-m;if(C>E&&(A=p),G>E&&(A=m),A*=r,i){var M=s[T]+A,O=s[T+1]+A,R=s[T+2]+A;s[T]=M>255?255:M<0?0:M,s[T+1]=O>255?255:O<0?0:O,s[T+2]=R>255?255:R<0?0:R}else{var D=t-A;D<0?D=0:D>255&&(D=255),s[T]=s[T+1]=s[T+2]=D}}while(--g)}while(--b)};lr.Emboss=Es;Rt.Factory.addGetterSetter(ur.Node,"embossStrength",.5,la.getNumberValidator(),Rt.Factory.afterSetFilter);Rt.Factory.addGetterSetter(ur.Node,"embossWhiteLevel",.5,la.getNumberValidator(),Rt.Factory.afterSetFilter);Rt.Factory.addGetterSetter(ur.Node,"embossDirection","top-left",null,Rt.Factory.afterSetFilter);Rt.Factory.addGetterSetter(ur.Node,"embossBlend",!1,null,Rt.Factory.afterSetFilter);var dr={};Object.defineProperty(dr,"__esModule",{value:!0});dr.Enhance=void 0;var Si=Q,ks=st,Ns=W;function Rr(n,r,t,e,i){var a=t-r,o=i-e,s;return a===0?e+o/2:o===0?e:(s=(n-r)/a,s=o*s+e,s)}var Gs=function(n){var r=n.data,t=r.length,e=r[0],i=e,a,o=r[1],s=o,l,h=r[2],f=h,b,w,c=this.enhance();if(c!==0){for(w=0;w<t;w+=4)a=r[w+0],a<e?e=a:a>i&&(i=a),l=r[w+1],l<o?o=l:l>s&&(s=l),b=r[w+2],b<h?h=b:b>f&&(f=b);i===e&&(i=255,e=0),s===o&&(s=255,o=0),f===h&&(f=255,h=0);var _,g,T,P,N,d,p,m,A;for(c>0?(g=i+c*(255-i),T=e-c*(e-0),N=s+c*(255-s),d=o-c*(o-0),m=f+c*(255-f),A=h-c*(h-0)):(_=(i+e)*.5,g=i+c*(i-_),T=e+c*(e-_),P=(s+o)*.5,N=s+c*(s-P),d=o+c*(o-P),p=(f+h)*.5,m=f+c*(f-p),A=h+c*(h-p)),w=0;w<t;w+=4)r[w+0]=Rr(r[w+0],e,i,T,g),r[w+1]=Rr(r[w+1],o,s,d,N),r[w+2]=Rr(r[w+2],h,f,A,m)}};dr.Enhance=Gs;Si.Factory.addGetterSetter(ks.Node,"enhance",0,Ns.getNumberValidator(),Si.Factory.afterSetFilter);var fr={};Object.defineProperty(fr,"__esModule",{value:!0});fr.Grayscale=void 0;var Rs=function(n){var r=n.data,t=r.length,e,i;for(e=0;e<t;e+=4)i=.34*r[e]+.5*r[e+1]+.16*r[e+2],r[e]=i,r[e+1]=i,r[e+2]=i};fr.Grayscale=Rs;var cr={};Object.defineProperty(cr,"__esModule",{value:!0});cr.HSL=void 0;var te=Q,qr=st,Qr=W;te.Factory.addGetterSetter(qr.Node,"hue",0,Qr.getNumberValidator(),te.Factory.afterSetFilter);te.Factory.addGetterSetter(qr.Node,"saturation",0,Qr.getNumberValidator(),te.Factory.afterSetFilter);te.Factory.addGetterSetter(qr.Node,"luminance",0,Qr.getNumberValidator(),te.Factory.afterSetFilter);var Ds=function(n){var r=n.data,t=r.length,e=1,i=Math.pow(2,this.saturation()),a=Math.abs(this.hue()+360)%360,o=this.luminance()*127,s,l=e*i*Math.cos(a*Math.PI/180),h=e*i*Math.sin(a*Math.PI/180),f=.299*e+.701*l+.167*h,b=.587*e-.587*l+.33*h,w=.114*e-.114*l-.497*h,c=.299*e-.299*l-.328*h,_=.587*e+.413*l+.035*h,g=.114*e-.114*l+.293*h,T=.299*e-.3*l+1.25*h,P=.587*e-.586*l-1.05*h,N=.114*e+.886*l-.2*h,d,p,m,A;for(s=0;s<t;s+=4)d=r[s+0],p=r[s+1],m=r[s+2],A=r[s+3],r[s+0]=f*d+b*p+w*m+o,r[s+1]=c*d+_*p+g*m+o,r[s+2]=T*d+P*p+N*m+o,r[s+3]=A};cr.HSL=Ds;var pr={};Object.defineProperty(pr,"__esModule",{value:!0});pr.HSV=void 0;var ee=Q,Jr=st,Zr=W,Ls=function(n){var r=n.data,t=r.length,e=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),a=Math.abs(this.hue()+360)%360,o,s=e*i*Math.cos(a*Math.PI/180),l=e*i*Math.sin(a*Math.PI/180),h=.299*e+.701*s+.167*l,f=.587*e-.587*s+.33*l,b=.114*e-.114*s-.497*l,w=.299*e-.299*s-.328*l,c=.587*e+.413*s+.035*l,_=.114*e-.114*s+.293*l,g=.299*e-.3*s+1.25*l,T=.587*e-.586*s-1.05*l,P=.114*e+.886*s-.2*l,N,d,p,m;for(o=0;o<t;o+=4)N=r[o+0],d=r[o+1],p=r[o+2],m=r[o+3],r[o+0]=h*N+f*d+b*p,r[o+1]=w*N+c*d+_*p,r[o+2]=g*N+T*d+P*p,r[o+3]=m};pr.HSV=Ls;ee.Factory.addGetterSetter(Jr.Node,"hue",0,Zr.getNumberValidator(),ee.Factory.afterSetFilter);ee.Factory.addGetterSetter(Jr.Node,"saturation",0,Zr.getNumberValidator(),ee.Factory.afterSetFilter);ee.Factory.addGetterSetter(Jr.Node,"value",0,Zr.getNumberValidator(),ee.Factory.afterSetFilter);var gr={};Object.defineProperty(gr,"__esModule",{value:!0});gr.Invert=void 0;var Is=function(n){var r=n.data,t=r.length,e;for(e=0;e<t;e+=4)r[e]=255-r[e],r[e+1]=255-r[e+1],r[e+2]=255-r[e+2]};gr.Invert=Is;var vr={};Object.defineProperty(vr,"__esModule",{value:!0});vr.Kaleidoscope=void 0;var Me=Q,ua=st,Us=et,da=W,Vs=function(n,r,t){var e=n.data,i=r.data,a=n.width,o=n.height,s=t.polarCenterX||a/2,l=t.polarCenterY||o/2,h,f,b,w=0,c=0,_=0,g=0,T,P=Math.sqrt(s*s+l*l);f=a-s,b=o-l,T=Math.sqrt(f*f+b*b),P=T>P?T:P;var N=o,d=a,p,m,A=360/d*Math.PI/180,E,C;for(m=0;m<d;m+=1)for(E=Math.sin(m*A),C=Math.cos(m*A),p=0;p<N;p+=1)f=Math.floor(s+P*p/N*C),b=Math.floor(l+P*p/N*E),h=(b*a+f)*4,w=e[h+0],c=e[h+1],_=e[h+2],g=e[h+3],h=(m+p*a)*4,i[h+0]=w,i[h+1]=c,i[h+2]=_,i[h+3]=g},$s=function(n,r,t){var e=n.data,i=r.data,a=n.width,o=n.height,s=t.polarCenterX||a/2,l=t.polarCenterY||o/2,h,f,b,w,c,_=0,g=0,T=0,P=0,N,d=Math.sqrt(s*s+l*l);f=a-s,b=o-l,N=Math.sqrt(f*f+b*b),d=N>d?N:d;var p=o,m=a,A,E,C=t.polarRotation||0,G,M;for(f=0;f<a;f+=1)for(b=0;b<o;b+=1)w=f-s,c=b-l,A=Math.sqrt(w*w+c*c)*p/d,E=(Math.atan2(c,w)*180/Math.PI+360+C)%360,E=E*m/360,G=Math.floor(E),M=Math.floor(A),h=(M*a+G)*4,_=e[h+0],g=e[h+1],T=e[h+2],P=e[h+3],h=(b*a+f)*4,i[h+0]=_,i[h+1]=g,i[h+2]=T,i[h+3]=P},Bs=function(n){var r=n.width,t=n.height,e,i,a,o,s,l,h,f,b,w,c=Math.round(this.kaleidoscopePower()),_=Math.round(this.kaleidoscopeAngle()),g=Math.floor(r*(_%360)/360);if(!(c<1)){var T=Us.Util.createCanvasElement();T.width=r,T.height=t;var P=T.getContext("2d").getImageData(0,0,r,t);Vs(n,P,{polarCenterX:r/2,polarCenterY:t/2});for(var N=r/Math.pow(2,c);N<=8;)N=N*2,c-=1;N=Math.ceil(N);var d=N,p=0,m=d,A=1;for(g+N>r&&(p=d,m=0,A=-1),i=0;i<t;i+=1)for(e=p;e!==m;e+=A)a=Math.round(e+g)%r,b=(r*i+a)*4,s=P.data[b+0],l=P.data[b+1],h=P.data[b+2],f=P.data[b+3],w=(r*i+e)*4,P.data[w+0]=s,P.data[w+1]=l,P.data[w+2]=h,P.data[w+3]=f;for(i=0;i<t;i+=1)for(d=Math.floor(N),o=0;o<c;o+=1){for(e=0;e<d+1;e+=1)b=(r*i+e)*4,s=P.data[b+0],l=P.data[b+1],h=P.data[b+2],f=P.data[b+3],w=(r*i+d*2-e-1)*4,P.data[w+0]=s,P.data[w+1]=l,P.data[w+2]=h,P.data[w+3]=f;d*=2}$s(P,n,{polarRotation:0})}};vr.Kaleidoscope=Bs;Me.Factory.addGetterSetter(ua.Node,"kaleidoscopePower",2,da.getNumberValidator(),Me.Factory.afterSetFilter);Me.Factory.addGetterSetter(ua.Node,"kaleidoscopeAngle",0,da.getNumberValidator(),Me.Factory.afterSetFilter);var _r={};Object.defineProperty(_r,"__esModule",{value:!0});_r.Mask=void 0;var bi=Q,Hs=st,js=W;function Te(n,r,t){var e=(t*n.width+r)*4,i=[];return i.push(n.data[e++],n.data[e++],n.data[e++],n.data[e++]),i}function ue(n,r){return Math.sqrt(Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2)+Math.pow(n[2]-r[2],2))}function zs(n){for(var r=[0,0,0],t=0;t<n.length;t++)r[0]+=n[t][0],r[1]+=n[t][1],r[2]+=n[t][2];return r[0]/=n.length,r[1]/=n.length,r[2]/=n.length,r}function Ws(n,r){var t=Te(n,0,0),e=Te(n,n.width-1,0),i=Te(n,0,n.height-1),a=Te(n,n.width-1,n.height-1),o=r||10;if(ue(t,e)<o&&ue(e,a)<o&&ue(a,i)<o&&ue(i,t)<o){for(var s=zs([e,t,a,i]),l=[],h=0;h<n.width*n.height;h++){var f=ue(s,[n.data[h*4],n.data[h*4+1],n.data[h*4+2]]);l[h]=f<o?0:255}return l}}function Ks(n,r){for(var t=0;t<n.width*n.height;t++)n.data[4*t+3]=r[t]}function Ys(n,r,t){for(var e=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(e.length)),a=Math.floor(i/2),o=[],s=0;s<t;s++)for(var l=0;l<r;l++){for(var h=s*r+l,f=0,b=0;b<i;b++)for(var w=0;w<i;w++){var c=s+b-a,_=l+w-a;if(c>=0&&c<t&&_>=0&&_<r){var g=c*r+_,T=e[b*i+w];f+=n[g]*T}}o[h]=f===255*8?255:0}return o}function Xs(n,r,t){for(var e=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(e.length)),a=Math.floor(i/2),o=[],s=0;s<t;s++)for(var l=0;l<r;l++){for(var h=s*r+l,f=0,b=0;b<i;b++)for(var w=0;w<i;w++){var c=s+b-a,_=l+w-a;if(c>=0&&c<t&&_>=0&&_<r){var g=c*r+_,T=e[b*i+w];f+=n[g]*T}}o[h]=f>=255*4?255:0}return o}function qs(n,r,t){for(var e=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(e.length)),a=Math.floor(i/2),o=[],s=0;s<t;s++)for(var l=0;l<r;l++){for(var h=s*r+l,f=0,b=0;b<i;b++)for(var w=0;w<i;w++){var c=s+b-a,_=l+w-a;if(c>=0&&c<t&&_>=0&&_<r){var g=c*r+_,T=e[b*i+w];f+=n[g]*T}}o[h]=f}return o}var Qs=function(n){var r=this.threshold(),t=Ws(n,r);return t&&(t=Ys(t,n.width,n.height),t=Xs(t,n.width,n.height),t=qs(t,n.width,n.height),Ks(n,t)),n};_r.Mask=Qs;bi.Factory.addGetterSetter(Hs.Node,"threshold",0,js.getNumberValidator(),bi.Factory.afterSetFilter);var yr={};Object.defineProperty(yr,"__esModule",{value:!0});yr.Noise=void 0;var Ci=Q,Js=st,Zs=W,th=function(n){var r=this.noise()*255,t=n.data,e=t.length,i=r/2,a;for(a=0;a<e;a+=4)t[a+0]+=i-2*i*Math.random(),t[a+1]+=i-2*i*Math.random(),t[a+2]+=i-2*i*Math.random()};yr.Noise=th;Ci.Factory.addGetterSetter(Js.Node,"noise",.2,Zs.getNumberValidator(),Ci.Factory.afterSetFilter);var mr={};Object.defineProperty(mr,"__esModule",{value:!0});mr.Pixelate=void 0;var wi=Q,eh=et,rh=st,ih=W,ah=function(n){var r=Math.ceil(this.pixelSize()),t=n.width,e=n.height,i,a,o,s,l,h,f,b=Math.ceil(t/r),w=Math.ceil(e/r),c,_,g,T,P,N,d,p=n.data;if(r<=0){eh.Util.error("pixelSize value can not be <= 0");return}for(P=0;P<b;P+=1)for(N=0;N<w;N+=1){for(s=0,l=0,h=0,f=0,c=P*r,_=c+r,g=N*r,T=g+r,d=0,i=c;i<_;i+=1)if(!(i>=t))for(a=g;a<T;a+=1)a>=e||(o=(t*a+i)*4,s+=p[o+0],l+=p[o+1],h+=p[o+2],f+=p[o+3],d+=1);for(s=s/d,l=l/d,h=h/d,f=f/d,i=c;i<_;i+=1)if(!(i>=t))for(a=g;a<T;a+=1)a>=e||(o=(t*a+i)*4,p[o+0]=s,p[o+1]=l,p[o+2]=h,p[o+3]=f)}};mr.Pixelate=ah;wi.Factory.addGetterSetter(rh.Node,"pixelSize",8,ih.getNumberValidator(),wi.Factory.afterSetFilter);var Sr={};Object.defineProperty(Sr,"__esModule",{value:!0});Sr.Posterize=void 0;var Pi=Q,nh=st,oh=W,sh=function(n){var r=Math.round(this.levels()*254)+1,t=n.data,e=t.length,i=255/r,a;for(a=0;a<e;a+=1)t[a]=Math.floor(t[a]/i)*i};Sr.Posterize=sh;Pi.Factory.addGetterSetter(nh.Node,"levels",.5,oh.getNumberValidator(),Pi.Factory.afterSetFilter);var br={};Object.defineProperty(br,"__esModule",{value:!0});br.RGB=void 0;var Ee=Q,ti=st,hh=W,lh=function(n){var r=n.data,t=r.length,e=this.red(),i=this.green(),a=this.blue(),o,s;for(o=0;o<t;o+=4)s=(.34*r[o]+.5*r[o+1]+.16*r[o+2])/255,r[o]=s*e,r[o+1]=s*i,r[o+2]=s*a,r[o+3]=r[o+3]};br.RGB=lh;Ee.Factory.addGetterSetter(ti.Node,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});Ee.Factory.addGetterSetter(ti.Node,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});Ee.Factory.addGetterSetter(ti.Node,"blue",0,hh.RGBComponent,Ee.Factory.afterSetFilter);var Cr={};Object.defineProperty(Cr,"__esModule",{value:!0});Cr.RGBA=void 0;var ce=Q,wr=st,uh=W,dh=function(n){var r=n.data,t=r.length,e=this.red(),i=this.green(),a=this.blue(),o=this.alpha(),s,l;for(s=0;s<t;s+=4)l=1-o,r[s]=e*o+r[s]*l,r[s+1]=i*o+r[s+1]*l,r[s+2]=a*o+r[s+2]*l};Cr.RGBA=dh;ce.Factory.addGetterSetter(wr.Node,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});ce.Factory.addGetterSetter(wr.Node,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});ce.Factory.addGetterSetter(wr.Node,"blue",0,uh.RGBComponent,ce.Factory.afterSetFilter);ce.Factory.addGetterSetter(wr.Node,"alpha",1,function(n){return this._filterUpToDate=!1,n>1?1:n<0?0:n});var Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});Pr.Sepia=void 0;var fh=function(n){var r=n.data,t=r.length,e,i,a,o;for(e=0;e<t;e+=4)i=r[e+0],a=r[e+1],o=r[e+2],r[e+0]=Math.min(255,i*.393+a*.769+o*.189),r[e+1]=Math.min(255,i*.349+a*.686+o*.168),r[e+2]=Math.min(255,i*.272+a*.534+o*.131)};Pr.Sepia=fh;var Tr={};Object.defineProperty(Tr,"__esModule",{value:!0});Tr.Solarize=void 0;var ch=function(n){var r=n.data,t=n.width,e=n.height,i=t*4,a=e;do{var o=(a-1)*i,s=t;do{var l=o+(s-1)*4,h=r[l],f=r[l+1],b=r[l+2];h>127&&(h=255-h),f>127&&(f=255-f),b>127&&(b=255-b),r[l]=h,r[l+1]=f,r[l+2]=b}while(--s)}while(--a)};Tr.Solarize=ch;var Or={};Object.defineProperty(Or,"__esModule",{value:!0});Or.Threshold=void 0;var Ti=Q,ph=st,gh=W,vh=function(n){var r=this.threshold()*255,t=n.data,e=t.length,i;for(i=0;i<e;i+=1)t[i]=t[i]<r?0:255};Or.Threshold=vh;Ti.Factory.addGetterSetter(ph.Node,"threshold",.5,gh.getNumberValidator(),Ti.Factory.afterSetFilter);Object.defineProperty(ke,"__esModule",{value:!0});ke.Konva=void 0;var Oi=Ne,_h=$e,yh=je,mh=We,Sh=Ke,bh=Ye,Ai=Zt,Ch=ge,wh=ve,Ph=_e,Th=Je,Oh=Ze,Ah=tr,xh=er,Fh=Ht,Mh=rr,Eh=ir,kh=ar,Nh=or,Gh=sr,Rh=hr,Dh=lr,Lh=dr,Ih=fr,Uh=cr,Vh=pr,$h=gr,Bh=vr,Hh=_r,jh=yr,zh=mr,Wh=Sr,Kh=br,Yh=Cr,Xh=Pr,qh=Tr,Qh=Or;ke.Konva=Oi.Konva.Util._assign(Oi.Konva,{Arc:_h.Arc,Arrow:yh.Arrow,Circle:mh.Circle,Ellipse:Sh.Ellipse,Image:bh.Image,Label:Ai.Label,Tag:Ai.Tag,Line:Ch.Line,Path:wh.Path,Rect:Ph.Rect,RegularPolygon:Th.RegularPolygon,Ring:Oh.Ring,Sprite:Ah.Sprite,Star:xh.Star,Text:Fh.Text,TextPath:Mh.TextPath,Transformer:Eh.Transformer,Wedge:kh.Wedge,Filters:{Blur:Nh.Blur,Brighten:Gh.Brighten,Contrast:Rh.Contrast,Emboss:Dh.Emboss,Enhance:Lh.Enhance,Grayscale:Ih.Grayscale,HSL:Uh.HSL,HSV:Vh.HSV,Invert:$h.Invert,Kaleidoscope:Bh.Kaleidoscope,Mask:Hh.Mask,Noise:jh.Noise,Pixelate:zh.Pixelate,Posterize:Wh.Posterize,RGB:Kh.RGB,RGBA:Yh.RGBA,Sepia:Xh.Sepia,Solarize:qh.Solarize,Threshold:Qh.Threshold}});(function(n,r){var t=ke.Konva;t._injectGlobal(t),r.default=t,n.exports=r.default})(Dr,Dr.exports);var Jh=Dr.exports;const tl=ma(Jh);export{tl as K};
